---
layout: posts
title: 国内服务器中转流量
date: 2022-03-04 22:12:22
categories: 
- 其他
tags:
- CentOS
---


#### firewalld 流量转发

firewalld是CentOS7/8默认的防火墙前端软件，绝大多数主机商提供的镜像都已经安装。

判断防火墙是否已经开启

```bash
firewall-cmd --state
```

如果状态不是 `running`,使用下面命令安装或开启防火墙

```bash
yum install -y firewalld         # 安装
systemctl enable firewalld       # 开机启动
systemctl start firewalld        # 开启防火墙
```

配置转发。假设你将国内服务器9090端口流量转发到国外vps的9091端口，转发命令如下：

```bash
echo 'net.ipv4.ip_forward = 1' >> /etc/sysctl.conf
sysctl -p                        # 使配置生效

# 启用伪装 --permanent 配置永久生效
firewall-cmd --permanent --add-masquerade

# 查看伪装是否生效
firewall-cmd --permanent --query-masquerade

# 开启端口
firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd --permanent --add-port=8080/udp

# 配置转发
firewall-cmd --permanent --add-forward-port=port=9090:proto=tcp:toaddr=xxx.xx.xxx.xx:toport=9091
firewall-cmd --permanent --add-forward-port=port=9090:proto=udp:toaddr=xxx.xx.xxx.xx:toport=9091

# 重启防火墙生效 
firewall-cmd --reload
```

**注意：**

云服务器需要在控制页面开启端口

ssr 等工具，ip和端口填写为国内转发服务器，链接时间和加密方式，和外网服务器配置相同