---
layout: posts
title: â‘¢æ‚„æ— å£°æ¯çš„æ‰©å±•-è£…é¥°è€…æ¨¡å¼
mathjax: true
date: 2022-1-3 12:49:16
categories:
  - è®¾è®¡æ¨¡å¼
tags:
  - è®¾è®¡æ¨¡å¼
---

#### ä»Žåˆ†ç¦»æ”¹å˜ï¼Œæ›´è¿›ä¸€æ­¥

çœ‹äº†å‰ä¸¤ä¸ªè®¾è®¡æ¨¡å¼ï¼Œç›¸ä¿¡ä½ ä¸€å®šæ„Ÿè§‰åˆ°ç»§æ‰¿åªèƒ½è§£å†³é™æ€æ—¶å¯¹ç±»çš„æ‰©å±•ï¼Œå¦‚æžœæƒ³åŠ¨æ€çš„å¯¹ç±»çš„è¡Œä¸ºæ‰©å±•å°±éœ€è¦ç”¨åˆ°ç»„åˆã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»å¯ä»¥ç”¨ç­–ç•¥æ¨¡å¼åˆ†ç¦»æ”¹å˜çš„éƒ¨åˆ†ï¼Œè¿˜æœ‰ä»€ä¹ˆåšä¸åˆ°çš„ä¹ˆï¼Ÿ çœ‹çœ‹ä¸‹é¢ä¸€ä¸ªé—®é¢˜ï¼š

- å¥¶èŒ¶åº—æœ‰å‡ åç§å“ç§çš„é¥®æ–™ï¼Œä»–ä»¬éƒ½éœ€è¦ç»§æ‰¿è‡ªä¸€ä¸ªæŠ½è±¡ç±» Beverageï¼Œå› ä¸ºæ¯ç§é¥®æ–™æœ‰è‡ªå·±çš„äº§å“è¯´æ˜Žï¼Œå¹¶ä¸”å„è‡ªå®žçŽ°äº†ä¸€ä¸ªè®¡ç®—é‡‘é¢çš„æ–¹æ³• costã€‚
- æ¯ç§å¥¶èŒ¶é™¤äº†è‡ªå·±ç‰¹æœ‰çš„é…æ–™å¤–ï¼Œè¿˜å¯ä»¥é¢å¤–ä»˜è´¹æ·»åŠ é…æ–™ï¼Œæ¯”å¦‚åŠ ä¸¤ä»½çš„çç ï¼ŒåŠ ä¸€ä»½æ¤°æžœï¼Œå¹¶ä¸”éœ€è¦è®¡ç®—æ€»ä»·ã€‚

å¦‚æžœæƒ³æžšä¸¾å‡ºåº—å†…çš„æ¯ä¸€ç§äº§å“æ˜¯ä¸çŽ°å®žçš„ï¼Œé‚£æ—¶éžå¸¸åºžå¤§çš„ä¸€ä¸ªæŽ’åˆ—ç»„åˆï¼Œå› ä¸ºä¸å¯èƒ½çŸ¥é“å®¢æˆ·è¦åŠ é‚£äº›é…æ–™ã€‚å¹¶ä¸”ä¸¥é‡çš„è¿åäº†è®¾è®¡ä¸­çš„ä¸¤ä¸ªåŽŸåˆ™ï¼š

```ts
abstract class BeverageAbstract {
  description = "some description";
  cost() {}
}
// æžœèŒ¶åŠ ç‰›å¥¶
class FruitTeaWithMilk extends BeverageAbstract {}
// æŸ æª¬èŒ¶åŠ ä¸¤ä»½çç 
class LemonTeaWith2Pearls extends BeverageAbstract {}
//...
```

æ—¢ç„¶ä¸èƒ½æžšä¸¾è€ƒè™‘æ˜¯ä¸æ˜¯åº”è¯¥æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ Beverage ç±»ï¼Œç”¨äºŽå®žçŽ°æŠ½è±¡ç±» BeverageAbstractï¼Œå¹¶ä¸”æŠŠæ‰€æœ‰çš„é…æ–™éƒ½æ·»åŠ åœ¨ Beverage ä¸Šï¼Œå¹¶è®°å½•é…æ–™çš„æ•°é‡ã€‚
å­ç±»ä¼šè°ƒç”¨çˆ¶ç±» cost æ–¹æ³•è®¡ç®—æ‰€æœ‰é…æ–™ï¼Œå¹¶åŠ ä¸Šè‡ªå·±å“ç§çš„ä»·æ ¼ã€‚

```ts
abstract class BeverageAbstract {
  description = "some description";
  cost() {}
}
class Beverage extends BeverageAbstract {
  milk = 2;
  milkCount = 0;
  setMilk(count: number) {
    this.milkCount = count;
  }
  coffee = 5;
  coffeeCount = 0;
  setCoffee(count: number) {
    this.coffeeCount = count;
  }
  cost() {
    let total = 0;
    if (this.milkCount > 0) {
      total += this.milkCount * this.milk;
    }
    if (this.coffeeCount > 0) {
      total += this.coffeeCount * this.coffee;
    }
    return total;
  }
}

class FruitTea extends Beverage {
  cost() {
    return 10 + super.cost();
  }
}

const fruitTea = new FruitTea();
fruitTea.setMilk(2);
console.log(fruitTea.cost());

const fruitTea2 = new FruitTea();
fruitTea2.setMilk(1);
console.log(fruitTea.cost());
```

è¿™æ ·çš„è®¾è®¡è¿˜æœ‰ä¸€äº›é—®é¢˜ï¼š

- å¹¶ä¸æ˜¯æ‰€æœ‰çš„é…æ–™éƒ½éœ€è¦ç»§æ‰¿ï¼Œæ¯ç§é¥®æ–™éƒ½æœ‰è‡ªå·±ç‰¹æœ‰çš„é…æ–™ã€‚
- ä¸€ä½†éœ€è¦æ–°çš„é…æ–™æˆ–æ–°çš„å“ç§æˆ–ä»·é’±çš„æ”¹å˜ï¼Œå°±éœ€è¦ä¿®æ”¹çˆ¶ç±»ã€‚

#### å®šä¹‰è£…é¥°è€…

è®¾è®¡ç±»çš„ä¸€ä¸ªåŽŸåˆ™æ˜¯ **â¤â€ðŸ”¥ ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œä¹Ÿå°±æ˜¯ç±»è®¾è®¡ä¸­æåˆ°çš„å¼€æ”¾å…³é—­åŽŸåˆ™**ã€‚

å¼€æ”¾ä¸”å…³é—­å¹¶ä¸å†²çªï¼Œæƒ³æƒ³è§‚å¯Ÿä¸­æ¨¡å¼ä¸­çš„æ¡ˆä¾‹ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ç±»çš„æ–¹æ³•æ·»åŠ è§‚å¯Ÿè€…ï¼Œè€Œä¸æ”¹å˜åŽŸæœ‰çš„ç±»çš„æ–¹æ³•ã€‚å¹¶ä¸éœ€è¦æ¯ä¸€ä¸ªç±»éƒ½éµå¾ªå¼€æ”¾å…³é—­åŽŸåˆ™ï¼Œé¿å…è¿‡åº¦è®¾è®¡ï¼Œåªéœ€è¦é’ˆå¯¹å¯èƒ½ç»å¸¸ä¼šå‘ç”Ÿå˜åŒ–çš„ç±»åº”ç”¨å¼€å‘-å…³é—­åŽŸåˆ™ã€‚

**è£…é¥°è€…æ¨¡å¼ï¼šåŠ¨æ€çš„å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œè‹¥è¦æ‰©å±•åŠŸèƒ½ï¼Œè£…é¥°è€…æä¾›äº†æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆ**ã€‚

å¯¹äºŽä¸Šé¢çš„é—®é¢˜ï¼ŒæŒ‰ä»¥ä¸‹çš„æ–¹å¼æ€è€ƒï¼š

- æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªæžœèŒ¶ç±» FruitTea
- éœ€è¦åŠ ä¸¤ä»½é¢å¤–çš„ç‰›å¥¶ï¼Œç”¨ä¸¤ä¸ªç‰›å¥¶é…æ–™çš„ç±»åŽ»ä¿®é¥°å®ƒ
- éœ€è¦åŠ ä¸€ä»½é¢å¤–çš„å’–å•¡ï¼Œç”¨ä¸€ä¸ªå’–å•¡é…æ–™çš„ç±»åŽ»ä¿®é¥°å®ƒ
- ä¾èµ–ä¿®é¥°è€…çš„ cost æ–¹æ³•è®¡ç®—ä»·æ ¼
- åœ¨ç¼–ç çš„æ—¶å€™ä¸ºäº†æ˜Žç¡®ä¿®é¥°è€…å’Œè¢«ä¿®é¥°è€…çš„å…³ç³»ï¼Œéœ€è¦è®©ä¿®é¥°è€…å’Œè¢«ä¿®é¥°è€…ç»§æ‰¿åŒæ ·çš„ç±»æˆ–å®žçŽ°ç›¸åŒçš„æŽ¥å£ï¼Œå› ä¸ºè¢«ä¿®é¥°çš„ç±»ä»ç„¶è¢«è§†ä½œåŽŸæœ‰çš„ç±»ï¼Œå®ƒçš„å±žæ€§ä»¥åŠæ–¹æ³•çš„ä½œç”¨ä¸åº”è¯¥å‘ç”Ÿå˜åŒ–ï¼Œåªæ˜¯æ‰©å±•äº†æ–¹æ³•å®žçŽ°ã€‚

```ts
interface BeverageInterface {
  description: string;
  cost(): number;
  getDescription(): string;
}
class MilkDecorator implements BeverageInterface {
  beverage: BeverageInterface;
  description = "MilkDecorator";
  constructor(beverage: BeverageInterface) {
    this.beverage = beverage;
  }
  getDescription() {
    return this.description;
  }
  cost() {
    return 2 + this.beverage.cost();
  }
}
class CoffeeDecorator implements BeverageInterface {
  beverage: BeverageInterface;
  description = "CoffeeDecorator";
  constructor(beverage: BeverageInterface) {
    this.beverage = beverage;
  }
  getDescription() {
    return this.description;
  }
  cost() {
    return 5 + this.beverage.cost();
  }
}
class FruitTea implements BeverageInterface {
  description = "FruitTea";
  getDescription() {
    return this.description;
  }
  cost() {
    return 10;
  }
}

let fruitTea = new FruitTea();
// åŽŸä»·fruitTea
console.log(fruitTea.cost());
// æ·»åŠ é…æ–™ä¸€ä»½ç‰›å¥¶ ä¸€ä»½å’–å•¡
fruitTea = new MilkDecorator(fruitTea);
fruitTea = new CoffeeDecorator(fruitTea);
console.log(fruitTea.cost());
```

çŽ°åœ¨å·²ç»åˆ†ç¦»äº†è£…é¥°ç€å¯¹è±¡,ä½†æ˜¯ä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ˜¯åŸºäºŽä¸€ä¸‹å‡ ä¸ªå‰æï¼š

- è¢«ä¿®é¥°çš„å¯¹è±¡æ˜¯å¯ä»¥æŠ½è±¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¢«ä¿®é¥°çš„å¯¹è±¡ä¸ä¼šè½»æ˜“æ”¹å˜ï¼Œè¿™æ ·é’ˆå¯¹å®ƒçš„ä¿®é¥°ç±»æ‰æœ‰æ„ä¹‰
- ä¿®é¥°å¯¹è±¡æ˜¯ä¸å…³å¿ƒå¤–éƒ¨çŠ¶æ€çš„ï¼Œå®ƒåªå…³å¿ƒè¢«ä¿®é¥°çš„å¯¹è±¡ï¼Œå› ä¸ºä½ æƒ³è®©ä»–æŽ§åˆ¶ä¿®é¥°é“¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œè€…éœ€è¦æ›´å¥½çš„è®¾è®¡ã€‚

#### ä¸Ž ES6 ä¿®é¥°å™¨çš„åŒºåˆ«

ES6 æä¾›ä¿®é¥°å™¨æ–¹ææ¡ˆï¼Œåœ¨ babel è½¬è¯‘åŽæ”¯æŒï¼Œå¯ä»¥ä¿®é¥°ç±»æˆ–ç±»çš„å±žæ€§å’Œæ–¹æ³•ï¼Œä½†å¹¶ä¸æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚

```ts
interface BeverageInterface {
  description: string;
  cost(): number;
  getDescription(): string;
}
function milkDecorator(target: () => number): () => number {
  return () => 2 + target();
}

class FruitTea implements BeverageInterface {
  description = "FruitTea";
  getDescription() {
    return this.description;
  }
  cost() {
    return 10;
  }
}

class FruitTeaWithMilk extends FruitTea {
  @milkDecorator
  cost(): number {
    return super.cost();
  }
}
let fruitTea = new FruitTeaWithMilk();
console.log(fruitTea.cost());
```
