---
layout: posts
title: 浏览器工作原理 ⑥ 页面元素
date: 2022-08-08 09:18:10
categories:
  - HTTP与浏览器
tags:
  - HTTP
  - 浏览器
---

#### 时间线面板的参数

![](0001.png)

+ **Queuing 排队时间** 

图片,音频等低优先级资源可能需要给 css, js 等高优先级资源让路，所以进入排队状态。
同一域名下只允许6个Tcp链接，解决方法可以是使用多个二级域名，或升级http2.

+ **Stalled 停滞事件**

在真正发起链接之前，还会有因为其他原因暂停一段时间。

+ **Request sent 发送数据时间**

因为不需要关心数据是否发送成功，这一时间一般都比较快。

+ **Waiting for server**

一般也叫做TTFB,第一字节响应时间，发起请求后到收到第一个相应字节花费的时间。
慢的原因可能是服务器生成页面时间过久，请求头中携带的cookie过多，也可能是网络原因。


+ **Content Download**

从接受第一个字节到收到全部数据所用的时间。

#### JS,CSS 对DOM解析的影响

HTML解析器（HTML Parser）实现DOM有三个作用:
+ 描述页面结构
+ 提供Api供JS消费
+ 安全防护，防止不安全的内容

DOM的解析和文档的加载是同步执行的，网络进程回合渲染进程创建管道链接，HTML文档会以字节流的形式发送到渲染进程中。

解析的过程是通过分词器将字节流分成不同的Token,如果是StartTag会被压入栈中，栈中默认有一个Document根节点，如果是EndTag并且匹配就会弹出栈。

当在解析的过程中遇到了script标签，因为JS脚本可能会修改DOM结构，所以会暂停HTML的解析，而且当前script标签后面的元素是访问不到的。

如果script标签是一个外部资源的引用，就会停止HTML解析并下载JS文件，因为下载文件是一个耗时的操作，所以浏览器本身会做一些优化，其中包括**预解析操作**，浏览器会单独开启一个线程，解析页面中的JS,CSS资源，并将这些资源提前下载。

另外如果JS文件中没有操作DOM的逻辑，可以使用async,defer属性，让JS文件而HTML解析，并行执行。