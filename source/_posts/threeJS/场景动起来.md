---
title: 场景动起来
mathjax: true

date: 2021-09-19 11:17:21
categories:
  - ThreeJS
tags:
  - ThreeJS
  - 动画
  - 3D
---


#### 循环渲染

[渲染一个立方体](/posts/e875caf9)的章节，最终实现了一个旋转的立方体。并在最后调用了一个动画执行函数

```javascript
const animate = function () {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
};
animate();
```

其实，炫酷的场景并不神秘，只不过是通过不同帧的拼接，而我们要做的就是改变每一帧渲染的内容。

#### 旋转相机

首先要确定的一件事，在最初说到三要素分别是，场景，相机，渲染器，那么现在恐怕要再加上一个要素，就是几何体，就也是我们想观察的物体。

物体，相机，都是在场景之中的，他们被场景所包围。所以，虽然场景有旋转的属性，但是不回去操作场景，因为场景中的物体（包括相机和几何体）会随着场景一起旋转，并不能看到变化。

所以我们尝试改变相机：

```javascript
const animate = function () {
    requestAnimationFrame(animate);
    camera.rotation.y += 0.01;
    renderer.render(scene, camera);
};

animate();
```

注意：上面的代码会让相机绕自身的y轴旋转，所以画面可能和你想象的不太一样，而是类似扫过物体的感觉，因为相机并不是围绕物体的中心轴旋转。

但是不管怎样，我们已经可以让物体动起来了。

#### 旋转物体

这个很简单，立方体的例子中你可能已经感受到了。

#### 性能监视

ThreeJS 提供了一个性能监视的模块，在源文件的 `/examples/jsm/libs/stats.module.js` ,当然 如果你不使用模块化的语法也可以使用 `/examples/js/libs/stats.module.js`，把这个文件放到本地目录中。

使用非常简单，首先创建实例，插入到页面元素中，并在每次动画调用的时候，更新状态。

```javascript
import Stats from './js/stats.module.js';
const stats = new Stats();
document.body.appendChild(stats.dom);

function animate( now ) {
  requestAnimationFrame( animate );
  stats.update();
}
animate()
```


#### 添加辅助线

[THREE.AxesHelper](https://threejs.org/docs/index.html?q=Ax#api/zh/helpers/AxesHelper)

```javascript
  const axesHelper = new THREE.AxesHelper(100);
  scene.add(axesHelper);
```

#### 添加控制

ThreeJS 提供了一个控制模块，在源文件的 `/examples/jsm/controls/OrbitControls.js` ,当然 如果你不使用模块化的语法也可以使用 `/examples/js/controls/OrbitControls.js`，把这个文件放到本地目录中。本质就是对摄像机位置的改变。

```javascript
  import OrbitControls from './js/OrbitControls.js';
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.maxPolarAngle = Math.PI * 0.5;
  controls.minDistance = 100;
  controls.maxDistance = 5000;

  controls.addEventListener('change',render)
```

如果我们使用了`requestAnimationFrame` 动画事件，就无需在添加监听鼠标操作事件的回调事件，因为鼠标对摄像头的操作都能在动画中实时展示。
