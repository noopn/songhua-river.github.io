<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="前端 web react" />
       
      <meta name="description" content="前端技术与生活。" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 四月八日</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">
 
<link rel="stylesheet" href="/css/fonts/remixicon.css">
 
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="/js/pace.min.js"></script>
       
 

      <link rel="stylesheet" href="/css/bulma.min.css" />
      <script src="/js/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <script src="https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js"></script>
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/katex.min.css">

<link rel="stylesheet" href="/css/style.css">
<!-- hexo injector head_end end --></head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">四月八日</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['愿你足够强大，也要足够温柔', '最轻的并不是一根羽毛，而是一双飞鸟的翅膀', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  <article class="articles">
    
    
    
    
    <article
  id="post-javascript/Ramda_私有方法"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/589c737a0260/"
    >Ramda 私有方法源码分析</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/589c737a0260/" class="article-date">
  <time datetime="2021-01-16T08:26:50.000Z" itemprop="datePublished">2021-01-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="objectIs"><a href="#objectIs" class="headerlink" title="_objectIs"></a>_objectIs</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-cn/docs/web/javascript/reference/global_objects/object/is">Object.is</a> 用于判断两值是否项等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_objectIs</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="comment">// MDN polyfill</span></span><br><span class="line">  <span class="keyword">if</span> (a === b) &#123;</span><br><span class="line">    <span class="comment">// Steps 6.b-6.e: +0 != -0</span></span><br><span class="line">    <span class="keyword">return</span> a !== <span class="number">0</span> || <span class="number">1</span> / a === <span class="number">1</span> / b;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Step 6.a: NaN == NaN</span></span><br><span class="line">    <span class="keyword">return</span> a !== a &amp;&amp; b !== b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">typeof</span> <span class="title class_">Object</span>.<span class="property">is</span> === <span class="string">&#x27;function&#x27;</span> ? <span class="title class_">Object</span>.<span class="property">is</span> : _objectIs;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="arrayFromIterator"><a href="#arrayFromIterator" class="headerlink" title="_arrayFromIterator"></a>_arrayFromIterator</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_arrayFromIterator</span>(<span class="params">iter</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> list = [];</span><br><span class="line">  <span class="keyword">var</span> next;</span><br><span class="line">  <span class="keyword">while</span> (!(next = iter.<span class="title function_">next</span>()).<span class="property">done</span>) &#123;</span><br><span class="line">    list.<span class="title function_">push</span>(next.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="functionName"><a href="#functionName" class="headerlink" title="_functionName"></a>_functionName</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-cn/docs/web/javascript/reference/global_objects/function/name">function.name</a> 可能被压缩工具修改，不能依赖函数名来判断函数</p>
<p>作者通过正则方式判断</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_functionName</span>(<span class="params">f</span>) &#123;</span><br><span class="line">  <span class="comment">// String(x =&gt; x) evaluates to &quot;x =&gt; x&quot;, so the pattern may not match.</span></span><br><span class="line">  <span class="keyword">var</span> match = <span class="title class_">String</span>(f).<span class="title function_">match</span>(<span class="regexp">/^function (\w*)/</span>);</span><br><span class="line">  <span class="keyword">return</span> match == <span class="literal">null</span> ? <span class="string">&#x27;&#x27;</span> : match[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="has"><a href="#has" class="headerlink" title="_has"></a>_has</h4><p>判断属性在对象的实例上，而不是在原型上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_has</span>(<span class="params">prop, obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(obj, prop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">has</span>(obj, prop)</span><br></pre></td></tr></table></figure>


<h4 id="isArguments"><a href="#isArguments" class="headerlink" title="_isArguments"></a>_isArguments</h4><p>实现了 <code>callee</code> 方法数组也可以当作是形式参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"><span class="keyword">var</span> _isArguments = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> toString.<span class="title function_">call</span>(<span class="variable language_">arguments</span>) === <span class="string">&#x27;[object Arguments]&#x27;</span> ?</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">_isArguments</span>(<span class="params">x</span>) &#123; <span class="keyword">return</span> toString.<span class="title function_">call</span>(x) === <span class="string">&#x27;[object Arguments]&#x27;</span>; &#125; :</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">_isArguments</span>(<span class="params">x</span>) &#123; <span class="keyword">return</span> <span class="title function_">_has</span>(<span class="string">&#x27;callee&#x27;</span>, x); &#125;;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>

<h4 id="concat"><a href="#concat" class="headerlink" title="_concat"></a>_concat</h4><p>通过双循环，涵盖了array-like类型，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Private `concat` function to merge two array-like objects.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array|Arguments</span>&#125; [set1=[]] An array-like object.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array|Arguments</span>&#125; [set2=[]] An array-like object.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">Array</span>&#125; A new, merged array.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      _concat([4, 5, 6], [1, 2, 3]); //=&gt; [4, 5, 6, 1, 2, 3]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_concat</span>(<span class="params">set1, set2</span>) &#123;</span><br><span class="line">  set1 = set1 || [];</span><br><span class="line">  set2 = set2 || [];</span><br><span class="line">  <span class="keyword">var</span> idx;</span><br><span class="line">  <span class="keyword">var</span> len1 = set1.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">var</span> len2 = set2.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line"></span><br><span class="line">  idx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (idx &lt; len1) &#123;</span><br><span class="line">    result[result.<span class="property">length</span>] = set1[idx];</span><br><span class="line">    idx += <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  idx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (idx &lt; len2) &#123;</span><br><span class="line">    result[result.<span class="property">length</span>] = set2[idx];</span><br><span class="line">    idx += <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="dispatchable"><a href="#dispatchable" class="headerlink" title="_dispatchable"></a>_dispatchable</h4><p>dispatchable翻译为调度单元，这个方法用在了类似 <a href="/posts/6ac7a6cf/#all"><code>R.all</code></a> 遍历每一项的方法上</p>
<p>如果如参是一个数组会按照常规循环方式处理，如果不是数组但是对象携带了传入的方法s数组(<code>[all]</code>)其中的一个，将会调用对象携带的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_dispatchable</span>(<span class="params">methodNames, transducerCreator, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">fn</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> obj = <span class="variable language_">arguments</span>[<span class="variable language_">arguments</span>.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">_isArray</span>(obj)) &#123;</span><br><span class="line">      <span class="keyword">var</span> idx = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (idx &lt; methodNames.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> obj[methodNames[idx]] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> obj[methodNames[idx]].<span class="title function_">apply</span>(obj, <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        idx += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">_isTransformer</span>(obj)) &#123;</span><br><span class="line">        <span class="keyword">var</span> transducer = transducerCreator.<span class="title function_">apply</span>(<span class="literal">null</span>, <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">transducer</span>(obj);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="arrayFromIterator-1"><a href="#arrayFromIterator-1" class="headerlink" title="_arrayFromIterator"></a>_arrayFromIterator</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_arrayFromIterator</span>(<span class="params">iter</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> list = [];</span><br><span class="line">  <span class="keyword">var</span> next;</span><br><span class="line">  <span class="keyword">while</span> (!(next = iter.<span class="title function_">next</span>()).<span class="property">done</span>) &#123;</span><br><span class="line">    list.<span class="title function_">push</span>(next.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="equals"><a href="#equals" class="headerlink" title="_equals"></a>_equals</h4><p>用在了涉及到比较的方法上,例如 <code>R.equals</code></p>
<p><a href="/posts/2b6baf0c/#_objectIs">_objectIs</a></p>
<p><a href="/posts/54a7cf63/#type">type</a></p>
<p><a href="/posts/54a7cf63/#_arrayFromIterator">_arrayFromIterator</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 处理map set 集合</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_uniqContentEquals</span>(<span class="params">aIterator, bIterator, stackA, stackB</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="title function_">_arrayFromIterator</span>(aIterator);</span><br><span class="line">  <span class="keyword">var</span> b = <span class="title function_">_arrayFromIterator</span>(bIterator);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">eq</span>(<span class="params">_a, _b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_equals</span>(_a, _b, stackA.<span class="title function_">slice</span>(), stackB.<span class="title function_">slice</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if *a* array contains any element that is not included in *b*</span></span><br><span class="line">  <span class="keyword">return</span> !<span class="title function_">_includesWith</span>(<span class="keyword">function</span>(<span class="params">b, aItem</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="title function_">_includesWith</span>(eq, aItem, b);</span><br><span class="line">  &#125;, b, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_equals</span>(<span class="params">a, b, stackA, stackB</span>) &#123;</span><br><span class="line">  <span class="comment">// 引用相同，基本类型的值相同</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">_objectIs</span>(a, b)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 类型不同</span></span><br><span class="line">  <span class="keyword">var</span> typeA = <span class="title function_">type</span>(a);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (typeA !== <span class="title function_">type</span>(b)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 引用不同的情况</span></span><br><span class="line">  <span class="comment">//  ??????</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a[<span class="string">&#x27;fantasy-land/equals&#x27;</span>] === <span class="string">&#x27;function&#x27;</span> || <span class="keyword">typeof</span> b[<span class="string">&#x27;fantasy-land/equals&#x27;</span>] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> a[<span class="string">&#x27;fantasy-land/equals&#x27;</span>] === <span class="string">&#x27;function&#x27;</span> &amp;&amp; a[<span class="string">&#x27;fantasy-land/equals&#x27;</span>](b) &amp;&amp;</span><br><span class="line">      <span class="keyword">typeof</span> b[<span class="string">&#x27;fantasy-land/equals&#x27;</span>] === <span class="string">&#x27;function&#x27;</span> &amp;&amp; b[<span class="string">&#x27;fantasy-land/equals&#x27;</span>](a);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果自身实现了equals方法</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> a.<span class="property">equals</span> === <span class="string">&#x27;function&#x27;</span> || <span class="keyword">typeof</span> b.<span class="property">equals</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> a.<span class="property">equals</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; a.<span class="title function_">equals</span>(b) &amp;&amp;</span><br><span class="line">      <span class="keyword">typeof</span> b.<span class="property">equals</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; b.<span class="title function_">equals</span>(a);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 其他引用类型</span></span><br><span class="line">  <span class="keyword">switch</span> (typeA) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Arguments&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Object&#x27;</span>:</span><br><span class="line">      <span class="comment">// 引用类型如果为Promise实例，看作是项等的</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> a.<span class="property">constructor</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp;</span><br><span class="line">        <span class="title function_">_functionName</span>(a.<span class="property">constructor</span>) === <span class="string">&#x27;Promise&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> a === b;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 基本类型的装箱对象</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Boolean&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Number&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;String&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> (!(<span class="keyword">typeof</span> a === <span class="keyword">typeof</span> b &amp;&amp; <span class="title function_">_objectIs</span>(a.<span class="title function_">valueOf</span>(), b.<span class="title function_">valueOf</span>()))) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Date&#x27;</span>:</span><br><span class="line">    <span class="comment">// 时间类型转为事件戳</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">_objectIs</span>(a.<span class="title function_">valueOf</span>(), b.<span class="title function_">valueOf</span>())) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Error&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> a.<span class="property">name</span> === b.<span class="property">name</span> &amp;&amp; a.<span class="property">message</span> === b.<span class="property">message</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;RegExp&#x27;</span>:</span><br><span class="line">    <span class="comment">// 正则类型的所有实例方法的实现相同</span></span><br><span class="line">      <span class="keyword">if</span> (!(a.<span class="property">source</span> === b.<span class="property">source</span> &amp;&amp;</span><br><span class="line">          a.<span class="property">global</span> === b.<span class="property">global</span> &amp;&amp;</span><br><span class="line">          a.<span class="property">ignoreCase</span> === b.<span class="property">ignoreCase</span> &amp;&amp;</span><br><span class="line">          a.<span class="property">multiline</span> === b.<span class="property">multiline</span> &amp;&amp;</span><br><span class="line">          a.<span class="property">sticky</span> === b.<span class="property">sticky</span> &amp;&amp;</span><br><span class="line">          a.<span class="property">unicode</span> === b.<span class="property">unicode</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理map set集合</span></span><br><span class="line">  <span class="keyword">var</span> idx = stackA.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (idx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (stackA[idx] === a) &#123;</span><br><span class="line">      <span class="keyword">return</span> stackB[idx] === b;</span><br><span class="line">    &#125;</span><br><span class="line">    idx -= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (typeA) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Map&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> (a.<span class="property">size</span> !== b.<span class="property">size</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">_uniqContentEquals</span>(a.<span class="title function_">entries</span>(), b.<span class="title function_">entries</span>(), stackA.<span class="title function_">concat</span>([a]), stackB.<span class="title function_">concat</span>([b]));</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Set&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> (a.<span class="property">size</span> !== b.<span class="property">size</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">_uniqContentEquals</span>(a.<span class="title function_">values</span>(), b.<span class="title function_">values</span>(), stackA.<span class="title function_">concat</span>([a]), stackB.<span class="title function_">concat</span>([b]));</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Arguments&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Object&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Boolean&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Number&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;String&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Date&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Error&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;RegExp&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Int8Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Uint8Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Uint8ClampedArray&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Int16Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Uint16Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Int32Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Uint32Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Float32Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Float64Array&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;ArrayBuffer&#x27;</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// Values of other types are only equal if identical.</span></span><br><span class="line">      <span class="comment">// 其他类型只有引用相同才算项等</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理数组或对象的每一个值是否项等</span></span><br><span class="line">  <span class="keyword">var</span> keysA = <span class="title function_">keys</span>(a);</span><br><span class="line">  <span class="keyword">if</span> (keysA.<span class="property">length</span> !== <span class="title function_">keys</span>(b).<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> extendedStackA = stackA.<span class="title function_">concat</span>([a]);</span><br><span class="line">  <span class="keyword">var</span> extendedStackB = stackB.<span class="title function_">concat</span>([b]);</span><br><span class="line"></span><br><span class="line">  idx = keysA.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (idx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = keysA[idx];</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="title function_">_has</span>(key, b) &amp;&amp; <span class="title function_">_equals</span>(b[key], a[key], extendedStackA, extendedStackB))) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    idx -= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ramda/" rel="tag">Ramda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/Ramda_Relation方法"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/4b3e617e083b/"
    >Ramda Relation 方法源码分析</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/4b3e617e083b/" class="article-date">
  <time datetime="2021-01-16T08:14:44.000Z" itemprop="datePublished">2021-01-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
   
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ramda/" rel="tag">Ramda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/Ramda_Math方法"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/fe66a7d19245/"
    >Ramda Math 方法源码分析</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/fe66a7d19245/" class="article-date">
  <time datetime="2021-01-16T07:45:51.000Z" itemprop="datePublished">2021-01-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
   
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ramda/" rel="tag">Ramda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/Ramda中的柯理化"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/6d8100d82f85/"
    >Ramda中的柯理化</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/6d8100d82f85/" class="article-date">
  <time datetime="2021-01-15T13:54:03.000Z" itemprop="datePublished">2021-01-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="curry1"><a href="#curry1" class="headerlink" title="_curry1"></a>_curry1</h4><p>内置接口，保证了参数的个数，无需判断</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Optimized internal one-arity curry function.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category</span> <span class="variable">Function</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; fn The function to curry.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">Function</span>&#125; The curried function.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_curry1</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">0</span> || <span class="title function_">_isPlaceholder</span>(a)) &#123;</span><br><span class="line">      <span class="keyword">return</span> f1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="curry2"><a href="#curry2" class="headerlink" title="_curry2"></a>_curry2</h4><p>如果以值的真假为纬度分支会比较复杂，而且不能正确参数的位置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _curry2 = <span class="keyword">function</span> (<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a !== <span class="literal">undefined</span> &amp;&amp; b !== <span class="literal">undefined</span></span><br><span class="line">      ? <span class="title function_">_isPlaceholder</span>(a) &amp;&amp; <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">        ? f2</span><br><span class="line">        : <span class="title function_">isPlaceholder</span>(a)</span><br><span class="line">          ? <span class="title function_">_curry1</span>(<span class="keyword">function</span> (<span class="params">_a</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(_a, b) &#125;)</span><br><span class="line">          : <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">            ? <span class="title function_">_curry1</span>(<span class="keyword">function</span> (<span class="params">_b</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b) &#125;)</span><br><span class="line">            : fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">      : a !== <span class="literal">undefined</span></span><br><span class="line">        ? <span class="title function_">_curry1</span>(<span class="keyword">function</span> (<span class="params">_b</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b) &#125;)</span><br><span class="line">        : f2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>作者以参数的个数为纬度考虑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Optimized internal two-arity curry function.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category</span> <span class="variable">Function</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; fn The function to curry.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">Function</span>&#125; The curried function.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_curry2</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> f2;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment">// 如果a传入的是undefined也是一个参数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">_isPlaceholder</span>(a)</span><br><span class="line">          ? f2</span><br><span class="line">          : <span class="title function_">_curry1</span>(<span class="keyword">function</span>(<span class="params">_b</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b); &#125;);</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">_isPlaceholder</span>(a) &amp;&amp; <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">          ? f2</span><br><span class="line">          : <span class="title function_">_isPlaceholder</span>(a)</span><br><span class="line">            ? <span class="title function_">_curry1</span>(<span class="keyword">function</span>(<span class="params">_a</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(_a, b); &#125;)</span><br><span class="line">            : <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">              ? <span class="title function_">_curry1</span>(<span class="keyword">function</span>(<span class="params">_b</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b); &#125;)</span><br><span class="line">              : <span class="title function_">fn</span>(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="curry3"><a href="#curry3" class="headerlink" title="_curry3"></a>_curry3</h4><p>同理增加分支判断</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Optimized internal three-arity curry function.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@private</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@category</span> <span class="variable">Function</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; fn The function to curry.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">Function</span>&#125; The curried function.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_curry3</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">f3</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> f3;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">_isPlaceholder</span>(a)</span><br><span class="line">          ? f3</span><br><span class="line">          : <span class="title function_">_curry2</span>(<span class="keyword">function</span>(<span class="params">_b, _c</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b, _c); &#125;);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">_isPlaceholder</span>(a) &amp;&amp; <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">          ? f3</span><br><span class="line">          : <span class="title function_">_isPlaceholder</span>(a)</span><br><span class="line">            ? <span class="title function_">_curry2</span>(<span class="keyword">function</span>(<span class="params">_a, _c</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(_a, b, _c); &#125;)</span><br><span class="line">            : <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">              ? <span class="title function_">_curry2</span>(<span class="keyword">function</span>(<span class="params">_b, _c</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b, _c); &#125;)</span><br><span class="line">              : <span class="title function_">_curry1</span>(<span class="keyword">function</span>(<span class="params">_c</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, b, _c); &#125;);</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">_isPlaceholder</span>(a) &amp;&amp; <span class="title function_">_isPlaceholder</span>(b) &amp;&amp; <span class="title function_">_isPlaceholder</span>(c)</span><br><span class="line">          ? f3</span><br><span class="line">          <span class="comment">// 其中两个是占位符的情况</span></span><br><span class="line">          : <span class="title function_">_isPlaceholder</span>(a) &amp;&amp; <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">            ? <span class="title function_">_curry2</span>(<span class="keyword">function</span>(<span class="params">_a, _b</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(_a, _b, c); &#125;)</span><br><span class="line">            : <span class="title function_">_isPlaceholder</span>(a) &amp;&amp; <span class="title function_">_isPlaceholder</span>(c)</span><br><span class="line">              ? <span class="title function_">_curry2</span>(<span class="keyword">function</span>(<span class="params">_a, _c</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(_a, b, _c); &#125;)</span><br><span class="line">              : <span class="title function_">_isPlaceholder</span>(b) &amp;&amp; <span class="title function_">_isPlaceholder</span>(c)</span><br><span class="line">                ? <span class="title function_">_curry2</span>(<span class="keyword">function</span>(<span class="params">_b, _c</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b, _c); &#125;)</span><br><span class="line">                <span class="comment">// 其中一个是占位符的情况</span></span><br><span class="line">                : <span class="title function_">_isPlaceholder</span>(a)</span><br><span class="line">                  ? <span class="title function_">_curry1</span>(<span class="keyword">function</span>(<span class="params">_a</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(_a, b, c); &#125;)</span><br><span class="line">                  : <span class="title function_">_isPlaceholder</span>(b)</span><br><span class="line">                    ? <span class="title function_">_curry1</span>(<span class="keyword">function</span>(<span class="params">_b</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, _b, c); &#125;)</span><br><span class="line">                    : <span class="title function_">_isPlaceholder</span>(c)</span><br><span class="line">                      ? <span class="title function_">_curry1</span>(<span class="keyword">function</span>(<span class="params">_c</span>) &#123; <span class="keyword">return</span> <span class="title function_">fn</span>(a, b, _c); &#125;)</span><br><span class="line">                      : <span class="title function_">fn</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="curry"><a href="#curry" class="headerlink" title="curry"></a>curry</h4><p>共有方法curry的实现， 对共有方法curryN的封装，在不确定参数个数时候通过 <code>fn.length</code> 获取参数长度</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curry = <span class="title function_">_curry1</span>(<span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">curryN</span>(fn.<span class="property">length</span>, fn);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="curryN"><a href="#curryN" class="headerlink" title="curryN"></a>curryN</h4><p>需要指定参数的个数， 抽象出参数个数的判断，最多个数为10个，防止参数过多造成栈溢出</p>
<p>_arity 对参数个数的处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">_arity</span>(<span class="params">n, fn</span>) &#123;</span><br><span class="line">  <span class="comment">/* eslint-disable no-unused-vars */</span></span><br><span class="line">  <span class="keyword">switch</span> (n) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>); &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">a0</span>) &#123; <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>); &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">a0, a1</span>) &#123; <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>); &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>: <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">a0, a1, a2, a3, a4, a5, a6, a7, a8, a9</span>) &#123; <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>); &#125;;</span><br><span class="line">    <span class="attr">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;First argument to _arity must be a non-negative integer no greater than ten&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> curryN = <span class="title function_">_curry2</span>(<span class="keyword">function</span> <span class="title function_">curryN</span>(<span class="params">length, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_curry1</span>(fn);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_arity</span>(length, <span class="title function_">_curryN</span>(length, [], fn));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在参数较少时使用其他的内置方法  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">curryN</span>(<span class="params">length, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_curry2</span>(<span class="keyword">function</span> (<span class="params">length, fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> length === <span class="number">1</span></span><br><span class="line">      ? <span class="title function_">_curry1</span>(fn)</span><br><span class="line">      : length === <span class="number">2</span></span><br><span class="line">        ? <span class="title function_">_curry2</span>(fn)</span><br><span class="line">        : length === <span class="number">3</span></span><br><span class="line">          ? <span class="title function_">_curry3</span>(fn)</span><br><span class="line">          : <span class="title function_">_arity</span>(length, <span class="title function_">_curryN</span>(length, [], fn))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="curryN-核心方法"><a href="#curryN-核心方法" class="headerlink" title="_curryN 核心方法"></a>_curryN 核心方法</h4><p>下面是一段糟糕的代码</p>
<p>receive保持了源数组的引用，不符合函数式编成数据不可变的思想</p>
<p>每次添加新参数，都要查询可添加的位置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 真实参数个数和length项等 则执行函数</span></span><br><span class="line"><span class="comment">// 2. 实时记录占位符的位置， 新参数优先放到占位符</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_curryN</span>(<span class="params">length, receive, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">fN</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> zw = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">findzw</span>(<span class="params">zw, receive</span>) &#123;</span><br><span class="line">      <span class="keyword">while</span> (zw &lt; receive.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">_isPlaceholder</span>(receive[zw])) &#123;</span><br><span class="line">          <span class="comment">//指向占位符的前一位， 方便后面处理</span></span><br><span class="line">          <span class="keyword">return</span> zw - <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        zw++</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> zw - <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 找到占位符的位置</span></span><br><span class="line">    zw = <span class="title function_">findzw</span>(zw, receive);</span><br><span class="line">    <span class="keyword">while</span> (index &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      receive[zw + <span class="number">1</span>] = <span class="variable language_">arguments</span>[index];</span><br><span class="line">      <span class="comment">//更新之后重新查找占位符, 条过当前的占位符</span></span><br><span class="line">      zw = <span class="title function_">findzw</span>(zw + <span class="number">1</span>, receive);</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 没有占位符 则位置+1为参数长度</span></span><br><span class="line">    <span class="keyword">if</span> (zw + <span class="number">1</span> === length) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, receive)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 计算剩余参数</span></span><br><span class="line">      <span class="keyword">var</span> j = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">var</span> len = <span class="number">0</span></span><br><span class="line">      <span class="keyword">while</span> (j &lt; receive.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">_isPlaceholder</span>(receive[index])) &#123;</span><br><span class="line">          len++;</span><br><span class="line">        &#125;</span><br><span class="line">        j++</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">_arity</span>(length - len, <span class="title function_">_curryN</span>(length, receive, fn))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源码的实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_curryN</span>(<span class="params">length, receive, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 复制已接受参数的数组</span></span><br><span class="line">    <span class="keyword">var</span> combined = [];</span><br><span class="line">    <span class="comment">// 遍历入参的索引</span></span><br><span class="line">    <span class="keyword">var</span> argsIdx = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 剩余参数</span></span><br><span class="line">    <span class="keyword">var</span> left = length;</span><br><span class="line">    <span class="comment">// 遍历已接受参数索引</span></span><br><span class="line">    <span class="keyword">var</span> combinedIdx = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果参数没有复制完成，或新如参没有添加完成则继续执行</span></span><br><span class="line">    <span class="keyword">while</span> (combinedIdx &lt; received.<span class="property">length</span> || argsIdx &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> result;</span><br><span class="line">      <span class="comment">// 通过条件语句处理了占位符的问题</span></span><br><span class="line">      <span class="comment">// 如果老参数没有复制完成，且复制的值不是占位符，或者入参已经都处理了，直接取出当前的老参数，用于复制到新的数组中</span></span><br><span class="line">      <span class="comment">// 通过双指针解决占位符的问题</span></span><br><span class="line">      <span class="keyword">if</span> (combinedIdx &lt; received.<span class="property">length</span> &amp;&amp;</span><br><span class="line">        (!<span class="title function_">_isPlaceholder</span>(received[combinedIdx]) ||</span><br><span class="line">          argsIdx &gt;= <span class="variable language_">arguments</span>.<span class="property">length</span>)) &#123;</span><br><span class="line">        result = received[combinedIdx];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果老参数都复制完，或者时占位符，或者还有新参数没有复制</span></span><br><span class="line">        <span class="comment">// 取一个新参数加到数组中</span></span><br><span class="line">        result = <span class="variable language_">arguments</span>[argsIdx];</span><br><span class="line">        argsIdx += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 添加到新数组中</span></span><br><span class="line">      combined[combinedIdx] = result;</span><br><span class="line">      <span class="comment">// 如果不是占位符剩余参数 -1</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">_isPlaceholder</span>(result)) &#123;</span><br><span class="line">        left -= <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      combinedIdx += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果没有剩余参数直接执行</span></span><br><span class="line">    <span class="keyword">return</span> left &lt;= <span class="number">0</span></span><br><span class="line">      ? fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, combined)</span><br><span class="line">      <span class="comment">// 否则通过_arity固定新函数的参数个数</span></span><br><span class="line">      : <span class="title function_">_arity</span>(left, <span class="title function_">_curryN</span>(length, combined, fn));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ramda/" rel="tag">Ramda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/基本类型"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/17ef7065c12e/"
    >TypeScript 基本类型</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/17ef7065c12e/" class="article-date">
  <time datetime="2021-01-14T15:26:07.000Z" itemprop="datePublished">2021-01-14</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/TypeScript/">TypeScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="TS-是什么"><a href="#TS-是什么" class="headerlink" title="TS 是什么"></a>TS 是什么</h4><p>是JavaScript的超集，添加了类型系统。 拟补JavaScript在开发大型系统时的不足。</p>
<h4 id="相比-JS-的优势"><a href="#相比-JS-的优势" class="headerlink" title="相比 JS 的优势"></a>相比 JS 的优势</h4><ul>
<li><p>类型化的思维方式，开发更加严谨，提前发现错误，减少改bug的时间</p>
</li>
<li><p>类型系统提高了代码的可读性，并使维护和重构更加容易</p>
</li>
<li><p>补充了接口枚举等开发大型应用时JS缺失的功能。</p>
</li>
</ul>
<h5 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h5><p>单行注释 <code>//</code> 快捷键 <code>ctrl + /</code></p>
<p>多行注释 <code>/*  */</code> 快捷键 <code>ctrl + shift + A</code> (ubuntu)</p>
<h5 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h5><p>为变量添加类型约束的方式</p>
<p>声明变量必须指定type类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>:number;</span><br></pre></td></tr></table></figure>

<h5 id="变量命名规则"><a href="#变量命名规则" class="headerlink" title="变量命名规则"></a>变量命名规则</h5><p>不能以数字开头，且只能包含 <code>$</code>，<code>_</code>， <code>数字</code>，<code>字母</code></p>
<h5 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h5><p>原始类型: Number&#x2F;String&#x2F;Bollean&#x2F;undefined&#x2F;null 对应类型注解为 number&#x2F;string&#x2F;boolean&#x2F;undefined&#x2F;null</p>
<p><strong>undefined null类型 属于其他类型 never 的子类型</strong></p>
<p><strong>联合类型</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">n</span>:number | <span class="literal">null</span> | <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">n = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>如果直接赋值不需要声明type类型，类型推论</strong> </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果重新覆盖不同的类型值会提示错误</span></span><br><span class="line">a = <span class="string">&#x27;22&#x27;</span><span class="comment">// 错误</span></span><br></pre></td></tr></table></figure>

<p>也可通通过字面量赋值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>:<span class="number">1</span>|<span class="literal">true</span>;</span><br><span class="line">a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>


<p><strong>数组类型 Array</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定数组中的类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>:number[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>:<span class="title class_">Array</span>&lt;number&gt; = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>:any[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p><strong>object</strong></p>
<p>[propName:string]:any 表示任意类型的属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">b</span>:&#123;</span><br><span class="line">  <span class="attr">name</span>:string,</span><br><span class="line">  age?:number,</span><br><span class="line">  [<span class="attr">propName</span>:string]:any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>元组类型 tuple</strong></p>
<p>数组类型的一种，可以指定数组中不同元素的类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>:[string，number] = [<span class="string">&#x27;123&#x27;</span>,<span class="number">3.4</span>]</span><br></pre></td></tr></table></figure>

<p><strong>类数组</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>  <span class="title function_">fn</span>(<span class="params">...args:any[]</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">arg</span>:<span class="title class_">IArguments</span> = <span class="variable language_">arguments</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p><strong>枚举类型 enum</strong></p>
<p>定义枚举类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enum <span class="title class_">StatusEnum</span> &#123;</span><br><span class="line">  success = <span class="number">0</span>,</span><br><span class="line">  error = -<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: <span class="title class_">StatusEnum</span> = <span class="title class_">StatusEnum</span>.<span class="property">success</span></span><br></pre></td></tr></table></figure>

<p>如果没有声明值，则返回枚举字段的索引， 如果其中一个有值，后面没有赋值的字段会把前面的值 +1 返回</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enum <span class="title class_">Color</span> &#123; red, gray = <span class="number">5</span>, black&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">c</span>:<span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">red</span> <span class="comment">//0</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">c1</span>:<span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">gray</span> <span class="comment">//5</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">c2</span>:<span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">black</span> <span class="comment">//6</span></span><br></pre></td></tr></table></figure>

<p><strong>常数枚举</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> enum <span class="title class_">Color</span> &#123; red, gray&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>.<span class="property">red</span>,<span class="title class_">Color</span>.<span class="property">gray</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//最终编译为</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span><span class="comment">/*Color.red*/</span>,<span class="number">1</span><span class="comment">/*Color.red*/</span>)</span><br></pre></td></tr></table></figure>

<p><strong>任意类型 any</strong></p>
<p>一个变量设置了any,相当于关闭了类型监测</p>
<p>声明变量如果没有执行类型，会默认设置为any类型</p>
<p>使用场景：第三方库没有定义的类型，类型转换的时候，数据结构太复杂太灵活，ts为document提供了一整套类型声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">a</span>:any = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">a.<span class="property">style</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;&lt;div /&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">ele</span>:<span class="title class_">HTMLElement</span>|<span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">ele!.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;&lt;div /&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>void 类型</strong></p>
<p>void 表示没有任何类型，一般用于定义方法的时候没有返回值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="attr">fun</span>:<span class="title function_">void</span>(<span class="params"></span>)&#123;</span><br><span class="line">  cosnole.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fun = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>never类型</strong></p>
<p>包括 <code>null</code> 和 <code>undefined</code> 类型，代表从不会出现的值，这意意味着never类型只能被never类型所赋值</p>
<p>用于报错，没有值的类型，函数执行不完,比如事件循环，数据库的监听</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: never = (<span class="function">() =&gt;</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span> &#125;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>): never &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>): never &#123;</span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>)&#123;&#125;</span><br><span class="line">  <span class="comment">// 需要never类型，永远不会到达的语句</span></span><br><span class="line">  cosnole.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>unknow 类型</strong></p>
<p>unknow 类型在复制给其他的变量时会检查，不允许把unknow类型复制给其他类型,如果使用的是<code>any</code>类型将不会检查错误</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">d</span>:any = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">s</span>:string = d;<span class="comment">// 不会报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">d</span>:unknow = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">s</span>:string = d;<span class="comment">// 回报错</span></span><br></pre></td></tr></table></figure>

<p>通过类型判断允许赋值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> d === <span class="string">&#x27;string&#x27;</span>)&#123;</span><br><span class="line">  s = d</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>类型断言</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">s = d <span class="keyword">as</span> string;</span><br></pre></td></tr></table></figure>

<p><strong>字面量类型</strong> </p>
<p>描述的是同类型不同值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="string">&quot;aaa&quot;</span> | <span class="string">&quot;bbb&quot;</span>;</span><br><span class="line">a = <span class="string">&quot;aaa&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">MyType</span> = <span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>:<span class="title class_">MyType</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>:<span class="title class_">MyType</span> = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>:<span class="title class_">MyType</span> = <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h4 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h4><p>函数参数和返回值类型必须被声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">a: number = <span class="number">2</span>, b?: number, ...c: <span class="built_in">Array</span>&lt;any&gt;</span>): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (b) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>函数重载表示同名的函数如果参数不同函数会重载</p>
<p>但是JS中没有重载的概念，下面同名的函数会覆盖上面的函数</p>
<p>TS中模拟函数重载, 通过不同的参数类型校验</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">a: number</span>): number;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">b: string</span>): string;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">c: any</span>): any &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> c === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> c + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>定义函数的结构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">fn</span>:<span class="function">(<span class="params">a:number,b:number</span>) =&gt;</span> number</span><br></pre></td></tr></table></figure>


<h4 id="包装对象"><a href="#包装对象" class="headerlink" title="包装对象"></a>包装对象</h4><p>自动在基本类型的对象类型之间切换,基本类型上没有方法，在内部迅速的完成一个装箱操作，把基本类型迅速包装成对象类型，然后调用对象类型的方法。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/面向对象"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/2c316c8d5104/"
    >TypeScript 面向对象</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/2c316c8d5104/" class="article-date">
  <time datetime="2021-01-14T15:26:07.000Z" itemprop="datePublished">2021-01-14</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/TypeScript/">TypeScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">n: string</span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = n;<span class="comment">// 构造函数，为定义的属性赋值</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">name</span>: string; <span class="comment">// 定义属性 省略前面的public关键字</span></span><br><span class="line"></span><br><span class="line">  readonly <span class="attr">age</span>:number =  <span class="number">18</span> <span class="comment">// 只读属性</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> readonly <span class="attr">age</span>: number = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>():<span class="keyword">void</span>&#123; <span class="comment">// 定义方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;void&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p>定义类的结构，声明包含的属性和方法，接口也可以当作类型声明去使用</p>
<p>接口可以在定义类的时候限制类的结构，接口中所有属性都不应该有实际的值</p>
<p>接口只定义对象的结构，接口中的所有方法都是抽象方法</p>
<p>同名结构声明的类型会合并，如果一个对象使用了该接口，必须包含所有的属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">MyObj</span> &#123;</span><br><span class="line">  <span class="attr">prop1</span>: string,</span><br><span class="line">  <span class="attr">prop2</span>: number</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">MyObj</span> &#123;</span><br><span class="line">  <span class="attr">prop3</span>: <span class="title class_">Boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj</span>: <span class="title class_">MyObj</span> = &#123;</span><br><span class="line">  <span class="attr">prop1</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  <span class="attr">prop2</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">prop3</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口可以描述类的行为<br>定义类时可以让类去实现一个接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">PersonInterface</span> &#123;</span><br><span class="line">  <span class="comment">// 只读属性</span></span><br><span class="line">  readyonly <span class="attr">name</span>: string,</span><br><span class="line">  <span class="attr">age</span>: number,</span><br><span class="line">  <span class="title function_">say</span>(<span class="attr">method</span>: string): boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JiaZhen</span> implements <span class="title class_">PersonInterface</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">  <span class="attr">age</span>: number = <span class="number">1</span>;</span><br><span class="line">  <span class="title function_">say</span>(<span class="attr">method</span>: string): boolean &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用接口描述一个类的实例化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">PersonInterface</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:string,</span><br><span class="line">  <span class="title function_">new</span>(<span class="attr">name</span>:string):<span class="title class_">Person</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name:string</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>  <span class="title function_">createPerson</span>(<span class="params">Clsss:PersonInterface,name:string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Clsss</span>(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">createPerson</span>(<span class="title class_">Person</span>,<span class="string">&#x27;aaa&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="属性的封装"><a href="#属性的封装" class="headerlink" title="属性的封装"></a>属性的封装</h4><p>类的属性如果可以随意被修改，可能导致运算时的错误</p>
<p>TS提供了三种属性的修饰符</p>
<p>public: 公有 在类，子类 类外面都可以访问</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">pubilc name:string</span>)&#123;</span><br><span class="line">    <span class="comment">// 表示添加到实例上。可以通过属性访问</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Person</span>().<span class="property">name</span></span><br></pre></td></tr></table></figure>

<p>protected: 保护类型 在类里面，子类里面可以访问，在类外部没法访问</p>
<p>private: 私有 在类里面可以方法，子类，类外都不能访问</p>
<p>属性如果不加修饰符就是共有</p>
<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><p>定义函数或者类时遇到类型不确定时使用泛型，可以使用多个</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> jiazhen&lt;Z&gt;(<span class="attr">age</span>: Z): Z &#123;</span><br><span class="line">  <span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">jiazhen</span>(<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">jiazhen&lt;<span class="title class_">Number</span>&gt;(<span class="number">19</span>) <span class="comment">// 主动指明泛型</span></span><br></pre></td></tr></table></figure>

<p>指明泛型Z必须是interface的实现类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Zhen</span> &#123;</span><br><span class="line">  <span class="attr">age</span>: number,</span><br><span class="line">  <span class="title function_">love</span>(<span class="attr">who</span>: string): boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> jiazhen&lt;Z <span class="keyword">extends</span> <span class="title class_">Zhen</span>&gt;(<span class="attr">obj</span>: Z): any &#123;</span><br><span class="line">  <span class="keyword">return</span> obj.<span class="property">love</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jiazhen&lt;<span class="title class_">Zhen</span>&gt;(&#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="title function_">love</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>指明类初始化时的泛型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&lt;T&gt;&#123;</span><br><span class="line">  <span class="attr">name</span>: T;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">a: T</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = a</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> A&lt;string&gt;(<span class="string">&#x27;10&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="类装饰器"><a href="#类装饰器" class="headerlink" title="类装饰器"></a>类装饰器</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">enhancer</span>(<span class="params">target:any</span>)&#123;</span><br><span class="line">  target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&#x27;11&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@enhancer</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p.<span class="property">name</span>;</span><br></pre></td></tr></table></figure>

<h4 id="属性装饰器"><a href="#属性装饰器" class="headerlink" title="属性装饰器"></a>属性装饰器</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 如果装饰的是普通的属性，target指向类的原型</span></span><br><span class="line"><span class="comment">// 如果是static属性，target指向类的定义</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">upperCase</span>(<span class="params">target:any,propname:string</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> v = target[propname];</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getter</span> = (<span class="params"></span>)=&gt;v;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setter</span> = (<span class="params">newValue:string</span>)=&gt;&#123;</span><br><span class="line">    v =  newValue.<span class="title function_">toUpperCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">delete</span> target[propname];</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target,propname,&#123;</span><br><span class="line">    <span class="attr">set</span>:setter,</span><br><span class="line">    <span class="attr">get</span>:getter,</span><br><span class="line">    <span class="attr">enumerable</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>:<span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  @upperCase</span><br><span class="line">  name = <span class="string">&#x27;girl&#x27;</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unEnumber</span>(<span class="params">enumConfig:boolean</span>) &#123;</span><br><span class="line">  <span class="comment">//                                                       属性描述器</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">unEnumber</span>(<span class="params">target:any,propname:string,propertyDescriptor:PropertyDescriptor</span>) &#123;</span><br><span class="line">    propertyDescriptor.<span class="property">enumerable</span>  = enumConfig;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  name = <span class="string">&#x27;girl&#x27;</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// getname 不能枚举</span></span><br><span class="line">  @<span class="title function_">unEnumber</span>(<span class="literal">false</span>)</span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> p)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以对方法的逻辑进行包装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">trans</span>(<span class="params">target:any,propname:string,propertyDescriptor:PropertyDescriptor</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> oldValue = propertyDescriptor.<span class="property">value</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1------------&quot;</span>)</span><br><span class="line">  propertyDescriptor.<span class="property">value</span> = <span class="keyword">function</span> <span class="title function_">getNumber</span>(<span class="params">...args:any[]</span>) &#123;</span><br><span class="line">    args = args.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span><span class="title class_">Number</span>(item));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2------------&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> oldValue.<span class="title function_">apply</span>(<span class="variable language_">this</span>,args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  name = <span class="string">&#x27;girl&#x27;</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line">  @trans</span><br><span class="line">  <span class="title function_">getNumber</span>(<span class="params">...args:any[]</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;3------------&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum,item</span>)=&gt;</span>&#123; sum+=item; <span class="keyword">return</span> sum &#125;,<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="title function_">getNumber</span>(<span class="string">&#x27;1&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;3&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="参数修饰器"><a href="#参数修饰器" class="headerlink" title="参数修饰器"></a>参数修饰器</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//              类的原型    方法名             被修饰参数的索引</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dubble</span>(<span class="params">target:any,methodName:string,index:number</span>) &#123;</span><br><span class="line">  target.<span class="property">num</span> = <span class="string">&#x27;num&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">getNumber</span>(<span class="params">@dubble num:number</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">num</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"></span><br><span class="line">p.<span class="title function_">getNumber</span>(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h4 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h4><p>不能当作构造函数，抽象方法必须被子类实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  abstract <span class="title function_">say</span>(): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lisa</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">say</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="重写和重载"><a href="#重写和重载" class="headerlink" title="重写和重载"></a>重写和重载</h4><p>重写:子类中重写继承自父类的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">say</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boy</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span>&#123;</span><br><span class="line">  <span class="title function_">say</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重载：为一个函数提供多个类型的定义</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数重载表示同名的函数如果参数不同函数会重载</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 但是JS中没有重载的概念，下面同名的函数会覆盖上面的函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TS中模拟函数重载, 通过不同的参数类型校验</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">a: number</span>): number;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">b: string</span>): string;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">c: any</span>): any &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> c === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> c + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/co模块"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/7e5726aaca4d/"
    >co模块</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/7e5726aaca4d/" class="article-date">
  <time datetime="2021-01-14T05:37:56.000Z" itemprop="datePublished">2021-01-14</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>基于生成器的nodej和浏览器控制流，使用promises，让您以一种很好的方式编写非阻塞代码。</p>
<p>可以让Generator函数的自动执行。不用编写Generator函数的执行器。</p>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><p><strong>co(fn*).then( val &#x3D;&gt; )</strong></p>
<p>通过解析一个Generator，Generator函数，或任何返回Generator的函数，并返回一个Promise</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">co</span>(<span class="keyword">function</span>* () &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err.<span class="property">stack</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>var fn &#x3D; co.wrap(fn*)</strong></p>
<p>把<code>generator</code>转换为一个普通函数并返回<code>Promise</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = co.<span class="title function_">wrap</span>(<span class="keyword">function</span>* (val) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(val);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="title function_">fn</span>(<span class="literal">true</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">val</span>) &#123;</span><br><span class="line"> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="执行逻辑"><a href="#执行逻辑" class="headerlink" title="执行逻辑"></a>执行逻辑</h4><ul>
<li><p><code>co(fn)</code> 执行传入<code>co</code>模块的 generator 函数 fn </p>
</li>
<li><p>把 fn 执行的结果 res，包装成 promise 对象</p>
</li>
</ul>
<p><code>const gen = fn(); const res = gen.next()</code>  <code>const rp =  toPromise(res.value)</code></p>
<ul>
<li>如果是合法的 promise 这继续调用 fn 的 next 方法</li>
</ul>
<p><code>rp.then((value)=&gt; res.next())</code></p>
<p>co其实是一个返回promise对象的函数， 内部通过递归的方式调用 generator 的 next 方法</p>
<h4 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h4><p>工具方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sllice 引用</span></span><br><span class="line"><span class="keyword">var</span> slice = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isObject</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span> == val.<span class="property">constructor</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出方法</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = co[<span class="string">&#x27;default&#x27;</span>] = co.<span class="property">co</span> = co;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是否是promise对象，只要是实现了thenable的对象都可以视为promise对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isPromise</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;function&#x27;</span> == <span class="keyword">typeof</span> obj.<span class="property">then</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isGenerator</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;function&#x27;</span> == <span class="keyword">typeof</span> obj.<span class="property">next</span> &amp;&amp; <span class="string">&#x27;function&#x27;</span> == <span class="keyword">typeof</span> obj.<span class="property">throw</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否是generator函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isGeneratorFunction</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="comment">// 一定是GeneratorFunction构造函数的实例</span></span><br><span class="line">  <span class="comment">// (function()&#123;&#125;).constructor === Function =&gt; true</span></span><br><span class="line">  <span class="keyword">var</span> constructor = obj.<span class="property">constructor</span>;</span><br><span class="line">  <span class="keyword">if</span> (!constructor) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;GeneratorFunction&#x27;</span> === constructor.<span class="property">name</span> || <span class="string">&#x27;GeneratorF方法</span></span><br><span class="line"><span class="string">function thunkToPromise(fn) &#123;</span></span><br><span class="line"><span class="string">  var ctx = this;</span></span><br><span class="line"><span class="string">  return new Promise(function (resolve, reject) &#123;</span></span><br><span class="line"><span class="string">    fn.call(ctx, function (err, res) &#123;</span></span><br><span class="line"><span class="string">      if (err) return reject(err);</span></span><br><span class="line"><span class="string">      if (arguments.length &gt; 2) res = slice.call(arguments, 1);</span></span><br><span class="line"><span class="string">      resolve(res);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// arrayToPromise yeildable数组转换为promise</span></span><br><span class="line"><span class="string">function arrayToPromise(obj) &#123;</span></span><br><span class="line"><span class="string">  // 每一项都转换为promise</span></span><br><span class="line"><span class="string">  // 第二个参数为toPromise执行时的this值</span></span><br><span class="line"><span class="string">  return Promise.all(obj.map(toPromise, this));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// objectToPromise yieldables对象转为promise</span></span><br><span class="line"><span class="string">function objectToPromise(obj)&#123;</span></span><br><span class="line"><span class="string">  // 借用 function Object()&#123;&#125;</span></span><br><span class="line"><span class="string">  var results = new obj.constructor();</span></span><br><span class="line"><span class="string">  var keys = Object.keys(obj);</span></span><br><span class="line"><span class="string">  var promises = [];</span></span><br><span class="line"><span class="string">  for (var i = 0; i &lt; keys.length; i++) &#123;</span></span><br><span class="line"><span class="string">    var key = keys[i];</span></span><br><span class="line"><span class="string">    // 每一项转为promise</span></span><br><span class="line"><span class="string">    var promise = toPromise.call(this, obj[key]);</span></span><br><span class="line"><span class="string">    if (promise &amp;&amp; isPromise(promise)) defer(promise, key);</span></span><br><span class="line"><span class="string">    // 其他情况直接返回key值</span></span><br><span class="line"><span class="string">    else results[key] = obj[key];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  return Promise.all(promises).then(function () &#123;</span></span><br><span class="line"><span class="string">    return results;</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  function defer(promise, key) &#123;</span></span><br><span class="line"><span class="string">    // 提前在results中定义key</span></span><br><span class="line"><span class="string">    results[key] = undefined;</span></span><br><span class="line"><span class="string">    promises.push(promise.then(function (res) &#123;</span></span><br><span class="line"><span class="string">      // 提前一步拿到结果</span></span><br><span class="line"><span class="string">      // 通常自己的写法为这里直接返回promise</span></span><br><span class="line"><span class="string">      // 在promise.all 中在遍历结果生成result,这样写法更简洁一点</span></span><br><span class="line"><span class="string">      results[key] = res;</span></span><br><span class="line"><span class="string">    &#125;));</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//把yeild转为Promise对象</span></span><br><span class="line"><span class="string">function toPromise(obj) &#123;</span></span><br><span class="line"><span class="string">  // 如果为假直接返回</span></span><br><span class="line"><span class="string">  if (!obj) return obj;</span></span><br><span class="line"><span class="string">  //如果已经是promise直接返回</span></span><br><span class="line"><span class="string">  if (isPromise(obj)) return obj;</span></span><br><span class="line"><span class="string">  // 如果是generator函数 通过co函数栈为promise</span></span><br><span class="line"><span class="string">  if (isGeneratorFunction(obj) || isGenerator(obj)) return co.call(this, obj);</span></span><br><span class="line"><span class="string">  // this通过next方法中toPromise.call(ctx, ret.value)来绑定</span></span><br><span class="line"><span class="string">  if (&#x27;</span><span class="keyword">function</span><span class="string">&#x27; == typeof obj) return thunkToPromise.call(this, obj);</span></span><br><span class="line"><span class="string">  if (Array.isArray(obj)) return arrayToPromise.call(this, obj);</span></span><br><span class="line"><span class="string">  if (isObject(obj)) return objectToPromise.call(this, obj);</span></span><br><span class="line"><span class="string">  return obj;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>


<p>co 核心方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">co</span>(<span class="params">gen</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = slice.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把任何东西包装成promise, 从而避免promise调用链</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 内存泄漏的问题</span></span><br><span class="line">  <span class="comment">// https://github.com/tj/co/issues/180</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行Generator函数，返回Generator</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> gen === <span class="string">&#x27;function&#x27;</span>) gen = gen.<span class="title function_">apply</span>(ctx, args);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果没有next方法，则直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (!gen || <span class="keyword">typeof</span> gen.<span class="property">next</span> !== <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> <span class="title function_">resolve</span>(gen);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">onFulfilled</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Mixed</span>&#125; <span class="variable">res</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@api</span> <span class="variable">private</span></span></span><br><span class="line"><span class="comment">     * 通过 try catch 捕获执行时错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onFulfilled</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> ret;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        ret = gen.<span class="title function_">next</span>(res);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reject</span>(e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">next</span>(ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Error</span>&#125; <span class="variable">err</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@api</span> <span class="variable">private</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onRejected</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> ret;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        ret = gen.<span class="keyword">throw</span>(err);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reject</span>(e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">next</span>(ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the next value in the generator,</span></span><br><span class="line"><span class="comment">     * return a promise.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; <span class="variable">ret</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@api</span> <span class="variable">private</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">next</span>(<span class="params">ret</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ret.<span class="property">done</span>) <span class="keyword">return</span> <span class="title function_">resolve</span>(ret.<span class="property">value</span>);</span><br><span class="line">      <span class="keyword">var</span> value = toPromise.<span class="title function_">call</span>(ctx, ret.<span class="property">value</span>);</span><br><span class="line">      <span class="comment">// 如果可以包装成promise, 通过thenable方法继续调用onFulfilled，执行下一个next, 并把promise的值传入，当作上一个next的结果</span></span><br><span class="line">      <span class="keyword">if</span> (value &amp;&amp; <span class="title function_">isPromise</span>(value)) <span class="keyword">return</span> value.<span class="title function_">then</span>(onFulfilled, onRejected);</span><br><span class="line">      <span class="comment">// 抛出错误</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">onRejected</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;You may only yield a function, promise, generator, array, or object, &#x27;</span></span><br><span class="line">        + <span class="string">&#x27;but the following object was passed: &quot;&#x27;</span> + <span class="title class_">String</span>(ret.<span class="property">value</span>) + <span class="string">&#x27;&quot;&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>co.wrap(fn*)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过柯理化函数，返回一个包含co执行结果的正常函数</span></span><br><span class="line"></span><br><span class="line">co.<span class="property">wrap</span> = <span class="keyword">function</span> (<span class="params">fn</span>) &#123;</span><br><span class="line">  createPromise.<span class="property">__generatorFunction__</span> = fn;</span><br><span class="line">  <span class="keyword">return</span> createPromise;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">createPromise</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> co.<span class="title function_">call</span>(<span class="variable language_">this</span>, fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node/" rel="tag">Node</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/koa"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/7855919be700/"
    >Koa Router</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/7855919be700/" class="article-date">
  <time datetime="2021-01-12T14:47:14.000Z" itemprop="datePublished">2021-01-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h4><p>中间件容器 负责不同组件和不同服务之间的交互，需要一个中间件负责统一的对服务使用</p>
<p>一个简单的中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title function_">koa</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m1</span> = <span class="keyword">async</span> (<span class="params">ctx, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m2</span> = <span class="keyword">async</span> (<span class="params">ctx, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m3</span> = <span class="keyword">async</span> (<span class="params">ctx, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">  .<span class="title function_">use</span>(m1)</span><br><span class="line">  .<span class="title function_">use</span>(m2)</span><br><span class="line">  .<span class="title function_">use</span>(m3)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p>最终返回的结果为 1 3 5 2 4 6</p>
<p>也就是洋葱模型，由<code>koa-compose</code>模块来实现</p>
<p>实现洋葱模型的几个关键：</p>
<ul>
<li>统一的上下文 ctx</li>
<li>操作先进后出 通过<code>next</code>控制</li>
<li>有提前结束的机制</li>
</ul>
<p><strong>中间件类型</strong></p>
<ul>
<li>应用级中间件 vue全局导航守卫</li>
<li>路由级中间件 独享路由守卫</li>
<li>错误处理中间件  </li>
<li>第三方中间件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Router</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title function_">koa</span>();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">m1</span> = <span class="keyword">async</span> (<span class="params">ctx, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 应用级中间件最先被访问</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用级中间件&#x27;</span>);</span><br><span class="line">  <span class="comment">//通过next进入路由级中间件</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  <span class="keyword">if</span> (ctx.<span class="property">status</span> == <span class="number">404</span>) &#123;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;404&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 路由级中间件会按照顺序访问</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;路由级中间件1&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;路由级中间件2&#x27;</span>);</span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;路由&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router.<span class="title function_">routes</span>());</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">  .<span class="title function_">use</span>(m1)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<h4 id="koa-和-express-比较"><a href="#koa-和-express-比较" class="headerlink" title="koa 和 express 比较"></a>koa 和 express 比较</h4><p>express 通过connect添加中间件 封装了路由，视图, 异步处理使用callback (深层次的错误不能捕获)</p>
<p>koa 依赖于co模块，不包含任何中间件， 处理了回调 (使用了async await) 和错误处理(使用了try catch),</p>
<h4 id="处理get-post-请求参数"><a href="#处理get-post-请求参数" class="headerlink" title="处理get post 请求参数"></a>处理get post 请求参数</h4><p><a target="_blank" rel="noopener" href="https://github.com/dlau/koa-body#readme">koa-body</a></p>
<h4 id="静态资源中间件"><a href="#静态资源中间件" class="headerlink" title="静态资源中间件"></a>静态资源中间件</h4><p><a target="_blank" rel="noopener" href="https://github.com/koajs/static#readme">koa-static</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Koa/" rel="tag">Koa</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/性能优化基础"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/217c8927c3f1/"
    >性能优化基础</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/217c8927c3f1/" class="article-date">
  <time datetime="2020-12-27T09:59:35.000Z" itemprop="datePublished">2020-12-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="Navigation-Timing"><a href="#Navigation-Timing" class="headerlink" title="Navigation Timing"></a><a target="_blank" rel="noopener" href="https://www.w3.org/TR/2012/REC-navigation-timing-20121217/">Navigation Timing</a></h4><p><img src="/posts/217c8927c3f1/0001.png"></p>
<ul>
<li>prompt for unload</li>
</ul>
<p>为卸载页面作准备， 释放js资源</p>
<ul>
<li>DNS domainLookupStart domainLookupEnd</li>
</ul>
<p>DNS 服务器会影响解析时间，DNS基于UDP协议</p>
<p>DNS （Domain Name System) 域名系统，用于将域名转换为IP</p>
<p>顶级域名: .com .org .club</p>
<p>域名资源记录： 域名服务商的配置记录 （3A，4A）</p>
<p>域名解析流程： </p>
<ul>
<li>TCP</li>
</ul>
<p>可能会产生ssl的握手（secureConnetionStart），需要放在nigix上处理</p>
<p>服务器的连接数会影响响应的速度，也受到物理距离的影响</p>
<ul>
<li>request response</li>
</ul>
<p>请求开始到响应开始包括，数据传输时间，服务器处理时间，服务器请求时间，服务器渲染时间</p>
<p>服务端优化： 服务端缓存，sql查询时间，服务端渲染，生成数据大小（使用压缩）</p>
<h4 id="三次握手四次挥手"><a href="#三次握手四次挥手" class="headerlink" title="三次握手四次挥手"></a>三次握手四次挥手</h4><p><img src="/posts/217c8927c3f1/0001.jpeg"></p>
<p>序列号seq：占4个字节，用来标记数据段的顺序，TCP把连接中发送的所有数据字节都编上一个序号，第一个字节的编号由本地随机产生；给字节编上序号后，就给每一个报文段指派一个序号；序列号seq就是这个报文段中的第一个字节的数据编号。</p>
<p>确认号ack：占4个字节，期待收到对方下一个报文段的第一个数据字节的序号；序列号表示报文段携带数据的第一个字节的编号；而确认号指的是期望接收到下一个字节的编号；因此当前报文段最后一个字节的编号+1即为确认号。</p>
<p>确认ACK：占1位，仅当ACK&#x3D;1时，确认号字段才有效。ACK&#x3D;0时，确认号无效</p>
<p>同步SYN：连接建立时用于同步序号。当SYN&#x3D;1，ACK&#x3D;0时表示：这是一个连接请求报文段。若同意连接，则在响应报文段中使得SYN&#x3D;1，ACK&#x3D;1。因此，SYN&#x3D;1表示这是一个连接请求，或连接接受报文。SYN这个标志位只有在TCP建产连接时才会被置1，握手完成后SYN标志位被置0。</p>
<p>终止FIN：用来释放一个连接。FIN&#x3D;1表示：此报文段的发送方的数据已经发送完毕，并要求释放运输连接</p>
<p>PS：ACK、SYN和FIN这些大写的单词表示标志位，其值要么是1，要么是0；ack、seq小写的单词表示序号。</p>
<p><img src="/posts/217c8927c3f1/0002.png"></p>
<p>第一次握手：建立连接时，客户端发送syn包（syn&#x3D;x）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。</p>
<p>第二次握手：服务器收到syn包，必须确认客户的SYN（ack&#x3D;x+1），同时自己也发送一个SYN包（syn&#x3D;y），即SYN+ACK包，此时服务器进入SYN_RECV状态；</p>
<p>第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack&#x3D;y+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。</p>
<p>！<a href="0003.png"></a></p>
<p>1）客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN&#x3D;1，其序列号为seq&#x3D;u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。</p>
<p>2）服务器收到连接释放报文，发出确认报文，ACK&#x3D;1，ack&#x3D;u+1，并且带上自己的序列号seq&#x3D;v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。</p>
<p>3）客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。</p>
<p>4）服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN&#x3D;1，ack&#x3D;u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq&#x3D;w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。</p>
<p>5）客户端收到服务器的连接释放报文后，必须发出确认，ACK&#x3D;1，ack&#x3D;w+1，而自己的序列号是seq&#x3D;u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。</p>
<p>6）服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。</p>
<ul>
<li>为什么连接的时候是三次握手，关闭的时候却是四次握手？</li>
</ul>
<p>因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，”你发的FIN报文我收到了”。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。</p>
<ul>
<li>为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？</li>
</ul>
<p>有可以最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。在Client发送出最后的ACK回复，但该ACK可能丢失。Server如果没有收到ACK，将不断重复发送FIN片段。所以Client不能立即关闭，它必须确认Server接收到了该ACK。Client会在发送出ACK之后进入到TIME_WAIT状态。Client会设置一个计时器，等待2MSL的时间。如果在该时间内再次收到FIN，那么Client会重发ACK并再次等待2MSL。所谓的2MSL是两倍的MSL(Maximum Segment Lifetime)。MSL指一个片段在网络中最大的存活时间，2MSL就是一个发送和一个回复所需的最大时间。如果直到2MSL，Client都没有再次收到FIN，那么Client推断ACK已经被成功接收，则结束TCP连接。</p>
<ul>
<li>为什么不能用两次握手进行连接？</li>
</ul>
<p>3次握手完成两个重要的功能，既要双方做好发送数据的准备工作(双方都知道彼此已准备好)，也要允许双方就初始序列号进行协商，这个序列号在握手过程中被发送和确认。<br>假定C给S发送一个连接请求分组，S收到了这个分组，并发 送了确认应答分组。按照两次握手的协定，S认为连接已经成功地建立了，可以开始发送数据分组。可是，C在S的应答分组在传输中被丢失的情况下，将不知道S 是否已准备好，不知道S建立什么样的序列号，C甚至怀疑S是否收到自己的连接请求分组。在这种情况下，C认为连接还未建立成功，将忽略S发来的任何数据分 组，只等待连接确认应答分组。而S在发出的分组超时后，重复发送同样的分组。这样就形成了死锁。</p>
<ul>
<li>如果已经建立了连接，但是客户端突然出现故障了怎么办？</li>
</ul>
<p>TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75秒钟发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。</p>
<h4 id="缓存策略"><a href="#缓存策略" class="headerlink" title="缓存策略"></a>缓存策略</h4><p><img src="/posts/217c8927c3f1/0004.png"></p>
<p><img src="/posts/217c8927c3f1/0005.png"></p>
<h5 id="强制缓存"><a href="#强制缓存" class="headerlink" title="强制缓存"></a>强制缓存</h5><p>浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回Status Code: 200 OK </p>
<p><img src="/posts/217c8927c3f1/0006.png"></p>
<p>200 from disk cache： 不访问服务器，已经在之前的某个时间加载过该资源，直接从硬盘中读取缓存，关闭浏览器后，数据依然存在，此资源不会随着该页面的关闭而释放掉下次打开仍然会是from disk cache。</p>
<p><img src="/posts/217c8927c3f1/0007.png"></p>
<p>200 form memory cache : 不访问服务器，一般已经加载过该资源且缓存在了内存当中，直接从内存中读取缓存。浏览器关闭后，数据将不存在（资源被释放掉了），再次打开相同的页面时，不会出现from memory cache。</p>
<p><strong>header参数</strong></p>
<p>Expires：过期时间，如果设置了时间，则浏览器会在设置的时间内直接读取缓存，不再请求</p>
<p>Cache-Control：当值设为max-age&#x3D;300时，则代表在这个请求正确返回时间（浏览器也会记录下来）的5分钟内再次加载资源，就会命中强缓存。</p>
<p>（1） max-age：用来设置资源（representations）可以被缓存多长时间，单位为秒；<br>（2） s-maxage：和max-age是一样的，不过它只针对代理服务器缓存而言；<br>（3）public：指示响应可被任何缓存区缓存；<br>（4）private：只能针对个人用户，而不能被代理服务器缓存；<br>（5）no-cache：强制客户端直接向服务器发送请求,也就是说每次请求都必须向服务器发送。服务器接收到     请求，然后判断资源是否变更，是则返回新内容，否则返回304，未变更。这个很容易让人产生误解，使人误     以为是响应不被缓存。实际上Cache-Control:     no-cache是会被缓存的，只不过每次在向客户端（浏览器）提供响应数据时，缓存都要向服务器评估缓存响应的有效性。<br>（6）no-store：禁止一切缓存（这个才是响应不被缓存的意思）。</p>
<p>cache-control是http1.1的头字段，expires是http1.0的头字段,如果expires和cache-control同时存在，cache-control会覆盖expires，建议两个都写。</p>
<h5 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h5><p><img src="/posts/217c8927c3f1/0008.png"></p>
<p>向服务器发送请求，服务器会根据这个请求的request header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response header通知浏览器从缓存中读取资源；</p>
<p><strong>header参数</strong></p>
<p>Etag&#x2F;If-None-Match：</p>
<p>Etag是属于HTTP 1.1属性，它是由服务器（Apache或者其他工具）生成返回给前端，用来帮助服务器控制Web端的缓存验证。Apache中，ETag的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行Hash后得到的。</p>
<p>当资源过期时，浏览器发现响应头里有Etag,则再次像服务器请求时带上请求头if-none-match(值是Etag的值)。服务器收到请求进行比对，决定返回200或304</p>
<p>Last-Modifed&#x2F;If-Modified-Since：</p>
<p>Last-Modified 浏览器向服务器发送资源最后的修改时间</p>
<p>If-Modified-Since 当资源过期时（浏览器判断Cache-Control标识的max-age过期），发现响应头具有Last-Modified声明，则再次向服务器请求时带上头if-modified-since，表示请求时间。服务器收到请求后发现有if-modified-since则与被请求资源的最后修改时间进行对比（Last-Modified）,若最后修改时间较新（大），说明资源又被改过，则返回最新资源，HTTP 200 OK;若最后修改时间较旧（小），说明资源无新修改，响应HTTP 304 走缓存。</p>
<p>Last-Modifed&#x2F;If-Modified-Since的时间精度是秒，而Etag可以更精确。<br>Etag优先级是高于Last-Modifed的，所以服务器会优先验证Etag<br>Last-Modifed&#x2F;If-Modified-Since是http1.0的头字段</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B/" rel="tag">应用案例</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-webpack/开发环境处理"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/dd1b8adb81f3/"
    >开发环境处理</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/dd1b8adb81f3/" class="article-date">
  <time datetime="2020-12-26T14:46:37.000Z" itemprop="datePublished">2020-12-26</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/webpack/">webpack</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="处理html"><a href="#处理html" class="headerlink" title="处理html"></a>处理html</h4><p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/html-webpack-plugin">html-webpack-plugin</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev html-webpack-plugin@next <span class="comment">//webpack5</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>:<span class="string">&#x27;**.html&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="处理样式"><a href="#处理样式" class="headerlink" title="处理样式"></a>处理样式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D sass-node less-loader css-loader style-loader</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/css-loader">css-loader</a>  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/style-loader">style-loader</a> <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/sass-loader">sass-loader</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="attr">loader</span>: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">              <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">minimize</span>: <span class="literal">false</span>, <span class="comment">//压缩css代码, 默认false</span></span><br><span class="line">                  <span class="attr">import</span>: <span class="literal">true</span>, <span class="comment">//禁止或启用@import, 默认true</span></span><br><span class="line">                  <span class="attr">url</span>: <span class="literal">true</span>, <span class="comment">//控制url/image-set的解析，会处理成require引入</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        , <span class="string">&#x27;sass-loader&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="处理图片资源"><a href="#处理图片资源" class="headerlink" title="处理图片资源"></a>处理图片资源</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D url-loader file-laoder</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 小图片以bash64的方式输出</span></span><br><span class="line"><span class="comment">// 可以处理通过import引入的样式中的图片，js文件中引入的图片文件</span></span><br><span class="line"><span class="comment">// 如果图片大于指定大小会默认交给file-loader处理</span></span><br><span class="line"><span class="comment">// file-loader 会使用options中的配置</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif)$/i</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">limit</span>: <span class="number">5</span> * <span class="number">1024</span>,</span><br><span class="line">        <span class="attr">outputPath</span>: <span class="string">&#x27;assets&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;[hash:8].[ext]&#x27;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 处理html中的图片</span></span><br><span class="line"><span class="comment">// 把html字符串中的图片引变成require的形式，</span></span><br><span class="line"><span class="comment">// 最终还是需要使用file-loader 和 url-loader来处理</span></span><br><span class="line"><span class="comment">// 如果生成的src是[object Module]需要关闭，url-loader的模块化规范</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.html$/i</span>,</span><br><span class="line">  <span class="attr">use</span>: [&#123;</span><br><span class="line">    <span class="attr">loader</span>: <span class="string">&#x27;html-loader&#x27;</span>,</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="处理字体资源"><a href="#处理字体资源" class="headerlink" title="处理字体资源"></a>处理字体资源</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// exclude:/\.xx$/</span></span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(ttf|eot|svg|woff|woff2)$/</span>,</span><br><span class="line">  <span class="attr">loader</span>:<span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>:&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;[path][name].[ext]&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="简单的devServer搭建"><a href="#简单的devServer搭建" class="headerlink" title="简单的devServer搭建"></a>简单的devServer搭建</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D webpack-dev-server</span><br></pre></td></tr></table></figure>

<p>webpack.config.js 可能因为 <code>webpack-dev-server</code>与<code>webpack</code>版本不匹配导致错误</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>:&#123;</span><br><span class="line">  <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">contentBase</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  <span class="attr">open</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以通过单独的server.js文件来使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpackDevServer = <span class="built_in">require</span>(<span class="string">&#x27;webpack-dev-server&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  <span class="attr">contentBase</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">writeToDisk</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">webpackDevServer.<span class="title function_">addDevServerEntrypoints</span>(config, options);</span><br><span class="line"><span class="keyword">const</span> compiler = <span class="title function_">webpack</span>(config);</span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> <span class="title function_">webpackDevServer</span>(compiler, options);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;dev server listening on port 9000&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="friendly-errors-webpack-plugin-https-www-npmjs-com-package-friendly-errors-webpack-plugin"><a href="#friendly-errors-webpack-plugin-https-www-npmjs-com-package-friendly-errors-webpack-plugin" class="headerlink" title="friendly-errors-webpack-plugin[https://www.npmjs.com/package/friendly-errors-webpack-plugin]"></a>friendly-errors-webpack-plugin[<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/friendly-errors-webpack-plugin]">https://www.npmjs.com/package/friendly-errors-webpack-plugin]</a></h4><p>添加桌面通知<br>该插件没有桌面通知的原生支持，需要引入node-notifier，这样就可以了 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">NotifierPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;friendly-errors-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> notifier = <span class="built_in">require</span>(<span class="string">&#x27;node-notifier&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">ICON</span> = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;icon.png&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">new</span> <span class="title class_">NotifierPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">onErrors</span>: <span class="function">(<span class="params">severity, errors</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (severity !== <span class="string">&#x27;error&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> error = errors[<span class="number">0</span>];</span><br><span class="line">      notifier.<span class="title function_">notify</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Webpack error&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: severity + <span class="string">&#x27;: &#x27;</span> + error.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">subtitle</span>: error.<span class="property">file</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="variable constant_">ICON</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/18/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/20/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2025
        <i class="ri-heart-fill heart_icon"></i> SunZhiqi
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.png" alt="四月八日"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>此时无声胜有声！</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="/js/jquery.modal.min.js"></script>
<link rel="stylesheet" href="/css/jquery.modal.min.css" />
<script src="/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg"></div>

  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->

        <div class="pswp__counter"></div>

        <button
          class="pswp__button pswp__button--close"
          title="Close (Esc)"
        ></button>

        <button
          class="pswp__button pswp__button--share"
          style="display: none"
          title="Share"
        ></button>

        <button
          class="pswp__button pswp__button--fs"
          title="Toggle fullscreen"
        ></button>

        <button
          class="pswp__button pswp__button--zoom"
          title="Zoom in/out"
        ></button>

        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div>
      </div>

      <button
        class="pswp__button pswp__button--arrow--left"
        title="Previous (arrow left)"
      ></button>

      <button
        class="pswp__button pswp__button--arrow--right"
        title="Next (arrow right)"
      ></button>

      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/css/photoswipe.min.css" />
<link rel="stylesheet" href="/css/default-skin.min.css" />
<script src="/js/photoswipe.min.js"></script>
<script src="/js/photoswipe-ui-default.min.js"></script>

<script>
  function viewer_init() {
    let pswpElement = document.querySelectorAll(".pswp")[0];
    let $imgArr = document.querySelectorAll(
      ".article-entry img:not(.reward-img)"
    );

    $imgArr.forEach(($em, i) => {
      $em.onclick = () => {
        // slider展开状态
        // todo: 这样不好，后面改成状态
        if (document.querySelector(".left-col.show")) return;
        let items = [];
        $imgArr.forEach(($em2, i2) => {
          let img = $em2.getAttribute("data-idx", i2);
          let src =
            $em2.getAttribute("data-target") || $em2.getAttribute("src");
          let title = $em2.getAttribute("alt");
          // 获得原图尺寸
          const image = new Image();
          image.src = src;
          items.push({
            src: src,
            w: image.width || $em2.width,
            h: image.height || $em2.height,
            title: title,
          });
        });
        var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
          index: parseInt(i),
        });
        gallery.init();
      };
    });
  }
  viewer_init();
</script>
 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="/js/MathJax.js"></script>
<script src="/js/TeX-AMS-MML_HTMLorMML-full.js"></script>

<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="/js/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !(function (e, t, a) {
    var initCopyCode = function () {
      var copyHtml = "";
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += "</button>";
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS(".btn-copy", {
        target: function (trigger) {
          return trigger.nextElementSibling;
        },
      });
      clipboard.on("success", function (e) {
        let $btn = $(e.trigger);
        $btn.addClass("copied");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-checkbox-circle-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPIED";

        wait(function () {
          // 等待两秒钟后恢复
          $icon.removeClass("ri-checkbox-circle-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
      clipboard.on("error", function (e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass("copy-failed");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-time-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPY FAILED";

        wait(function () {
          // 等待两秒钟后恢复
          $icon.removeClass("ri-time-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
    };
    initCopyCode();
  })(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "default" });
  }
</script>


    
    

  </div>
</body>

</html>