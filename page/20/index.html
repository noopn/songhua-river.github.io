<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="前端 web react" />
       
      <meta name="description" content="前端技术与生活。" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 四月八日</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">
 
<link rel="stylesheet" href="/css/fonts/remixicon.css">
 
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="/js/pace.min.js"></script>
       
 

      <link rel="stylesheet" href="/css/bulma.min.css" />
      <script src="/js/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <script src="https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js"></script>
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/katex.min.css">

<link rel="stylesheet" href="/css/style.css">
<!-- hexo injector head_end end --></head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">四月八日</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['愿你足够强大，也要足够温柔', '最轻的并不是一根羽毛，而是一双飞鸟的翅膀', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  <article class="articles">
    
    
    
    
    <article
  id="post-devops/CLI"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/3f200f51f059/"
    >CLI</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/3f200f51f059/" class="article-date">
  <time datetime="2020-12-20T06:51:27.000Z" itemprop="datePublished">2020-12-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h5 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h5><p>基于文本查看，处理，操作计算机上面文件的程序</p>
<h5 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h5><p>webpack 打包 编译 图片压缩 </p>
<h5 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h5><p>vue <command> [options]</p>
<p>主命令 + 子命令 + 参数</p>
<p>init           generate a new project from a template<br>list           list available official templates<br>build          prototype a new project<br>create         (for v3 warning only)<br>help [cmd]     display help for [cmd]</p>
<p>通过用户的配置拉取远程的模板，来生成模板</p>
<p><code>vue list</code> 查看模板的种类</p>
<p>Available official templates:<br>  ★  browserify - A full-featured Browserify + vueify setup with hot-reload, linting &amp; unit testing.<br>  ★  browserify-simple - A simple Browserify + vueify setup for quick prototyping.<br>  ★  pwa - PWA template for vue-cli based on the webpack template<br>  ★  simple - The simplest possible Vue setup in a single HTML file<br>  ★  webpack - A full-featured Webpack + vue-loader setup with hot reload, linting, testing &amp; css extraction.<br>  ★  webpack-simple - A simple Webpack + vue-loader setup for quick prototyping.</p>
<p>borwserify 是有另一种打包规范，用于处理使用CMD打包规范，引用的模块</p>
<h5 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h5><p><code>vue help init</code> 查看初始化命令</p>
<p>Usage: vue-init <template-name> [project-name]</p>
<p>Options:<br>  -c, –clone  use git clone<br>  –offline    use cached template<br>  -h, –help   output usage information<br>  Examples:</p>
<pre><code># create a new project with an official template
$ vue init webpack my-project

# create a new project straight from a github template
$ vue init username/repo my-project
</code></pre>
<p>流程：</p>
<ul>
<li><p>vue 输入命令 命令内部初始化</p>
</li>
<li><p>获取用户配置：交互</p>
</li>
<li><p>解析配置 基础配置+用户配置&#x3D;配置</p>
</li>
<li><p>生成项目文件 通过配置来拉取远程官方模板 + 自己写的模板<br>自己写的模板必须包含 ：meta.js &#x2F; json<br>prompts&#x3D;&gt;收集弹框信息<br>helpers&#x3D;&gt;模板引擎的扩展<br>complete&#x3D;&gt;钩子函数<br>metalsmith&#x3D;&gt;站点生成器 通过配置和模板生成文件</p>
<p>还必须包含模板文件：template</p>
</li>
<li><p>完善工作</p>
</li>
</ul>
<h5 id="包"><a href="#包" class="headerlink" title="包"></a>包</h5><ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/tj/commander.js">commander</a> 完整的 node.js 命令行解决方案</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/SBoudrias/Inquirer.js">Inquirer</a> 弹窗交互</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/chalk/chalk">chalk</a> 命令行美化工具</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/sindresorhus/ora">ora</a> 命令行加载动画</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/sindresorhus/execa">execa</a> 持续集成 提交到主分支</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/lerna/lerna">lerna</a> 处理多包相互依赖</p>
</li>
</ul>
<h5 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h5><ul>
<li><p>docs 文档</p>
</li>
<li><p>scripts 脚本</p>
</li>
<li><p>packages &#x3D;&gt; lerna</p>
</li>
<li><p>lib 核心逻辑</p>
</li>
<li><p>package.json<br>  bin 放置用户自定义命令</p>
<p>  为什么没有全局安装的命令可以使用 npm run 来执行，但是不能直接调用？</p>
<p>  如果一个命令想要全局执行，需要添加到全局的环境变量 PATH 中</p>
<p>  在执 npm run 或者 yarn 的时候，会自动在node_modules中查找需要执行的文件，通过npm link 软连接，添加到全局的环境变量PATH中，在执行完成后再删除</p>
<p>  全局安装的命令，会安装在 <code>/usr/local/node12.18.4/lib/node_modules/</code>,执行的时候会自动link,和scripts中写的命令同理</p>
<p>  bin 文件夹下面的命令需要手动link,在入口文件改变时需要重新link</p>
<p>  所以写一个命令的步骤： 1）创建bin文件夹，添加文件 2） 文件头部添加 <code>#!/usr/bin/env node </code> 表示可执行文件 3） link 到全局</p>
</li>
</ul>
<h5 id="vue-cli"><a href="#vue-cli" class="headerlink" title="vue-cli"></a>vue-cli</h5><p><strong>vue-list</strong> 请求模板</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;../lib/logger&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听ctrl + c退出事件</span></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求模板使用到的包</span></span><br><span class="line"><span class="comment">// 如果没有报错，拼接包的名字 返回上面的列表</span></span><br><span class="line"><span class="title function_">request</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://api.github.com/users/vuejs-templates/repos&#x27;</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;vue-cli&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, res, body</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) logger.<span class="title function_">fatal</span>(err)</span><br><span class="line">  <span class="keyword">const</span> requestBody = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(body)</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(requestBody)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;  Available official templates:&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">    requestBody.<span class="title function_">forEach</span>(<span class="function"><span class="params">repo</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="string">&#x27;  &#x27;</span> + chalk.<span class="title function_">yellow</span>(<span class="string">&#x27;★&#x27;</span>) +</span><br><span class="line">        <span class="string">&#x27;  &#x27;</span> + chalk.<span class="title function_">blue</span>(repo.<span class="property">name</span>) +</span><br><span class="line">        <span class="string">&#x27; - &#x27;</span> + repo.<span class="property">description</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(requestBody.<span class="property">message</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>vue-init</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> download = <span class="built_in">require</span>(<span class="string">&#x27;download-git-repo&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> program = <span class="built_in">require</span>(<span class="string">&#x27;commander&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> exists = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="property">existsSync</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">&#x27;ora&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> home = <span class="built_in">require</span>(<span class="string">&#x27;user-home&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> tildify = <span class="built_in">require</span>(<span class="string">&#x27;tildify&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> rm = <span class="built_in">require</span>(<span class="string">&#x27;rimraf&#x27;</span>).<span class="property">sync</span></span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;../lib/logger&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> generate = <span class="built_in">require</span>(<span class="string">&#x27;../lib/generate&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> checkVersion = <span class="built_in">require</span>(<span class="string">&#x27;../lib/check-version&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> warnings = <span class="built_in">require</span>(<span class="string">&#x27;../lib/warnings&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> localPath = <span class="built_in">require</span>(<span class="string">&#x27;../lib/local-path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isLocalPath = localPath.<span class="property">isLocalPath</span></span><br><span class="line"><span class="keyword">const</span> getTemplatePath = localPath.<span class="property">getTemplatePath</span></span><br><span class="line"></span><br><span class="line">program</span><br><span class="line">  .<span class="title function_">usage</span>(<span class="string">&#x27;&lt;template-name&gt; [project-name]&#x27;</span>)</span><br><span class="line">  .<span class="title function_">option</span>(<span class="string">&#x27;-c, --clone&#x27;</span>, <span class="string">&#x27;use git clone&#x27;</span>)</span><br><span class="line">  .<span class="title function_">option</span>(<span class="string">&#x27;--offline&#x27;</span>, <span class="string">&#x27;use cached template&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Help.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">program.<span class="title function_">on</span>(<span class="string">&#x27;--help&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;  Examples:&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">gray</span>(<span class="string">&#x27;    # create a new project with an official template&#x27;</span>))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;    $ vue init webpack my-project&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">gray</span>(<span class="string">&#x27;    # create a new project straight from a github template&#x27;</span>))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;    $ vue init username/repo my-project&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Help.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">help</span> () &#123;</span><br><span class="line">  program.<span class="title function_">parse</span>(process.<span class="property">argv</span>)</span><br><span class="line">  <span class="keyword">if</span> (program.<span class="property">args</span>.<span class="property">length</span> &lt; <span class="number">1</span>) <span class="keyword">return</span> program.<span class="title function_">help</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">help</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Settings.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> template = program.<span class="property">args</span>[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">const</span> hasSlash = template.<span class="title function_">indexOf</span>(<span class="string">&#x27;/&#x27;</span>) &gt; -<span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> rawName = program.<span class="property">args</span>[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">const</span> inPlace = !rawName || rawName === <span class="string">&#x27;.&#x27;</span></span><br><span class="line"><span class="keyword">const</span> name = inPlace ? path.<span class="title function_">relative</span>(<span class="string">&#x27;../&#x27;</span>, process.<span class="title function_">cwd</span>()) : rawName</span><br><span class="line"><span class="keyword">const</span> to = path.<span class="title function_">resolve</span>(rawName || <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> clone = program.<span class="property">clone</span> || <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tmp = path.<span class="title function_">join</span>(home, <span class="string">&#x27;.vue-templates&#x27;</span>, template.<span class="title function_">replace</span>(<span class="regexp">/[\/:]/g</span>, <span class="string">&#x27;-&#x27;</span>))</span><br><span class="line"><span class="keyword">if</span> (program.<span class="property">offline</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&gt; Use cached template at <span class="subst">$&#123;chalk.yellow(tildify(tmp))&#125;</span>`</span>)</span><br><span class="line">  template = tmp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Padding.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (inPlace || <span class="title function_">exists</span>(to)) &#123;</span><br><span class="line">  inquirer.<span class="title function_">prompt</span>([&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;confirm&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: inPlace</span><br><span class="line">      ? <span class="string">&#x27;Generate project in current directory?&#x27;</span></span><br><span class="line">      : <span class="string">&#x27;Target directory exists. Continue?&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;ok&#x27;</span></span><br><span class="line">  &#125;]).<span class="title function_">then</span>(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (answers.<span class="property">ok</span>) &#123;</span><br><span class="line">      <span class="title function_">run</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(logger.<span class="property">fatal</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_">run</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Check, download and generate the project.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span> () &#123;</span><br><span class="line">  <span class="comment">// check if template is local</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isLocalPath</span>(template)) &#123;</span><br><span class="line">    <span class="keyword">const</span> templatePath = <span class="title function_">getTemplatePath</span>(template)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">exists</span>(templatePath)) &#123;</span><br><span class="line">      <span class="title function_">generate</span>(name, templatePath, to, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) logger.<span class="title function_">fatal</span>(err)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">        logger.<span class="title function_">success</span>(<span class="string">&#x27;Generated &quot;%s&quot;.&#x27;</span>, name)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.<span class="title function_">fatal</span>(<span class="string">&#x27;Local template &quot;%s&quot; not found.&#x27;</span>, template)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">checkVersion</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!hasSlash) &#123;</span><br><span class="line">        <span class="comment">// use official templates</span></span><br><span class="line">        <span class="keyword">const</span> officialTemplate = <span class="string">&#x27;vuejs-templates/&#x27;</span> + template</span><br><span class="line">        <span class="keyword">if</span> (template.<span class="title function_">indexOf</span>(<span class="string">&#x27;#&#x27;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title function_">downloadAndGenerate</span>(officialTemplate)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (template.<span class="title function_">indexOf</span>(<span class="string">&#x27;-2.0&#x27;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">            warnings.<span class="title function_">v2SuffixTemplatesDeprecated</span>(template, inPlace ? <span class="string">&#x27;&#x27;</span> : name)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// warnings.v2BranchIsNowDefault(template, inPlace ? &#x27;&#x27; : name)</span></span><br><span class="line">          <span class="title function_">downloadAndGenerate</span>(officialTemplate)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">downloadAndGenerate</span>(template)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Download a generate from a template repo.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; <span class="variable">template</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">downloadAndGenerate</span> (template) &#123;</span><br><span class="line">  <span class="keyword">const</span> spinner = <span class="title function_">ora</span>(<span class="string">&#x27;downloading template&#x27;</span>)</span><br><span class="line">  spinner.<span class="title function_">start</span>()</span><br><span class="line">  <span class="comment">// Remove if local template exists</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">exists</span>(tmp)) <span class="title function_">rm</span>(tmp)</span><br><span class="line">  <span class="title function_">download</span>(template, tmp, &#123; clone &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    spinner.<span class="title function_">stop</span>()</span><br><span class="line">    <span class="keyword">if</span> (err) logger.<span class="title function_">fatal</span>(<span class="string">&#x27;Failed to download repo &#x27;</span> + template + <span class="string">&#x27;: &#x27;</span> + err.<span class="property">message</span>.<span class="title function_">trim</span>())</span><br><span class="line">    <span class="title function_">generate</span>(name, tmp, to, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) logger.<span class="title function_">fatal</span>(err)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>()</span><br><span class="line">      logger.<span class="title function_">success</span>(<span class="string">&#x27;Generated &quot;%s&quot;.&#x27;</span>, name)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-algorithm/leetcode/(O03)数组中重复的数字"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/e771ddaee295/"
    >O(03).数组中重复的数字</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/e771ddaee295/" class="article-date">
  <time datetime="2020-12-15T02:38:10.000Z" itemprop="datePublished">2020-12-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a> / <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/%E5%85%B3%E8%81%94%E9%A2%98%E7%9B%AE/">关联题目</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><strong><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/shu-zu-zhong-zhong-fu-de-shu-zi-lcof/">LeetCode</a></strong></p>
<blockquote>
<p><strong>注意</strong></p>
</blockquote>
<h3 id="暴力解法"><a href="#暴力解法" class="headerlink" title="暴力解法"></a>暴力解法</h3><p>使用 map 或 set</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> findRepeatNumber = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title function_">map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> n <span class="keyword">of</span> nums) &#123;</span><br><span class="line">    <span class="keyword">if</span> (map[n]) <span class="keyword">return</span> n;</span><br><span class="line">    map[n] = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="原地替换"><a href="#原地替换" class="headerlink" title="原地替换"></a>原地替换</h3><ul>
<li><p>题目描述 (长度为 n 的数组 nums 里的所有数字都在 0～n-1 的范围内 ), 说明每个元素都应该与自己的下标相等，都有自己的位置</p>
</li>
<li><p>通过循环把每个元素放回自己的位置，如果发现被相同的元素占用，表示重复</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> findRepeatNumber = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (nums[index] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> temp = nums[index];</span><br><span class="line">    <span class="keyword">if</span> (temp === index) &#123; index += <span class="number">1</span>; <span class="keyword">continue</span> &#125;;</span><br><span class="line">    <span class="keyword">if</span> (nums[temp] === temp) <span class="keyword">return</span> temp;</span><br><span class="line">    nums[index] = nums[temp];</span><br><span class="line">    nums[temp] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>复杂度分析</strong></p>
<ul>
<li><p>时间复杂度：<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.844ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2141 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-24-TEX-I-1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path id="MJX-24-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-24-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-24-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D442" xlink:href="#MJX-24-TEX-I-1D442"></use></g><g data-mml-node="mo" transform="translate(763,0)"><use data-c="28" xlink:href="#MJX-24-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1152,0)"><use data-c="1D45B" xlink:href="#MJX-24-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(1752,0)"><use data-c="29" xlink:href="#MJX-24-TEX-N-29"></use></g></g></g></svg></mjx-container></p>
</li>
<li><p>空间复杂度：<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.618ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2041 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-23-TEX-I-1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path id="MJX-23-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-23-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-23-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D442" xlink:href="#MJX-23-TEX-I-1D442"></use></g><g data-mml-node="mo" transform="translate(763,0)"><use data-c="28" xlink:href="#MJX-23-TEX-N-28"></use></g><g data-mml-node="mn" transform="translate(1152,0)"><use data-c="31" xlink:href="#MJX-23-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(1652,0)"><use data-c="29" xlink:href="#MJX-23-TEX-N-29"></use></g></g></g></svg></mjx-container></p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%B3%E8%81%94%E9%A2%98%E7%9B%AE/" rel="tag">关联题目</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-devops/BFF_A"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/87af43227417/"
    >BFF 实践</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/87af43227417/" class="article-date">
  <time datetime="2020-12-10T06:56:09.000Z" itemprop="datePublished">2020-12-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="BFF"><a href="#BFF" class="headerlink" title="BFF"></a>BFF</h4><p>BFF，即 Backend For Frontend（服务于前端的后端），也就是服务器设计 API 时会考虑前端的使用，并在服务端直接进行业务逻辑的处理，又称为用户体验适配器。BFF 只是一种逻辑分层，而非一种技术，虽然 BFF 是一个新名词，但它的理念由来已久。</p>
<p><img src="/posts/87af43227417/0001.webp"></p>
<p>通常一个页面的请求包含了多个不同的请求，用于页面组件的渲染</p>
<p>同时为了保障 Android，iOS，以及 Web 端的不同需求，需要为不同的平台写不同的 API 接口，而每当值发生一些变化时，需要 Android，iOS，Web 做出修改。</p>
<p><img src="/posts/87af43227417/0002.webp"></p>
<p>有了 BFF 这一层时，我们就不需要考虑系统后端的迁移。后端发生的变化都可以在 BFF 层做一些响应的修改</p>
<p><img src="/posts/87af43227417/0003.webp"></p>
<h5 id="BFF-场景"><a href="#BFF-场景" class="headerlink" title="BFF 场景"></a>BFF 场景</h5><p><strong>多端应用</strong></p>
<p>我们在设计 API 时会考虑到不同设备的需求，也就是为不同的设备提供不同的 API，虽然它们可能是实现相同的功能，但因为不同设备的特殊性，它们对服务端的 API 访问也各有其特点，需要区别处理。</p>
<p><strong>服务聚合</strong></p>
<p>随着微服务的兴起，原本在同一个进程内运行的业务流程被拆分到了不同的服务中。这在增加业务灵活性的同时，也让前端的调用变得更复杂。BFF 的出现为前端应用提供了一个对业务服务调用的聚合点，它屏蔽了复杂的服务调用链，让前端可以聚焦在所需要的数据上，而不用关注底层提供这些数据的服务。</p>
<h5 id="实战中的玩法"><a href="#实战中的玩法" class="headerlink" title="实战中的玩法"></a>实战中的玩法</h5><p><strong>访问控制</strong></p>
<p>例如，服务中的权限控制，将所有服务中的权限控制集中在 BFF 层，使下层服务更加纯粹和独立。</p>
<p><strong>应用缓存</strong></p>
<p>项目中时常存在一些需要缓存的临时数据，此时 BFF 作为业务的汇聚点，距离用户请求最近，遂将该缓存操作放在 BFF 层。</p>
<p><strong>第三方入口</strong></p>
<p>在业务中需要与第三交互时，将该交互放在 BFF 层，这样可以只暴露必要信息给第三方，从而便于控制第三方的访问。</p>
<h4 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h4><h5 id="项目目录结构划分"><a href="#项目目录结构划分" class="headerlink" title="项目目录结构划分"></a>项目目录结构划分</h5><p><img src="/posts/87af43227417/0001.png"></p>
<h5 id="package-json-生命周期-并行执行"><a href="#package-json-生命周期-并行执行" class="headerlink" title="package.json 生命周期 并行执行"></a>package.json 生命周期 并行执行</h5><p>安装webpack</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D webpack-cli webpack</span><br></pre></td></tr></table></figure>

<p>package.json 文件添加</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo test&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pretest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo pretest&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>执行 <code>yarn test</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yarn run v1.22.10</span><br><span class="line">$ <span class="built_in">echo</span> pretest</span><br><span class="line">pretest</span><br><span class="line">$ <span class="built_in">echo</span> <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">Done <span class="keyword">in</span> 0.05s.</span><br></pre></td></tr></table></figure>

<p>并行执行，不能保证顺序</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo test1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo test2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yarn test1 &amp; yarn test2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">test</span></span><br><span class="line">yarn run v1.22.10</span><br><span class="line">$ yarn test1 &amp; yarn test2</span><br><span class="line">$ <span class="built_in">echo</span> test2</span><br><span class="line">$ <span class="built_in">echo</span> test1</span><br><span class="line">test2</span><br><span class="line">test1</span><br><span class="line">Done <span class="keyword">in</span> 0.25s.</span><br></pre></td></tr></table></figure>


<h5 id="scripy"><a href="#scripy" class="headerlink" title="scripy"></a>scripy</h5><p>使用scripty拆分复杂命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D scripty</span><br></pre></td></tr></table></figure>

<p>package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test:one&quot;</span><span class="punctuation">:</span> <span class="string">&quot;scripty&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test:two&quot;</span><span class="punctuation">:</span> <span class="string">&quot;scripty&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;scripty&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>按照命令建立文件夹</p>
<p><img src="/posts/87af43227417/0002.png"></p>
<p>执行 <code>yarn test</code> test文件夹下面的所有命令</p>
<h5 id="package-json-定义公共参数"><a href="#package-json-定义公共参数" class="headerlink" title="package.json 定义公共参数"></a>package.json 定义公共参数</h5><p>package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;config&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span><span class="number">9999</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>通过变量在命令配置中使用  </p>
<p>script&#x2F;test&#x2F;one.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$npm_package_config_port</span></span><br></pre></td></tr></table></figure>

<p>执行 <code>yarn test</code> 打印端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yarn run v1.22.10</span><br><span class="line">$ scripty</span><br><span class="line">scripty &gt; Executing <span class="string">&quot;/home/supreme/Workspace/mvc/scripts/test/one.sh&quot;</span>:</span><br><span class="line"></span><br><span class="line">9999</span><br><span class="line">scripty &gt; Executing <span class="string">&quot;/home/supreme/Workspace/mvc/scripts/test/two.sh&quot;</span>:</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line">Done <span class="keyword">in</span> 0.13s.</span><br></pre></td></tr></table></figure>

<h5 id="jscpd-代码重复率检查"><a href="#jscpd-代码重复率检查" class="headerlink" title="jscpd 代码重复率检查"></a>jscpd 代码重复率检查</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D jscpd</span><br></pre></td></tr></table></figure>

<p>添加配置文件.jscpd.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;threshold&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;reporters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;html&quot;</span><span class="punctuation">,</span> <span class="string">&quot;console&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>scripts</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jscpd --min-lines 1 --output ./doc/jscpd --pattern <span class="string">&quot;src/**/*.js&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="webpack配置"><a href="#webpack配置" class="headerlink" title="webpack配置"></a>webpack配置</h5><p>建立配置文件夹 config,通过内置方法拿到配置参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="property">env</span>.<span class="property">NODE_ENV</span></span><br></pre></td></tr></table></figure>

<p>安装 <a target="_blank" rel="noopener" href="https://github.com/yargs/yargs">yargs</a>,以对象的形式更方便的获取命令参数</p>
<p>安装 <a target="_blank" rel="noopener" href="https://github.com/survivejs/webpack-merge">webpack-merge</a> 合并公共配置和定制配置</p>
<h5 id="art-template"><a href="#art-template" class="headerlink" title="art-template"></a>art-template</h5><p>使用art-template作为后端模板，用于服务端渲染html<br>配置和swig 模板类似</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add art-template koa-art-template</span><br></pre></td></tr></table></figure>

<h5 id="打包思路"><a href="#打包思路" class="headerlink" title="打包思路"></a>打包思路</h5><p>通过webpack打包前端代码</p>
<p>html-webpack-plugin 处理前端模板,放到指定位置</p>
<p>因为模板中插入js代码所以需要通过编写插件处理</p>
<p>后端模板通过 gulp 处理</p>
<p>处理模块化规范,删除无用的代码</p>
<p>webpack.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">&#x27;glob&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; argv &#125; = <span class="built_in">require</span>(<span class="string">&#x27;yargs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> files = glob.<span class="title function_">sync</span>(<span class="string">&quot;./src/web/views/**/*.js&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> htmls = glob.<span class="title function_">sync</span>(<span class="string">&quot;./src/web/views/**/*.art&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CustomInjectPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;./src/service/config/CustomInjectPlugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> mode = argv.<span class="property">mode</span>;</span><br><span class="line"><span class="keyword">if</span> (!files.<span class="property">length</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entry = files.<span class="title function_">reduce</span>(<span class="function">(<span class="params">entry, path</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> match = path.<span class="title function_">match</span>(<span class="regexp">/(\w+)\/(\w+)\.js$/</span>);</span><br><span class="line">  entry[match[<span class="number">1</span>]] = match.<span class="property">input</span>;</span><br><span class="line">  <span class="keyword">return</span> entry;</span><br><span class="line">&#125;, &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlPlugin = htmls.<span class="title function_">map</span>(<span class="function"><span class="params">path</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> match = path.<span class="title function_">match</span>(<span class="regexp">/(\w+)\/(\w+)\.art$/</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">`<span class="subst">$&#123;match[<span class="number">1</span>]&#125;</span>.art`</span>,</span><br><span class="line">    <span class="attr">template</span>: match.<span class="property">input</span>,</span><br><span class="line">    <span class="attr">hash</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">chunks</span>: [<span class="string">&#x27;runtime&#x27;</span>, match[<span class="number">1</span>]],</span><br><span class="line">    <span class="attr">inject</span>: <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  entry,</span><br><span class="line">  mode,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name]_[contentHash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: __dirname + <span class="string">&#x27;/dist&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    ...htmlPlugin,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CustomInjectPlugin</span>()</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">runtimeChunk</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;runtime&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/web&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CustomInjectPlugin.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pluginName = <span class="string">&#x27;CustomInjectPlugin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomInjectPlugin</span> &#123;</span><br><span class="line">  js = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">compilation</span>.<span class="title function_">tap</span>(<span class="string">&#x27;pluginName&#x27;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">HtmlWebpackPlugin</span>.<span class="title function_">getHooks</span>(compilation).<span class="property">beforeAssetTagGeneration</span>.<span class="title function_">tapAsync</span>(</span><br><span class="line">        pluginName,</span><br><span class="line">        <span class="function">(<span class="params">data, cb</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; <span class="attr">assets</span>: &#123; js &#125; &#125; = data;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">js</span> = js.<span class="title function_">map</span>(<span class="function"><span class="params">src</span> =&gt;</span> src.<span class="title function_">replace</span>(<span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;./&#x27;</span>)).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">          <span class="title function_">cb</span>(<span class="literal">null</span>, data)</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// Static Plugin interface |compilation |HOOK NAME | register listener </span></span><br><span class="line">      <span class="title class_">HtmlWebpackPlugin</span>.<span class="title function_">getHooks</span>(compilation).<span class="property">beforeEmit</span>.<span class="title function_">tapAsync</span>(</span><br><span class="line">        pluginName, <span class="comment">// &lt;-- Set a meaningful name here for stacktraces</span></span><br><span class="line">        <span class="function">(<span class="params">data, cb</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; html &#125; = data;</span><br><span class="line">          data.<span class="property">html</span> = html.<span class="title function_">replace</span>(<span class="regexp">/!script!/</span>, <span class="variable language_">this</span>.<span class="property">js</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">js</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">          <span class="title function_">cb</span>(<span class="literal">null</span>, data)</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">CustomInjectPlugin</span>;</span><br></pre></td></tr></table></figure>

<p>gulpfile.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; series, src, dest &#125; = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> plugins = <span class="built_in">require</span>(<span class="string">&#x27;gulp-load-plugins&#x27;</span>)();</span><br><span class="line"><span class="keyword">const</span> replace = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-replace&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jspath = <span class="string">&#x27;./src/service/**/*.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开发环境 监听文件变化, 处理模块化规范</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">es6</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">  plugins.<span class="title function_">watch</span>(jspath, &#123; <span class="attr">ignoreInitial</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">src</span>(jspath)</span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">babel</span>(&#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;@babel/plugin-transform-modules-commonjs&quot;</span>,</span><br><span class="line">            <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;dist&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;build&#x27;</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">cb</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">es6dev</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(jspath)</span><br><span class="line">    .<span class="title function_">pipe</span>(plugins.<span class="title function_">babel</span>(&#123;</span><br><span class="line">      <span class="attr">ignore</span>: [<span class="string">&#x27;./src/service/config/index.js&#x27;</span>],</span><br><span class="line">      <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">//处理模块化规范</span></span><br><span class="line">        <span class="string">&quot;@babel/plugin-transform-modules-commonjs&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;dist&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">codeClean</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(jspath)</span><br><span class="line">    <span class="comment">// transform the files here.</span></span><br><span class="line">    .<span class="title function_">pipe</span>(plugins.<span class="title function_">rollup</span>(&#123;</span><br><span class="line">      <span class="comment">// any option supported by Rollup can be set here.</span></span><br><span class="line">      <span class="attr">input</span>: <span class="string">&#x27;./src/service/config/index.js&#x27;</span>,</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">format</span>: <span class="string">&#x27;cjs&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="string">&#x27;process.env.NODE_ENV&#x27;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;production&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;dist&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">dev</span> = <span class="title function_">series</span>(es6);</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">default</span> = <span class="title function_">series</span>(es6dev, codeClean);</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BFF/" rel="tag">BFF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-devops/sonarQube"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/fa4fd1c24343/"
    >sonarQube</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/fa4fd1c24343/" class="article-date">
  <time datetime="2020-12-04T08:40:25.000Z" itemprop="datePublished">2020-12-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="Java-环境"><a href="#Java-环境" class="headerlink" title="Java 环境"></a>Java 环境</h4><p>ubuntu 版本</p>
<p><img src="/posts/fa4fd1c24343/0002.png"></p>
<p><img src="/posts/fa4fd1c24343/0003.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i jdk-11.0.9_linux-x64_bin.deb</span><br></pre></td></tr></table></figure>

<p>查看安装路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -L jdk-11.0.9</span><br></pre></td></tr></table></figure>

<p>配置环境变量 ~&#x2F;.bashrc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/jdk-11.0.9</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br></pre></td></tr></table></figure>



<p>服务端： 规则放在服务端，提供一些web hook 和 Jenkins 集成</p>
<p>客户端：在客户端执行，首先去服务端拉取规则 ☝ ，根据规则扫描代码，在本地生成报表， 把报表上传到服务器 ☝ 。</p>
<h4 id="下载-sonarQube"><a href="#下载-sonarQube" class="headerlink" title="下载 sonarQube"></a>下载 sonarQube</h4><p><img src="/posts/fa4fd1c24343/0001.png"></p>
<p>把下在好的安装包放到opt文件夹下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> sonarqube-8.5.1.38104.zip  /opt/</span><br></pre></td></tr></table></figure>

<p>进入文件夹 解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo unzip sonarqube-8.5.1.38104.zip</span><br></pre></td></tr></table></figure>

<p>按照<a target="_blank" rel="noopener" href="https://docs.sonarqube.org/latest/setup/install-server/">官方文档</a>配置wrapper.conf </p>
<p>启动服务，前提是安装好下面的java环境<br>首先进入bin文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/sonarqube-8.5.1.38104/bin</span><br></pre></td></tr></table></figure>

<p>进入对应的命令版本文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> linux-x86-64</span><br></pre></td></tr></table></figure>

<p>执行 sonar.sh 查看自命令， 第一次运行使用 cnosole 自命令，便于查看报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> linux-x86-64 </span><br><span class="line"></span><br><span class="line">sudo ./sonar.sh start</span><br></pre></td></tr></table></figure>

<p><strong>报错1</strong></p>
<p>如果启动时候 遇到 Unable to start JVM: No such file or directory (2)</p>
<p>以root身份设置 &#x2F;opt&#x2F;sonarqube-8.5.1.38104&#x2F;conf&#x2F;wrapper.conf</p>
<p>wrapper.java.command&#x3D;&#x2F;path&#x2F;to&#x2F;my&#x2F;jdk&#x2F;bin&#x2F;java 设置未java安装环境</p>
<p><strong>报错2</strong></p>
<p>sonarqube can not run elasticsearch as root</p>
<p>1.使用 useradd 添加用户<br>2.sudo chown -R 新建的用户 sonarqube安装目录  （给安装目录修改所有者）<br>3.su 新建的用户  （切换用户）<br>4.切换到命令执行文件夹  .&#x2F;sonar.sh start</p>
<p><strong>报错3</strong></p>
<p>Elastic search max virtual memory areas vm.max_map_count [65530] is too low</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure>

<p><strong>报错4</strong></p>
<p>404 错误</p>
<p>访问的时候需要访问 sonar.proptyies 中 sonar.web.context&#x3D;&#x2F;sonarqube 定义的文件夹</p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>使用 admin&#x2F;admin 默认密码登陆</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-devops/CI-CD"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/a660168bab48/"
    >CI CD</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/a660168bab48/" class="article-date">
  <time datetime="2020-12-04T06:18:09.000Z" itemprop="datePublished">2020-12-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><img src="/posts/a660168bab48/0001.png"></p>
<p>代码 -&gt; 构建 -&gt; 集成 -&gt; 测试 -&gt; 发布 -&gt; 部署</p>
<p>|———持续集成——| CI</p>
<p>|———–持续发布————| CD</p>
<p>|—————持续部署—————| CD</p>
<h4 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI CD"></a>CI CD</h4><p><img src="/posts/a660168bab48/0002.png"></p>
<ul>
<li><p>持续集成(CI)</p>
</li>
<li><p>持续交付和持续部署(CD)</p>
</li>
<li><p>现代软件开发的需求加上部署到不同基础设施的复杂性使得创建应用程序成为一个繁琐的过程。当应用程序出现规模性增长,开发团队人员变得更分散时,快速且不断地生产和发布软件的流程将会变得更加困难。</p>
</li>
<li><p>为了解决这些问题,开发团队开始探索新的策略来使他们的构建、测试和发布流程自动化,以帮助其更快地部署新的生产。这就是持续交付和持续集成发展的由来。</p>
</li>
</ul>
<p>流程</p>
<p><img src="/posts/a660168bab48/0003.png"></p>
<h4 id="自动构建"><a href="#自动构建" class="headerlink" title="自动构建"></a>自动构建</h4><p>在软件开发过程中,构建流程会将开发人员生成的代码转换为可执行的可用软件。</p>
<p>对于Go或者C语言等编译语言,此阶段需要通过编译器运行源代码以生成独立的二进制文件。</p>
<p>对于JavaScript或PHP等解释性语言,没有编译的步骤,但是代码依旧需要在特定的时间内冻结、绑定依赖项、打包以便于分发。这些过程通常称为“构建”或“发布”的工件。</p>
<p>虽然开发人员可以手动构建,但这样操作有诸多不利。首先,从主动开发到创建构建的转变中引入了上下文转换,使得开发人员不得不停止生产效率更高的工作来专注于构建过程。其次,每个开发人员都在制作自己的工件,这可能导致构建过程不一致。</p>
<p>为了解决这些顾虑,许多开发团队配置了自动构建流水线。这些系统监视源代码存储库,并在检测到更改时自动启动预配置的构建过程。这一配置无需牵涉过多的人力在其中并且确保了每个构建过程一致。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-linux/进程,线程,协程"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/e94f15211058/"
    >进程，线程，协程</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/e94f15211058/" class="article-date">
  <time datetime="2020-12-03T02:54:42.000Z" itemprop="datePublished">2020-12-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a> / <a class="article-category-link" href="/categories/Linux/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">常见问题</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><strong>程序执行</strong></p>
<ul>
<li>写在硬盘上的静态程序文件 </li>
<li>cpu从磁盘上找到程序文件</li>
<li>.exe 文件中包含操作cpu的指令</li>
<li>把指令放到内存中</li>
<li>在内存中的指令就可以叫做cpu的<strong>进程</strong></li>
</ul>
<h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>对于cpu来讲，有一个时间线的概念，时间线上的每一个点对应着一个操作指令</p>
<p>操作系统把时间线分割为不同的时间片，时间片是执行程序的小单位</p>
<p>按照 1，2，1，2的顺序，来回切换任务的分配，可以让cpu调度进程，看起来在同时执行多个操作</p>
<p>进程比较重，每个任务分配一个进程，频繁切换的时候损耗比较大，所以有了线程的概念</p>
<p>进程之间内存相互独立，进程之间相互通信需要内核转发（系统调用）。也就是进程之间的通信需要经过操作系统，损耗比较大</p>
<p>进程主要占据的内存代码（进程的实现代码），数据（需要处理的数据），文件（和硬盘文件关联的文件句柄，需要通过系统内核，来完成文件的操作）</p>
<p>执行的时候需要写寄存器，在进程切换的时候需要保存寄存器中信息的状态，把寄存器中的数据写到内存中。</p>
<p>栈 函数调用栈</p>
<h4 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h4><p>线程比较轻，线程依附与进程，是多个线程对应一个进程的关系，</p>
<p>线程共享进程的内存（代码，数据，文件），但是有自己独立的寄存器和栈，所以线程比较轻</p>
<p>线程共享数据存在的问题，可能读写同时操作，需要线程锁</p>
<h4 id="IO-密集型"><a href="#IO-密集型" class="headerlink" title="IO 密集型"></a>IO 密集型</h4><p>输入输出的速度远小于CPU的速度。 </p>
<p>多任务 -&gt; 多线程 -&gt; 时间驱动 -&gt; 协程</p>
<h4 id="CPU密集型"><a href="#CPU密集型" class="headerlink" title="CPU密集型"></a>CPU密集型</h4><p>多进程 -&gt; 多线程</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-linux/网络配置问题"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/5598ffff28da/"
    >网络配置问题</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/5598ffff28da/" class="article-date">
  <time datetime="2020-12-03T01:39:04.000Z" itemprop="datePublished">2020-12-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a> / <a class="article-category-link" href="/categories/Linux/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">常见问题</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><strong>可以使用<code>type +命令</code>来查看命令所在目录</strong></p>
<h4 id="查看网络配置基本信息"><a href="#查看网络配置基本信息" class="headerlink" title="查看网络配置基本信息"></a>查看网络配置基本信息</h4><p>centenOS 6 之前使用 <code>ifconfg</code> 命令, 之后使用<code>ip</code> 命令， 也可以安装 <code>ifconfig</code>命令包</p>
<h4 id="重启网卡"><a href="#重启网卡" class="headerlink" title="重启网卡"></a>重启网卡</h4><p>如果可以直接操作服务其 可以使用 <code>ifup</code> ,<code>ifdown</code></p>
<p>如果提示系统没有命令可以使用 <code>apt install ifupdown</code>安装</p>
<p><strong>如果是远程不能使用这个两个命令重启网卡，使用ifdown后会断开网络连接</strong></p>
<p>可以在确保网络配置修改成功之后，使用 <code>systemctl restar network</code></p>
<p>如果命令不可用可以使用 <code>service network-manager restart</code></p>
<p>如果是 Kali Linux（Debian），则需要<code>service networking restart</code></p>
<p>如果是Centos 8 需要<code>nmcli c reload</code></p>
<h4 id="查找占用端口"><a href="#查找占用端口" class="headerlink" title="查找占用端口"></a>查找占用端口</h4><p>可以使用 <code>ss</code> 或 <code>netstat</code> 命令 后面加 <code> -anp</code> </p>
<p>如果没有 <code>netstat</code> 命令，可以通过 <code>apt install net-tools</code> 安装</p>
<p>最后使用 <code>kill</code> 命令杀掉端口</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-devops/工程化中的linux"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/de11f04658e7/"
    >工程化常用命令</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/de11f04658e7/" class="article-date">
  <time datetime="2020-12-02T08:52:11.000Z" itemprop="datePublished">2020-12-02</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><p>查看进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux</span><br></pre></td></tr></table></figure>

<h4 id="kill-pkill"><a href="#kill-pkill" class="headerlink" title="kill pkill"></a>kill pkill</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 pid</span><br></pre></td></tr></table></figure>

<p>pkill 后面可以直接写进程的名字</p>
<p>如果是一个服务使用 <code>systemctl stop</code></p>
<h4 id="w-who"><a href="#w-who" class="headerlink" title="w who"></a>w who</h4><p>看谁正在连接系统</p>
<h4 id="lsof-查看端口占用"><a href="#lsof-查看端口占用" class="headerlink" title="lsof 查看端口占用"></a>lsof 查看端口占用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出所有打开的文件:</span></span><br><span class="line">lsof</span><br><span class="line">备注: 如果不加任何参数，就会打开所有被打开的文件，建议加上一下参数来具体定位</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看谁正在使用某个文件</span></span><br><span class="line">lsof   /filepath/file</span><br><span class="line"></span><br><span class="line"><span class="comment">#递归查看某个目录的文件信息</span></span><br><span class="line">lsof +D /filepath/filepath2/</span><br><span class="line">备注: 使用了+D，对应目录下的所有子目录和文件都会被列出</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比使用+D选项，遍历查看某个目录的所有文件信息 的方法</span></span><br><span class="line">lsof | grep ‘/filepath/filepath2/’</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出某个用户打开的文件信息</span></span><br><span class="line">lsof  -u username</span><br><span class="line">备注: -u 选项，u其实是user的缩写</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出某个程序所打开的文件信息</span></span><br><span class="line">lsof -c mysql</span><br><span class="line">备注: -c 选项将会列出所有以mysql开头的程序的文件，其实你也可以写成lsof | grep mysql,但是第一种方法明显比第二种方法要少打几个字符了</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出多个程序多打开的文件信息</span></span><br><span class="line">lsof -c mysql -c apache</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出某个用户以及某个程序所打开的文件信息</span></span><br><span class="line">lsof -u <span class="built_in">test</span> -c mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出除了某个用户外的被打开的文件信息</span></span><br><span class="line">lsof   -u ^root</span><br><span class="line">备注：^这个符号在用户名之前，将会把是root用户打开的进程不让显示</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过某个进程号显示该进行打开的文件</span></span><br><span class="line">lsof -p 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出多个进程号对应的文件信息</span></span><br><span class="line">lsof -p 123,456,789</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出除了某个进程号，其他进程号所打开的文件信息</span></span><br><span class="line">lsof -p ^1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有的网络连接</span></span><br><span class="line">lsof -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有tcp 网络连接信息</span></span><br><span class="line">lsof  -i tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有udp网络连接信息</span></span><br><span class="line">lsof  -i udp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出谁在使用某个端口</span></span><br><span class="line">lsof -i :3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出谁在使用某个特定的udp端口</span></span><br><span class="line">lsof -i udp:55</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特定的tcp端口</span></span><br><span class="line">lsof -i tcp:80</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出某个用户的所有活跃的网络端口</span></span><br><span class="line">lsof  -a -u <span class="built_in">test</span> -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有网络文件系统</span></span><br><span class="line">lsof -N</span><br><span class="line"></span><br><span class="line"><span class="comment">#域名socket文件</span></span><br><span class="line">lsof -u</span><br><span class="line"></span><br><span class="line"><span class="comment">#某个用户组所打开的文件信息</span></span><br><span class="line">lsof -g 5555</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据文件描述列出对应的文件信息</span></span><br><span class="line">lsof -d description(like 2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据文件描述范围列出文件信息</span></span><br><span class="line">lsof -d 2-3</span><br></pre></td></tr></table></figure>

<h4 id="免密登陆"><a href="#免密登陆" class="headerlink" title="免密登陆"></a>免密登陆</h4><ul>
<li><p>生成密钥对</p>
<p>-t 指定密钥类型，默认是 rsa ，可以省略。<br>-C 设置注释文字，比如邮箱。<br>-f 指定密钥文件存储文件名。</p>
<p><strong>如果想免密登录，密钥不要填写密码，否则必须验证密钥密码才能登录</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者创建使用 ed25519 加密算法的密钥</span></span><br><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>上传共钥到服务器对应账号的 home 目录下.ssh 文件夹下面，公钥的权限为 600</p>
<p>linux 执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i mykey_rsa.pub you_user_name@xxx.xxx.xxx.xxx</span><br></pre></td></tr></table></figure>

<p>window 需要手动在服务器上创建文件,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span>  ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或直接写入文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;your_public_key_here&quot;</span> &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改权限</span></span><br><span class="line"><span class="built_in">chmod</span> 600 authorized_keys</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定私钥登陆，私钥的权限为 600</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i 私钥 user@xxx.xxx.xxx.xxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过配置文件免密登陆，在本地服务器把私钥复制到 home 下的.ssh 文件夹下面</p>
<p>创建名称为 config 的文件，配置单一服务器免密登陆</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Host tencent</span><br><span class="line">  HostName 124.222.139.87</span><br><span class="line">  User ubuntu</span><br><span class="line">  IdentityFile ./.ssh/id_ed25519</span><br><span class="line">  IdentitiesOnly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Host 别名</span></span><br><span class="line"><span class="comment"># 　HostName IP</span></span><br><span class="line"><span class="comment"># 　Port 端口</span></span><br><span class="line"><span class="comment"># 　User 用户名</span></span><br><span class="line"><span class="comment"># 　IdentitiesOnly yes</span></span><br><span class="line"><span class="comment">#   IdentityFile ~/.ssh/user_rsa  (私钥路径)</span></span><br><span class="line"><span class="comment">#   Protocal 2 (协议版本号)</span></span><br><span class="line"><span class="comment">#   Compression yes</span></span><br><span class="line"><span class="comment">#   ServerAliveInterval 60 （防止被踢配置，长时间没有操作会被踢掉，每隔60秒发一个信号）</span></span><br><span class="line"><span class="comment">#   ServerAliveCountMax 20 (最大连接数)</span></span><br><span class="line"><span class="comment">#   LogLevel INFO</span></span><br></pre></td></tr></table></figure>

<p>通配符配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Host app-produce</span><br><span class="line">  HostName 192.168.1.10</span><br><span class="line">  Port 22</span><br><span class="line">  User appuser</span><br><span class="line">  IdentityFile ~/.ssh/id_ed25519</span><br><span class="line"></span><br><span class="line">Host \*\_produce</span><br><span class="line">  User commonuser</span><br><span class="line">  IdentityFile ~/.ssh/id_ed25519</span><br><span class="line">  Port 22</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h4><p>wget 是一个从网络上自动下载文件的自由工具，支持通过 HTTP、HTTPS、FTP 三个最常见的 TCP&#x2F;IP 协议 下载，并可以使用 HTTP 代理。”wget” 这个名称来源于 “World Wide Web” 与 “get” 的结合。</p>
<p>wget 可以在用户退出系统的之后在后台执行。这意味这你可以登录系统，启动一个 wget 下载任务，然后退出系统，wget 将在后台执行直到任务完成，相对于其它大部分浏览器在下载大量数据时需要用户一直的参与.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget (选项) (参数)</span><br></pre></td></tr></table></figure>

<p>其中选项如下：</p>
<p>-a&lt;日志文件&gt;：在指定的日志文件中记录资料的执行过程；</p>
<p>-A&lt;后缀名&gt;：指定要下载文件的后缀名，多个后缀名之间使用逗号进行分隔；</p>
<p>-b：进行后台的方式运行 wget；</p>
<p>-B&lt;连接地址&gt;：设置参考的连接地址的基地地址；</p>
<p>-c：继续执行上次终端的任务；</p>
<p>-C&lt;标志&gt;：设置服务器数据块功能标志 on 为激活，off 为关闭，默认值为 on；</p>
<p>-d：调试模式运行指令；</p>
<p>-D&lt;域名列表&gt;：设置顺着的域名列表，域名之间用“，”分隔；</p>
<p>-e&lt;指令&gt;：作为文件“.wgetrc”中的一部分执行指定的指令；</p>
<p>-h：显示指令帮助信息；</p>
<p>-i&lt;文件&gt;：从指定文件获取要下载的 URL 地址；</p>
<p>-l&lt;目录列表&gt;：设置顺着的目录列表，多个目录用“，”分隔；</p>
<p>-L：仅顺着关联的连接；</p>
<p>-r：递归下载方式；</p>
<p>-nc：文件存在时，下载文件不覆盖原有文件；</p>
<p>-nv：下载时只显示更新和出错信息，不显示指令的详细执行过程；</p>
<p>-q：不显示指令执行过程；</p>
<p>-nh：不查询主机名称；</p>
<p>-v：显示详细执行过程；</p>
<p>-V：显示版本信息；</p>
<p>–passive-ftp：使用被动模式 PASV 连接 FTP 服务器；</p>
<p>–follow-ftp：从 HTML 文件中下载 FTP 连接文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">wget http://test.com/testfile.zip -&gt;下载指定文件到当前文件夹</span><br><span class="line">wget -O wordpress.zip http://test.com/download -&gt;指定保存名字</span><br><span class="line">wget --limit-rate=300k http://www.linuxde.net/testfile.zip -&gt;限制下载速度</span><br><span class="line">wget -c http://www.linuxde.net/testfile.zip -&gt;断点续传</span><br><span class="line">wget -b http://www.linuxde.net/testfile.zip -&gt;后台下载</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置使用指定浏览器下载（伪装下载）</span></span><br><span class="line">wget --user-agent=<span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.204 Safari/534.16&quot;</span> http://www.linuxde.net/testfile.zip</span><br><span class="line"></span><br><span class="line">wget --spider url -&gt;测试下载</span><br><span class="line">wget --tries=40 URL -&gt;设置重试次数为40</span><br><span class="line">wget -i filelist.txt -&gt;从filelist.txt获取下载地址</span><br><span class="line"></span><br><span class="line"><span class="comment"># 镜像网站</span></span><br><span class="line"><span class="comment"># --miror开户镜像下载。</span></span><br><span class="line"><span class="comment"># -p下载所有为了html页面显示正常的文件。</span></span><br><span class="line"><span class="comment"># --convert-links下载后，转换成本地的链接。</span></span><br><span class="line"><span class="comment"># -P ./LOCAL保存所有文件和目录到本地指定目录</span></span><br><span class="line">wget --mirror -p --convert-links -P ./LOCAL URL</span><br><span class="line"></span><br><span class="line">wget --reject=gif ur -&gt;下载一个网站，但你不希望下载图片，可以使用这条命令</span><br><span class="line">wget -o download.log URL -&gt;把下载信息存入日志文件</span><br><span class="line">wget -Q5m -i filelist.txt -&gt;限制总下载文件大小</span><br><span class="line">wget -r -A.pdf url -&gt;下载指定格式文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># FTP下载</span></span><br><span class="line">wget ftp-url</span><br><span class="line">wget --ftp-user=USERNAME --ftp-password=PASSWORD url</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-javascript/underscore设计"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/a2a41d69ba3d/"
    >underscore框架设计</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/a2a41d69ba3d/" class="article-date">
  <time datetime="2020-12-02T05:44:27.000Z" itemprop="datePublished">2020-12-02</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="立即执行函数"><a href="#立即执行函数" class="headerlink" title="立即执行函数"></a>立即执行函数</h4><p>使用立即执行函数，创建局部作用域，隔离环境并初始化代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"><span class="variable language_">global</span>, factory</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;))</span><br></pre></td></tr></table></figure>

<h4 id="判断采用那种模块化规范导出"><a href="#判断采用那种模块化规范导出" class="headerlink" title="判断采用那种模块化规范导出"></a>判断采用那种模块化规范导出</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// commomjs 规范</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">module</span> !== <span class="string">&#x27;undefined&#x27;</span> ? <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>() :</span><br><span class="line"><span class="comment">// amd 规范</span></span><br><span class="line"><span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span> ? <span class="title function_">define</span>(<span class="string">&#x27;underscore&#x27;</span>, factory) :</span><br><span class="line"><span class="comment">// 如果都不是则 直接挂在this上</span></span><br><span class="line">(<span class="variable language_">global</span> = <span class="variable language_">global</span> || self, (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> current = <span class="variable language_">global</span>.<span class="property">_</span>;</span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">exports</span> = <span class="variable language_">global</span>.<span class="property">_</span> = <span class="title function_">factory</span>();</span><br><span class="line">  <span class="comment">//防止多次引入冲突</span></span><br><span class="line">  <span class="built_in">exports</span>.<span class="property">noConflict</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">global</span>.<span class="property">_</span> = current;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">exports</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;()));</span><br></pre></td></tr></table></figure>

<h4 id="创建根节点"><a href="#创建根节点" class="headerlink" title="创建根节点"></a>创建根节点</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立根节点对象，self 在浏览器端， global 在服务端， this 在一些虚拟机中，使用self 代替 window 提供对 Webworker 的支持</span></span><br><span class="line"><span class="keyword">var</span> root = <span class="keyword">typeof</span> self == <span class="string">&#x27;object&#x27;</span> &amp;&amp; self.<span class="property">self</span> === self &amp;&amp; self ||</span><br><span class="line">          <span class="keyword">typeof</span> <span class="variable language_">global</span> == <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="variable language_">global</span>.<span class="property">global</span> === <span class="variable language_">global</span> &amp;&amp; <span class="variable language_">global</span> ||</span><br><span class="line">          <span class="title class_">Function</span>(<span class="string">&#x27;return this&#x27;</span>)() ||</span><br><span class="line">          &#123;&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="each方法"><a href="#each方法" class="headerlink" title="each方法"></a>each方法</h4><p><strong>each 依赖的函数</strong></p>
<p>一个内部函数，根据参数返回不同的回调函数的封装，一个复用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">optimizeCb</span>(<span class="params">func, context, argCount</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 没有传入执行上下文， 直接返回函数</span></span><br><span class="line">  <span class="keyword">if</span> (context === <span class="keyword">void</span> <span class="number">0</span>) <span class="keyword">return</span> func;</span><br><span class="line">  <span class="keyword">switch</span> (argCount == <span class="literal">null</span> ? <span class="number">3</span> : argCount) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> func.<span class="title function_">call</span>(context, value);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// The 2-argument case is omitted because we’re not using it.</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">value, index, collection</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> func.<span class="title function_">call</span>(context, value, index, collection);</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">accumulator, value, index, collection</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> func.<span class="title function_">call</span>(context, accumulator, value, index, collection);</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> func.<span class="title function_">apply</span>(context, <span class="variable language_">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>isArrayLike</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">MAX_ARRAY_INDEX</span> = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单获取属性值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">shallowProperty</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span> ? <span class="keyword">void</span> <span class="number">0</span> : obj[key];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getLength = <span class="title function_">shallowProperty</span>(<span class="string">&#x27;length&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性检查 数字格式，且不能超过数组最大值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSizePropertyCheck</span>(<span class="params">getSizeProperty</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">collection</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> sizeProperty = <span class="title function_">getSizeProperty</span>(collection);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> sizeProperty == <span class="string">&#x27;number&#x27;</span> &amp;&amp; sizeProperty &gt;= <span class="number">0</span> &amp;&amp; sizeProperty &lt;= <span class="variable constant_">MAX_ARRAY_INDEX</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isArrayLike = <span class="title function_">createSizePropertyCheck</span>(getLength);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">each</span>(<span class="params">obj, iteratee, context</span>) &#123;</span><br><span class="line">  iteratee = <span class="title function_">optimizeCb</span>(iteratee, context);</span><br><span class="line">  <span class="keyword">var</span> i, length;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isArrayLike</span>(obj)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, length = obj.<span class="property">length</span>; i &lt; length; i++) &#123;</span><br><span class="line">      <span class="title function_">iteratee</span>(obj[i], i, obj);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> _keys = <span class="title function_">keys</span>(obj);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, length = _keys.<span class="property">length</span>; i &lt; length; i++) &#123;</span><br><span class="line">      <span class="title function_">iteratee</span>(obj[_keys[i]], _keys[i], obj);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="挂载方法-混合模式"><a href="#挂载方法-混合模式" class="headerlink" title="挂载方法 混合模式"></a>挂载方法 混合模式</h4><p>依赖的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内部方法，创建一个toString 基础测试器</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">tagTester</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tag = <span class="string">&#x27;[object &#x27;</span> + name + <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> toString.<span class="title function_">call</span>(obj) === tag;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> isFunction = <span class="title function_">tagTester</span>(<span class="string">&#x27;Function&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> isFunction$<span class="number">1</span> = isFunction;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//返回一个排序的 所有工具函数名的数组</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">functions</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> names = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isFunction$1</span>(obj[key])) names.<span class="title function_">push</span>(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> names.<span class="title function_">sort</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>定义underscore方法</strong></p>
<ul>
<li>如果是underscore实例直接返回</li>
<li>如果不是通过new操作符执行函数</li>
<li>再次进入第二行的判断，这时已经是underscore的实例会继续往下执行</li>
<li>在实例上挂在一个变量指向传入的对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> _) <span class="keyword">return</span> obj;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> _)) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">_</span>(obj);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_wrapped</span> = obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>核心mixin 方法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mixin</span>(<span class="params">obj</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 循环所有导出方法的名称</span></span><br><span class="line">  <span class="title function_">each</span>(<span class="title function_">functions</span>(obj), <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="comment">// 每个名称对应的方法</span></span><br><span class="line">    <span class="keyword">var</span> func = _[name] = obj[name];</span><br><span class="line">    <span class="comment">//  在原型上挂载同样的方法</span></span><br><span class="line">    _.<span class="property"><span class="keyword">prototype</span></span>[name] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//拿到上面挂载的 传入的对象</span></span><br><span class="line">      <span class="keyword">var</span> args = [<span class="variable language_">this</span>.<span class="property">_wrapped</span>];</span><br><span class="line">      <span class="comment">// 拼接为整个数组 </span></span><br><span class="line">      <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">apply</span>(args, <span class="variable language_">arguments</span>);</span><br><span class="line">      <span class="comment">//直接用定义的内置方法执行</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">chainResult</span>(<span class="variable language_">this</span>, func.<span class="title function_">apply</span>(_, args));</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> _;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allExports = &#123;</span><br><span class="line">  <span class="attr">each</span>:each</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _$<span class="number">1</span> = <span class="title function_">mixin</span>(allExports);</span><br><span class="line"><span class="comment">// Legacy Node.js API.</span></span><br><span class="line">_$<span class="number">1.</span>_ = _$<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _$<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>所以可以用下面的方法执行方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(item)&#125;);</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/underscore/" rel="tag">underscore</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-devops/测试环境karma"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/dd661b79ea9b/"
    >测试环境karma</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/dd661b79ea9b/" class="article-date">
  <time datetime="2020-11-23T06:25:20.000Z" itemprop="datePublished">2020-11-23</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn init -y</span><br></pre></td></tr></table></figure>

<h4 id="实现第一个测试用例"><a href="#实现第一个测试用例" class="headerlink" title="实现第一个测试用例"></a>实现第一个测试用例</h4><p>index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add = <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> + a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.spec.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;测试基本api&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;add&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">except</span>(<span class="title function_">add</span>(<span class="number">1</span>)).<span class="title function_">toBe</span>(<span class="number">2</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="如何让上面的代码运行"><a href="#如何让上面的代码运行" class="headerlink" title="如何让上面的代码运行"></a>如何让上面的代码运行</h4><p>安装karma测试框架</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D karma</span><br></pre></td></tr></table></figure>

<p>配置package.json可以执行karma命令，如果不想配置可以安装 karma-cli</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;karma-init&quot;</span><span class="punctuation">:</span><span class="string">&quot;karma init&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>执行命令初始化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn karma-init</span><br></pre></td></tr></table></figure>

<ul>
<li>Which testing framework do you want to use?</li>
</ul>
<p>想要使用的单元测试框架 jasmine</p>
<ul>
<li>Do you want to use Require.js</li>
</ul>
<p>是否想要用Requirejs， 不需要</p>
<ul>
<li>Do you want to capture any browsers automatically？</li>
</ul>
<p>想要自动调用的浏览器 PhantomJS</p>
<p>PhantomJS是一个可编程的无头浏览器:一个完整的浏览器内核,包括js解析引擎,渲染引擎,请求处理等,但是不包括显示和用户交互页面的浏览器。</p>
<p>hantomJS的适用范围就是无头浏览器的适用范围。通常无头浏览器可以用于页面自动化，网页监控，网络爬虫等：</p>
<p>页面自动化测试：希望自动的登陆网站并做一些操作然后检查结果是否正常。<br>网页监控：希望定期打开页面，检查网站是否能正常加载，加载结果是否符合预期。加载速度如何等。<br>网络爬虫：获取页面中使用js来下载和渲染信息，或者是获取链接处使用js来跳转后的真实地址</p>
<ul>
<li>What is the location of your source and test files</li>
</ul>
<p>想要测试的文件位置，暂时留空</p>
<ul>
<li>Should any of the files included by the previous patterns be excluded？</li>
</ul>
<p>想要排除哪些文件暂时留空</p>
<ul>
<li>Do you want Karma to watch all the files and run the tests on change？</li>
</ul>
<p>是否需要监听文件改变， 暂时选no,不监听</p>
<p><strong>下一步</strong></p>
<p>打开生成的karma.conf.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 测试框架名称</span></span><br><span class="line">  <span class="attr">frameworks</span>: [<span class="string">&#x27;jasmine&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">//测试文件目录</span></span><br><span class="line">  <span class="attr">files</span>: [</span><br><span class="line">    <span class="string">&quot;./test/unit/**/*.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;./test/unit/**/*.spec.js&quot;</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="attr">singleRun</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在package.json中添加运行命令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;karma-init&quot;</span>: <span class="string">&quot;karma init&quot;</span>,</span><br><span class="line">  <span class="string">&quot;karma-start&quot;</span>: <span class="string">&quot;karma start&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>安装无头浏览器和jasmine适配器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D karma-jasmine karma-phantomjs-launcher phantomjs</span><br></pre></td></tr></table></figure>

<p>编写测试用例</p>
<p>index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (a == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.spec.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;单元测试&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;contains spec with an expectation&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">add</span>(<span class="number">1</span>)).<span class="title function_">toBe</span>(<span class="number">2</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>执行 <code>karma-start</code> 进行单元测试</p>
<p><img src="/posts/dd661b79ea9b/0001.png"></p>
<h4 id="覆盖率测试"><a href="#覆盖率测试" class="headerlink" title="覆盖率测试"></a>覆盖率测试</h4><p>安装 <code>karma-coverage</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D karma-coverage</span><br></pre></td></tr></table></figure>

<p>修改配置项</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">preprocessors</span>: &#123;</span><br><span class="line">    <span class="string">&quot;./test/unit/**/*.js&quot;</span>:<span class="string">&quot;coverage&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">reporters</span>: [<span class="string">&#x27;progress&#x27;</span>,<span class="string">&#x27;coverage&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="attr">coverageReporter</span>: &#123;</span><br><span class="line">    <span class="attr">dir</span>: <span class="string">&#x27;doc/coverage&#x27;</span>,</span><br><span class="line">    <span class="attr">reporters</span>: [</span><br><span class="line">      <span class="comment">// reporters not supporting the `file` property</span></span><br><span class="line">      &#123; <span class="attr">type</span>: <span class="string">&#x27;html&#x27;</span>, <span class="attr">subdir</span>: <span class="string">&#x27;report-html&#x27;</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行再次执行 <code>karma-start</code></p>
<h4 id="UI测试"><a href="#UI测试" class="headerlink" title="UI测试"></a>UI测试</h4><p>安装 backstop</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D backstop</span><br></pre></td></tr></table></figure>

<p>添加 package.json 命令行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;backstop-init&quot;</span>: <span class="string">&quot;backstop init&quot;</span>,</span><br><span class="line">    <span class="string">&quot;backstop-start&quot;</span>: <span class="string">&quot;backstop test&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行 <code>backstop-init</code> 生成文件目录</p>
<p>修改文件目录配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;baidu&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设计图分辨率设置</span></span><br><span class="line">  <span class="string">&quot;viewports&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;label&quot;</span>: <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">      <span class="string">&quot;width&quot;</span>: <span class="number">375</span>,</span><br><span class="line">      <span class="string">&quot;height&quot;</span>: <span class="number">667</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;label&quot;</span>: <span class="string">&quot;tablet&quot;</span>,</span><br><span class="line">      <span class="string">&quot;width&quot;</span>: <span class="number">1024</span>,</span><br><span class="line">      <span class="string">&quot;height&quot;</span>: <span class="number">768</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">//调用 puppeteer 库的脚本</span></span><br><span class="line">  <span class="string">&quot;onBeforeScript&quot;</span>: <span class="string">&quot;puppet/onBefore.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;onReadyScript&quot;</span>: <span class="string">&quot;puppet/onReady.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scenarios&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;label&quot;</span>: <span class="string">&quot;baidu home&quot;</span>,</span><br><span class="line">      <span class="string">&quot;cookiePath&quot;</span>: <span class="string">&quot;backstop_data/engine_scripts/cookies.json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://garris.github.io/BackstopJS/&quot;</span>,</span><br><span class="line">      <span class="string">&quot;referenceUrl&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;readyEvent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;readySelector&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;delay&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">&quot;hideSelectors&quot;</span>: [],</span><br><span class="line">      <span class="string">&quot;removeSelectors&quot;</span>: [],</span><br><span class="line">      <span class="string">&quot;hoverSelector&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;clickSelector&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;postInteractionWait&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">&quot;selectors&quot;</span>: [],</span><br><span class="line">      <span class="string">&quot;selectorExpansion&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;expect&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">&quot;misMatchThreshold&quot;</span> : <span class="number">0.1</span>,</span><br><span class="line">      <span class="string">&quot;requireSameDimensions&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bitmaps_reference&quot;</span>: <span class="string">&quot;backstop_data/bitmaps_reference&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bitmaps_test&quot;</span>: <span class="string">&quot;backstop_data/bitmaps_test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;engine_scripts&quot;</span>: <span class="string">&quot;backstop_data/engine_scripts&quot;</span>,</span><br><span class="line">    <span class="string">&quot;html_report&quot;</span>: <span class="string">&quot;doc/backstop_data/html_report&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ci_report&quot;</span>: <span class="string">&quot;backstop_data/ci_report&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;report&quot;</span>: [<span class="string">&quot;browser&quot;</span>],</span><br><span class="line">  <span class="string">&quot;engine&quot;</span>: <span class="string">&quot;puppeteer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;engineOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;args&quot;</span>: [<span class="string">&quot;--no-sandbox&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;asyncCaptureLimit&quot;</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="string">&quot;asyncCompareLimit&quot;</span>: <span class="number">50</span>,</span><br><span class="line">  <span class="string">&quot;debug&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;debugWindow&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/19/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/21/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2025
        <i class="ri-heart-fill heart_icon"></i> SunZhiqi
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.png" alt="四月八日"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>此时无声胜有声！</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="/js/jquery.modal.min.js"></script>
<link rel="stylesheet" href="/css/jquery.modal.min.css" />
<script src="/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg"></div>

  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->

        <div class="pswp__counter"></div>

        <button
          class="pswp__button pswp__button--close"
          title="Close (Esc)"
        ></button>

        <button
          class="pswp__button pswp__button--share"
          style="display: none"
          title="Share"
        ></button>

        <button
          class="pswp__button pswp__button--fs"
          title="Toggle fullscreen"
        ></button>

        <button
          class="pswp__button pswp__button--zoom"
          title="Zoom in/out"
        ></button>

        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div>
      </div>

      <button
        class="pswp__button pswp__button--arrow--left"
        title="Previous (arrow left)"
      ></button>

      <button
        class="pswp__button pswp__button--arrow--right"
        title="Next (arrow right)"
      ></button>

      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/css/photoswipe.min.css" />
<link rel="stylesheet" href="/css/default-skin.min.css" />
<script src="/js/photoswipe.min.js"></script>
<script src="/js/photoswipe-ui-default.min.js"></script>

<script>
  function viewer_init() {
    let pswpElement = document.querySelectorAll(".pswp")[0];
    let $imgArr = document.querySelectorAll(
      ".article-entry img:not(.reward-img)"
    );

    $imgArr.forEach(($em, i) => {
      $em.onclick = () => {
        // slider展开状态
        // todo: 这样不好，后面改成状态
        if (document.querySelector(".left-col.show")) return;
        let items = [];
        $imgArr.forEach(($em2, i2) => {
          let img = $em2.getAttribute("data-idx", i2);
          let src =
            $em2.getAttribute("data-target") || $em2.getAttribute("src");
          let title = $em2.getAttribute("alt");
          // 获得原图尺寸
          const image = new Image();
          image.src = src;
          items.push({
            src: src,
            w: image.width || $em2.width,
            h: image.height || $em2.height,
            title: title,
          });
        });
        var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
          index: parseInt(i),
        });
        gallery.init();
      };
    });
  }
  viewer_init();
</script>
 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="/js/MathJax.js"></script>
<script src="/js/TeX-AMS-MML_HTMLorMML-full.js"></script>

<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="/js/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !(function (e, t, a) {
    var initCopyCode = function () {
      var copyHtml = "";
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += "</button>";
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS(".btn-copy", {
        target: function (trigger) {
          return trigger.nextElementSibling;
        },
      });
      clipboard.on("success", function (e) {
        let $btn = $(e.trigger);
        $btn.addClass("copied");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-checkbox-circle-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPIED";

        wait(function () {
          // 等待两秒钟后恢复
          $icon.removeClass("ri-checkbox-circle-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
      clipboard.on("error", function (e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass("copy-failed");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-time-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPY FAILED";

        wait(function () {
          // 等待两秒钟后恢复
          $icon.removeClass("ri-time-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
    };
    initCopyCode();
  })(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "default" });
  }
</script>


    
    

  </div>
</body>

</html>