<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="前端 web react" />
       
      <meta name="description" content="前端技术与生活。" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 四月八日</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">
 
<link rel="stylesheet" href="/css/fonts/remixicon.css">
 
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="/js/pace.min.js"></script>
       
 

      <link rel="stylesheet" href="/css/bulma.min.css" />
      <script src="/js/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <script src="https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js"></script>
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/katex.min.css">

<link rel="stylesheet" href="/css/style.css">
<!-- hexo injector head_end end --></head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">四月八日</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['愿你足够强大，也要足够温柔', '最轻的并不是一根羽毛，而是一双飞鸟的翅膀', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  <article class="articles">
    
    
    
    
    <article
  id="posts-javascript/微前端-singleSpa"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/60d3fa605b86/"
    >微前端 ② single-spa</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/60d3fa605b86/" class="article-date">
  <time datetime="2023-08-01T07:30:59.000Z" itemprop="datePublished">2023-08-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>single-spa 是一个将多个 JavaScript 微前端整合到一个前端应用程序中的框架。下面是一些优点:</p>
<ul>
<li>在同一个页面上使用多个框架而不刷新页面</li>
<li>独立部署微前端</li>
<li>使用新框架编写代码，而无需重写现有的应用程序</li>
</ul>
<p>single-spa 比较好的解决了以下问题：</p>
<ul>
<li>应用加载顺序和依赖管理</li>
<li>路由管理</li>
<li>版本管理和升级</li>
<li>调试和监控</li>
</ul>
<h4 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h4><p>single-sap 通过 <a href="/posts/ae7d32dcd157/">systemjs</a> 实现了应用资源的依赖管理</p>
<h4 id="应用加载"><a href="#应用加载" class="headerlink" title="应用加载"></a>应用加载</h4><p>微前端应用需要适当改造，将输出的模式更改为 systemjs， 并且实现 single-spa 指定的接口。single-spa 官方提供了配置工具，用来降低配置的成本。</p>
<p>webpack-config-single-spa 用于输出 webpack 打包文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 输出格式改为 systemjs</span></span><br><span class="line">    <span class="attr">libraryTarget</span>: <span class="string">&quot;system&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">   <span class="attr">devServer</span>: &#123;</span><br><span class="line">      <span class="comment">// 任意路径下都返回 spa 应用入口文件</span></span><br><span class="line">      <span class="attr">historyApiFallback</span>: <span class="literal">true</span>，</span><br><span class="line">      <span class="comment">// 允许对子应用的跨域调用</span></span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 会增加一个入口文件，动态指定 __webpack_public_path__</span></span><br><span class="line">    <span class="comment">// 避免子应用中异步加载的资源请求了主应用的路径</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">SystemJSPublicPathPlugin</span>(</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="comment">// 处理开发模式下独立启动子应用显示页面</span></span><br><span class="line">    !isProduction &amp;&amp;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">StandaloneSingleSpaPlugin</span>(&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/single-spa/" rel="tag">single-spa</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-javascript/隐式转换"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/400347728533/"
    >隐式转换</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/400347728533/" class="article-date">
  <time datetime="2023-07-24T05:20:18.000Z" itemprop="datePublished">2023-07-24</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="一元操作符"><a href="#一元操作符" class="headerlink" title="一元操作符"></a>一元操作符</h4><p>一元操作符包括，<code>+</code>, <code>-</code>, <code>~</code>, <code>!</code>,其中 <code>+</code>, <code>-</code> 需要和加法运算符区分开。</p>
<p>ECMA 规定了 <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-typeof-operator">一元操作符</a> 求值过程。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(+<span class="literal">true</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(+[]); <span class="comment">// 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(+&#123;&#125;); <span class="comment">//NaN</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(+<span class="string">&quot;123&quot;</span>); <span class="comment">// 123</span></span><br></pre></td></tr></table></figure>

<p>对于 <code>+</code> 一元表达式求值，需要首先对操作数（V）取值（<a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-getvalue">GetValue</a>, 对取值结果进行 <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-tonumber">ToNumber</a> 操作。</p>
<p><strong>ToNumber</strong>:</p>
<ol>
<li>如果 V 是 <code>Number</code>，返回 V</li>
<li>如果 V 是 <code>Symbol</code> 或 <code>BigInt</code> 抛出错误 <code>TypeError</code></li>
<li>如果 V <code>undefined</code>, 返回 <code>NaN</code></li>
<li>如果 V 是 <code>null</code> 或 <code>false</code> 返回 <code>+0</code></li>
<li>如果 V 是 <code>true</code> 返回 1 （案例 1）</li>
<li>如果 V 是 <code>String</code> 返回 <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-stringtonumber">StringToNumber(argument)</a> <code>StringToNumber</code> 规定如果不能转成数字，返回 <code>NaN</code> 如果可以则返回 <code>Number</code> （案例 4）</li>
<li>V 如果是一个 <code>Object</code></li>
<li>将 V 转换为原始值 <a target="_blank" rel="noopener" href="https://tc39.es/ecma262/#sec-toprimitive">ToPrimitive</a> 数组将会通过 <code>toString</code> 转换为 <code>&quot;&quot;</code>, 再次执行第 6 步，最终数组被转换为 <code>0</code> (案例 2)，对象在经过 <code>ToPrimitive</code> 转换为 <code>[Object object]</code>, 在执行 <code>StringToNumber</code> 由于不能转换为数字，最终返回 <code>NaN</code> (案例 3)</li>
<li>原始值不是对象，再次执行 <code>ToNumber</code></li>
</ol>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-other/manjaro美化"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/83a61cb886df/"
    >manjaro美化</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/83a61cb886df/" class="article-date">
  <time datetime="2023-07-03T05:51:32.000Z" itemprop="datePublished">2023-07-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="添加-archlinux-源"><a href="#添加-archlinux-源" class="headerlink" title="添加 archlinux 源"></a>添加 archlinux 源</h2><p><a target="_blank" rel="noopener" href="https://github.com/archlinuxcn/mirrorlist-repo">mirrorlist-repo</a> 官方仓库地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/pacman.conf</span></span><br><span class="line"></span><br><span class="line">[archlinuxcn]</span><br><span class="line">Server = https://repo.archlinuxcn.org/<span class="variable">$arch</span></span><br></pre></td></tr></table></figure>

<h2 id="设置源"><a href="#设置源" class="headerlink" title="设置源"></a>设置源</h2><ul>
<li><p>软件仓库中选择 Preferences, use mirrors 选择指定源</p>
</li>
<li><p>通过命令行选择</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 手动选择镜像列表</span></span><br><span class="line">sudo pacman-mirrors -i -c China -m rank</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动生成配置列表 -g 表示从活动池中选择镜像列表</span></span><br><span class="line">sudo pacman-mirrors -c China -g</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="更新系统"><a href="#更新系统" class="headerlink" title="更新系统"></a>更新系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Syyu</span><br></pre></td></tr></table></figure>

<h2 id="安装-yay-助手"><a href="#安装-yay-助手" class="headerlink" title="安装 yay 助手"></a>安装 yay 助手</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S yay</span><br></pre></td></tr></table></figure>

<h2 id="输入法"><a href="#输入法" class="headerlink" title="输入法"></a>输入法</h2><p><a target="_blank" rel="noopener" href="https://wiki.archlinuxcn.org/wiki/Fcitx5">Fcitx5</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S fcitx5-im fcitx5-chinese-addons fcitx5-material-color</span><br></pre></td></tr></table></figure>

<p>系统设置中添加拼音输入法</p>
<p><img src="/posts/83a61cb886df/001.png"></p>
<p>配置环境变量，让应用程序可以使用输入法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/environment</span></span><br><span class="line"></span><br><span class="line">GTK_IM_MODULE=fcitx</span><br><span class="line">QT_IM_MODULE=fcitx</span><br><span class="line">XMODIFIERS=@im=fcitx</span><br></pre></td></tr></table></figure>

<p>配置插件：</p>
<ul>
<li>点击 configure addons, 选择 classic user interface 勾选 use per screen DPI, 保证输入法随系统缩放。</li>
</ul>
<p>设置联想:</p>
<ul>
<li><p>使用云拼音实现联想功能</p>
<p>点击 configure addons, 选择 PinYin, 开启云拼音，并选择 Baidu</p>
</li>
</ul>
<h2 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h2><p><a target="_blank" rel="noopener" href="https://ohmyz.sh/#install">oh-my-zsh</a></p>
<h2 id="Desktop-Effect"><a href="#Desktop-Effect" class="headerlink" title="Desktop Effect"></a>Desktop Effect</h2><ul>
<li>Blur : noise 0, blur 适当调整。</li>
</ul>
<h2 id="latte-dock"><a href="#latte-dock" class="headerlink" title="latte-dock"></a>latte-dock</h2><p>代替系统自带 task manager 组件，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pamac build latte-dock-git</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Manajro/" rel="tag">Manajro</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-other/LVM模式安装manjaro"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/71298d9bd5e3/"
    >LVM模式安装manjaro</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/71298d9bd5e3/" class="article-date">
  <time datetime="2023-07-03T01:54:34.000Z" itemprop="datePublished">2023-07-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="安装流程"><a href="#安装流程" class="headerlink" title="安装流程"></a>安装流程</h2><p>首先对物理磁盘分区，对于 UEFI 引导方式，需要划分 efi 分区 并把磁盘挂载到 &#x2F;boot&#x2F;efi 路径</p>
<p><strong>注意</strong>： 所有的分区和格式化操作都需要在命令行中执行， manjaro 的 GUI 只用来挂载分区</p>
<p>如果使用 window 环境下的虚拟机安装， 在 <strong>启用或关闭 windows 功能</strong> 配置中，关闭 windows 沙箱， Hyper-v 两个配置， 这功能可能导致虚拟死机。</p>
<ul>
<li>启动前将系统的引导方式修改为 UEFI,进入系统时选择专有驱动的选项启动方式</li>
</ul>
<p><img src="/posts/71298d9bd5e3/0001.png"></p>
<p><img src="/posts/71298d9bd5e3/0002.png"></p>
<ul>
<li>使用 fdisk 查看磁盘信息</li>
</ul>
<p><img src="/posts/71298d9bd5e3/0003.png"></p>
<ul>
<li>格式化磁盘为 GPT 格式，划分出 500M 作为 efi 分区，剩余空间给 LVM 使用</li>
</ul>
<p><img src="/posts/71298d9bd5e3/0004.png"></p>
<ul>
<li>分区成功后将 efi 分区格式化为 FAT32 格式</li>
</ul>
<p><img src="/posts/71298d9bd5e3/0005.png"></p>
<p><img src="/posts/71298d9bd5e3/0006.png"></p>
<ul>
<li>将剩余的空间转为 LVM, 创建出 &#x2F;dev&#x2F;vgdisk&#x2F;lvhome 分区，并将 lvhome 分区格式化为 ext4</li>
</ul>
<p><img src="/posts/71298d9bd5e3/0007.png"></p>
<p>分配成功后使用以下命令查看分区信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo pvs</span><br><span class="line">sudo vgs</span><br><span class="line">sudo lvs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看详细信息</span></span><br><span class="line"></span><br><span class="line">sudo pvdisplay</span><br><span class="line">sudo vgdisplay</span><br><span class="line">sudo lvdisplay</span><br></pre></td></tr></table></figure>

<p>删除分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pvremove /dev/something</span><br><span class="line">sudo vgremove something</span><br><span class="line">sudo lvremove /dev/something</span><br></pre></td></tr></table></figure>

<ul>
<li>通过 GUI 界面将分区挂载到指定路径，<strong>挂载磁盘时一定不要重新格式化磁盘</strong></li>
</ul>
<p><img src="/posts/71298d9bd5e3/0008.png"></p>
<p><img src="/posts/71298d9bd5e3/0009.png"></p>
<p><img src="/posts/71298d9bd5e3/0010.png"></p>
<p><img src="/posts/71298d9bd5e3/0011.png"></p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><ul>
<li>开机时提示一下错误，可能是遗留的 bug,解决方案如下</li>
</ul>
<p><img src="/posts/71298d9bd5e3/0012.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/default/grub</span></span><br><span class="line">GRUB_SAVDEFAULT=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">update-grub</span><br></pre></td></tr></table></figure>


<h2 id="手动挂载分区"><a href="#手动挂载分区" class="headerlink" title="手动挂载分区"></a>手动挂载分区</h2><p>系统安装成功后，可能需要挂载更多自定义分区, 首先创建一个 workspace lv分区</p>
<p>查看分区信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo blkid</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定分区</span></span><br><span class="line">sudo blkid /dev/sda1</span><br></pre></td></tr></table></figure>

<p>添加信息到 &#x2F;etc&#x2F;fstab, 实现自动挂载</p>
<p><img src="/posts/71298d9bd5e3/0013.png"></p>
<h2 id="扩容-lvm"><a href="#扩容-lvm" class="headerlink" title="扩容 lvm"></a>扩容 lvm</h2><ul>
<li><p>扩容虚拟磁盘， vmware 磁盘设置中增加磁盘容量。</p>
</li>
<li><p>使用 gdisk 为剩余磁盘创建分区，创建成功后磁盘可能无法使用，使用以下命令刷新分区表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo partprobe</span><br></pre></td></tr></table></figure></li>
<li><p>使用 pvcreate 将新的分区创建为新的pv</p>
</li>
<li><p>扩容 vg 将新的 pv 添加至 指定卷组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vgextend vgdisk /dev/sda3</span><br><span class="line"></span><br><span class="line">vgs <span class="comment">#查看容量</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>扩容 lv</p>
<p>-l +  ：指定逻辑卷的LE个数，如 -l +200  一般一个为 4M<br>-L + ：表示增加多少空间，如 -L +15G ，单位有bBsSkKmMgGtTpPeE<br>-l +100%FREE    ：表示增加vg的全部可用空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvextend -L +15G /dev/vgname/lvname</span><br></pre></td></tr></table></figure>
</li>
<li><p>扩展文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resize2fs /dev/something</span><br></pre></td></tr></table></figure></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Manajro/" rel="tag">Manajro</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-design/pattern/⑪代理模式"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/6bd45dcc9aef/"
    >⑪控制访问-代理模式</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/6bd45dcc9aef/" class="article-date">
  <time datetime="2023-03-16T18:19:40.000Z" itemprop="datePublished">2023-03-17</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h4><p><strong>为另一个对象提供一个替身或占位符以控制对这个对象的访问。</strong></p>
<p>代理模式非常灵活，可能不经意写的一行代码也是代理模式，例如：</p>
<ul>
<li>分发请求到到远程</li>
<li>为初始化开销大的对象提供代理</li>
<li>保护某些对方法不能访问</li>
</ul>
<h4 id="图片加载"><a href="#图片加载" class="headerlink" title="图片加载"></a>图片加载</h4><p>想象一下一个图片的加载过程是不是可以通过代理来实现</p>
<ul>
<li>发起加载图片并绘制在页面上的请求</li>
<li>这个请求将发送给代理对象</li>
<li>代理对象通过网络获取图片</li>
<li>绘制图片并提供图片控制的接口</li>
</ul>
<h4 id="防火墙代理"><a href="#防火墙代理" class="headerlink" title="防火墙代理"></a>防火墙代理</h4><p>控制网络资源的访问，保护主题免于侵害</p>
<h4 id="只能引用代理"><a href="#只能引用代理" class="headerlink" title="只能引用代理"></a>只能引用代理</h4><p>当主题被引用时，进行额外的动作，例如计算一个对象被引用的次数</p>
<h4 id="缓存代理"><a href="#缓存代理" class="headerlink" title="缓存代理"></a>缓存代理</h4><p>为开销大的运算结果提供暂时存储，它也允许多个客户共享结果，以减少计算或网络延迟。</p>
<h4 id="同步代理"><a href="#同步代理" class="headerlink" title="同步代理"></a>同步代理</h4><p>在多线程的情况下，提供安全访问。</p>
<h4 id="复杂隐藏代理"><a href="#复杂隐藏代理" class="headerlink" title="复杂隐藏代理"></a>复杂隐藏代理</h4><p>用来隐藏一个类的复杂度，并控制访问，有时候也称为 <strong>外观代理</strong>。<br>复杂隐藏代理和外观模式不一样，因为代理控制访问，而外观模式提供另一组接口。</p>
<h4 id="写入时复制代理"><a href="#写入时复制代理" class="headerlink" title="写入时复制代理"></a>写入时复制代理</h4><p>用来控制对象的复制，方法是延迟对象的复制，直到客户真的需要为止。这是虚拟代理的变体。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-css/位置与布局"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/3c545ad624c6/"
    >CSS 尺寸/位置/布局/元素</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/3c545ad624c6/" class="article-date">
  <time datetime="2023-03-01T08:42:28.000Z" itemprop="datePublished">2023-03-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/CSS/">CSS</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="复选框与文本对齐"><a href="#复选框与文本对齐" class="headerlink" title="复选框与文本对齐"></a>复选框与文本对齐</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当字号大于 input 尺寸时， input 会与文字中间对其</p>
<p>但是字号过小的时候，input 与文字底部并不能对其</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 方案1 */</span></span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">vertical-align</span>: -<span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 方案2 */</span></span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">vertical-align</span>: top;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 方案3 */</span></span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="多行文字垂直居中"><a href="#多行文字垂直居中" class="headerlink" title="多行文字垂直居中"></a>多行文字垂直居中</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;child&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>这里显示多行文字。这里显示多行文字。这里显示多行文字。这里显示多行文字。这里显示多行文字。这里显示多行文字。这里显示多行文字。这里显示多行文字。&lt;/span</span><br><span class="line">  &gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 方案1 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 方案2 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: auto <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 方案3 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">line-height</span>: normal;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 方案4 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: table-cell;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="多行文本超出隐藏"><a href="#多行文本超出隐藏" class="headerlink" title="多行文本超出隐藏"></a>多行文本超出隐藏</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  -webkit-line-clamp: <span class="number">3</span>;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="三列布局"><a href="#三列布局" class="headerlink" title="三列布局"></a>三列布局</h4><ul>
<li>绝对定位 1</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 绝对定位1 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: goldenrod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: thistle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: palegreen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绝对定位2 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: goldenrod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: thistle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: palegreen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>浮动 + 负 margin</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: goldenrod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: palegreen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background</span>: thistle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 推荐，元素与视觉保持一致 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: goldenrod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: palegreen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">background</span>: thistle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>flex</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: goldenrod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: palegreen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: thistle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="尺寸百分比"><a href="#尺寸百分比" class="headerlink" title="尺寸百分比"></a>尺寸百分比</h4><ul>
<li>无定位元素： 相对于外层元素的内容(容纳)区域</li>
<li>定位元素： 相对于最近的定位元素的 padding 区域</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>百分比相对与</th>
</tr>
</thead>
<tbody><tr>
<td>width</td>
<td>参考元素宽度</td>
</tr>
<tr>
<td>height</td>
<td>参考元素高度，需要指定参考元素高度</td>
</tr>
<tr>
<td>padding</td>
<td>参考元素宽度</td>
</tr>
<tr>
<td>border</td>
<td>参考元素宽度</td>
</tr>
<tr>
<td>margin</td>
<td>参考元素宽度</td>
</tr>
</tbody></table>
<h4 id="最大-x2F-最小-尺寸"><a href="#最大-x2F-最小-尺寸" class="headerlink" title="最大&#x2F;最小 尺寸"></a>最大&#x2F;最小 尺寸</h4><p>可用于防止内部元素，超出容器尺寸</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h4><ul>
<li><p>form 可以原生支持回车键提交表单， 会自动查找 form 中第一个有 <code>type=&#39;submit&#39;</code> 的按钮， 并触发这个按钮的点击事件</p>
</li>
<li><p>放在 label 中的 input 元素，即使没有使用 for 关联在一起，点击 label 中的任意元素，也会选中 input</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>name<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  &gt;&lt;/label</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="精灵图"><a href="#精灵图" class="headerlink" title="精灵图"></a>精灵图</h4><p><a target="_blank" rel="noopener" href="https://github.com/twolfson/spritesmith">spritesmith</a> 用于合并图片，并生成生成样式</p>
<h4 id="属性值计算过程"><a href="#属性值计算过程" class="headerlink" title="属性值计算过程"></a>属性值计算过程</h4><p>每一个元素的每一个属性都必须有值，属性值变为最终计算样式的过程就是属性值计算过程。</p>
<ul>
<li><p>确定声明值: 样式表中没有冲突的声明，作为最终样式</p>
</li>
<li><p>层叠冲突: 对有冲突的声明使用层叠规则，确定 css 属性值</p>
<ul>
<li>比较重要性,<strong>作者样式表会覆盖浏览器默认样式</strong></li>
<li>比较特殊性,<strong>比较权重</strong></li>
<li>比较源次序，<strong>权重相同时，后写的样式覆盖先写的样式</strong></li>
</ul>
</li>
<li><p>使用继承，对仍然没有值的属性，若可以继承，则继承父元素的值</p>
</li>
<li><p>使用默认值，对仍然没有值的属性，使用默认值</p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-design/pattern/⑩状态模式"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/9185b58a2b8d/"
    >⑩状态模式</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/9185b58a2b8d/" class="article-date">
  <time datetime="2023-02-21T01:33:42.000Z" itemprop="datePublished">2023-02-21</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="避免陷入在-if-x2F-else-之中"><a href="#避免陷入在-if-x2F-else-之中" class="headerlink" title="避免陷入在 if&#x2F;else 之中"></a>避免陷入在 if&#x2F;else 之中</h4><p>考虑以下两种场景，哪种更容易让你深陷在 if&#x2F;else 的逻辑之中。</p>
<p><strong>订单配送</strong>，订单可能处于下面的几种状态</p>
<ul>
<li>下单状态</li>
<li>打包状态</li>
<li>配送状态</li>
<li>签收状态</li>
</ul>
<p><strong>自动售卖机</strong></p>
<ul>
<li>无货状态</li>
<li>有货状态</li>
<li>已投币状态</li>
<li>未投币状态</li>
<li>出货状态</li>
</ul>
<p>显然订单配送的状态处理起来更容易一些</p>
<ul>
<li>下单状态需要备货</li>
<li>打包状态需要检查时候安全，是否要放入小礼物</li>
<li>配送状态要同步配送信息</li>
<li>签收状态要回访客户</li>
</ul>
<p>虽然这些状态环环相扣，但是一旦状态完成转移就不需要在考虑原有状态中的行为是否还需要关注。</p>
<p>而自动售售货机可能让你陷入 if&#x2F;else 的深渊，因为不同的状态可能伴随相同的操作，无论处于哪种状态，用户都可能按下取货按钮，但只有投币并且有货，按下取货才有意义。</p>
<h4 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h4><p><strong>状态模式：允许对象在内部状态改变的时候改变他的行为，对象看起来好像修改了它的类。</strong></p>
<p>状态模式和策略模式中的组合对象很像，但是状态模式更专注与状态的迁移，和不同状态中的行为。</p>
<ul>
<li>状态模式允许一个对象基于内部状态而拥有不同的行为。</li>
<li><strong>和程序状态机（PSM）不同,状态模式用类代表状态</strong></li>
<li>Context 会将行为委托给当前对象</li>
<li>通过将每个状态封装进一个类，我们把以后需要做的任何变化都局部化了</li>
<li>状态模式允许 Context 随着状态改变而改变行为</li>
<li>状态转移可以由 State 类或 Context 类控制</li>
<li>使用状态模式通常会导致设计中类的数目大量增加</li>
<li>状态类可以被多个 Context 实例共享</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 投币</span></span><br><span class="line"><span class="comment">// 点击出货</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="attr">machine</span>: <span class="title class_">VendingMachine</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">machine: VendingMachine</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">machine</span> = machine;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">addCoin</span>(<span class="params">coin?: <span class="built_in">Number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;必须实现 addCoin&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getProduct</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;必须实现 getProduct&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 无商品</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoProduct</span> <span class="keyword">extends</span> <span class="title class_ inherited__">State</span> &#123;</span><br><span class="line">  <span class="title function_">addCoin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;机器里无商品，你不能购买&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getProduct</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;机器里无商品，你不能购买&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HasProduct</span> <span class="keyword">extends</span> <span class="title class_ inherited__">State</span> &#123;</span><br><span class="line">  <span class="title function_">addCoin</span>(<span class="params">coin: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">machine</span>.<span class="property">coin</span> += coin;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getProduct</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;你已经获取了商品&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">machine</span>.<span class="property">count</span> -= <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">machine</span>.<span class="property">coin</span> -= <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">stateTransform</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">stateTransform</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count, coin &#125; = <span class="variable language_">this</span>.<span class="property">machine</span>;</span><br><span class="line">    <span class="keyword">if</span> (coin === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">machine</span>.<span class="title function_">setState</span>(<span class="variable language_">this</span>.<span class="property">machine</span>.<span class="property">stateNoCoin</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">machine</span>.<span class="title function_">setState</span>(<span class="variable language_">this</span>.<span class="property">machine</span>.<span class="property">stateNoProduct</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoCoin</span> <span class="keyword">extends</span> <span class="title class_ inherited__">State</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VendingMachine</span> &#123;</span><br><span class="line">  <span class="attr">stateNoProduct</span>: <span class="title class_">NoProduct</span>;</span><br><span class="line">  <span class="attr">stateHasProduct</span>: <span class="title class_">HasProduct</span>;</span><br><span class="line">  <span class="attr">stateNoCoin</span>: <span class="title class_">NoCoin</span>;</span><br><span class="line">  <span class="attr">count</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">coin</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="attr">state</span>: <span class="title class_">NoProduct</span> | <span class="title class_">HasProduct</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">count: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> = count || <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stateNoProduct</span> = <span class="keyword">new</span> <span class="title class_">NoProduct</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stateHasProduct</span> = <span class="keyword">new</span> <span class="title class_">HasProduct</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stateNoCoin</span> = <span class="keyword">new</span> <span class="title class_">NoCoin</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable language_">this</span>.<span class="property">stateHasProduct</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">setState</span>(<span class="params">state: NoProduct | HasProduct</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = state;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">addCoin</span>(<span class="params">coin = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="title function_">addCoin</span>(coin);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getProduct</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="title function_">getProduct</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-javascript/canvas画板"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/35b9815417e8/"
    >canvas 画板</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/35b9815417e8/" class="article-date">
  <time datetime="2023-01-31T13:51:37.000Z" itemprop="datePublished">2023-01-31</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="橡皮擦"><a href="#橡皮擦" class="headerlink" title="橡皮擦"></a>橡皮擦</h4><p>依赖于 ctx.globalCompositeOperation 配置，有以下可选项</p>
<p>source-over（默认值）：新图形绘制在现有图形上方。<br>source-in：新图形仅在与现有图形重叠的区域内绘制。<br>source-out：新图形仅在与现有图形不重叠的区域内绘制。<br>source-atop：新图形绘制在现有图形上方，但只在它们重叠的区域内可见。<br>destination-over：新图形绘制在现有图形下方。<br>destination-in：现有图形仅保留与新图形重叠的部分。<br>destination-out：现有图形中与新图形不重叠的部分保留。<br>destination-atop：现有图形绘制在新图形上方，但只在它们重叠的区域内可见。<br>lighter：重叠区域的颜色通过加法混合。<br>copy：只有新图形可见，现有内容被清除。<br>xor：重叠区域变透明。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&quot;destination-out&quot;</span>;</span><br><span class="line"><span class="comment">// 线宽影响橡皮擦大小</span></span><br><span class="line">ctx.<span class="property">lineWidth</span> = <span class="number">10</span>;</span><br><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">ctx.<span class="title function_">lineTo</span>(x, y);</span><br><span class="line">ctx.<span class="title function_">stroke</span>();</span><br></pre></td></tr></table></figure>

<h4 id="使用-rfa-逐帧绘制"><a href="#使用-rfa-逐帧绘制" class="headerlink" title="使用 rfa 逐帧绘制"></a>使用 rfa 逐帧绘制</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = [];</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">draw</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> len = queue.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> a = queue[i];</span><br><span class="line">      ctx.<span class="title function_">lineTo</span>(a[<span class="number">0</span>], a[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (len) &#123;</span><br><span class="line">      ctx.<span class="title function_">stroke</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    queue = [];</span><br><span class="line">    <span class="keyword">if</span> (mark) <span class="title function_">draw</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">canvas?.<span class="title function_">addEventListener</span>(<span class="string">&quot;pointerdown&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  mark = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// 取整数减少浮点运算</span></span><br><span class="line">  queue.<span class="title function_">push</span>([</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">floor</span>(e.<span class="property">clientX</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>),</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">floor</span>(e.<span class="property">clientY</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>),</span><br><span class="line">  ]);</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  <span class="title function_">draw</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="平滑曲线"><a href="#平滑曲线" class="headerlink" title="平滑曲线"></a>平滑曲线</h4><p>使用贝塞尔曲线拟合</p>
<ul>
<li>取 B C 中点 B1, A 为起点，B 为控制点，B1 为终点</li>
<li>取 C D 中点 C1, B1 为起点，C 为控制点，C1 为终点</li>
</ul>
<p><img src="/posts/35b9815417e8/001.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> rfa = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">draw</span> = (<span class="params">index = <span class="number">0</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!index &amp;&amp; rfa) <span class="keyword">return</span>;</span><br><span class="line">  rfa = <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> len = queue.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">if</span> (len &amp;&amp; !index) &#123;</span><br><span class="line">      <span class="keyword">const</span> a = queue[index];</span><br><span class="line">      ctx.<span class="title function_">lineTo</span>(a[<span class="number">0</span>], a[<span class="number">1</span>]);</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (len &gt;= <span class="number">3</span> &amp;&amp; index &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> cur = queue[index];</span><br><span class="line">      <span class="keyword">const</span> next = queue[index + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">const</span> cx = (cur[<span class="number">0</span>] + next[<span class="number">0</span>]) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">const</span> cy = (cur[<span class="number">1</span>] + next[<span class="number">1</span>]) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">      ctx.<span class="title function_">quadraticCurveTo</span>(cur[<span class="number">0</span>], cur[<span class="number">1</span>], cx, cy);</span><br><span class="line">      index += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len) &#123;</span><br><span class="line">      ctx.<span class="title function_">stroke</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mark) &#123;</span><br><span class="line">      <span class="title function_">draw</span>(index);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      rfa = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="离屏-canvas-模拟粉笔效果"><a href="#离屏-canvas-模拟粉笔效果" class="headerlink" title="离屏 canvas 模拟粉笔效果"></a>离屏 canvas 模拟粉笔效果</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">queue</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line"><span class="keyword">const</span> offScreen = <span class="keyword">new</span> <span class="title class_">OffscreenCanvas</span>(dimension.<span class="property">width</span>, dimension.<span class="property">height</span>);</span><br><span class="line"><span class="keyword">const</span> offCtx = offScreen.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>) <span class="keyword">as</span> <span class="title class_">OffscreenCanvasRenderingContext2D</span>;</span><br><span class="line">offCtx.<span class="title function_">scale</span>(width / dimension.<span class="property">width</span>, height / dimension.<span class="property">height</span>);</span><br><span class="line">offCtx.<span class="property">strokeStyle</span> = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">offCtx.<span class="property">lineWidth</span> = <span class="number">6</span>;</span><br><span class="line">offCtx.<span class="property">lineCap</span> = <span class="string">&quot;round&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">draw</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> len = queue.<span class="property">length</span>;</span><br><span class="line">    offCtx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, dimension.<span class="property">width</span>, dimension.<span class="property">height</span>);</span><br><span class="line">    <span class="comment">// 在清除画布之后必须使用 beginPath</span></span><br><span class="line">    offCtx.<span class="title function_">beginPath</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> a = queue[i];</span><br><span class="line">      offCtx.<span class="title function_">lineTo</span>(a[<span class="number">0</span>], a[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (len) &#123;</span><br><span class="line">      offCtx.<span class="title function_">stroke</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> pre = queue[i - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">const</span> cur = queue[i];</span><br><span class="line">      <span class="keyword">const</span> length = <span class="title class_">Math</span>.<span class="title function_">round</span>(</span><br><span class="line">        <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(pre[<span class="number">0</span>] - cur[<span class="number">0</span>], <span class="number">2</span>) + <span class="title class_">Math</span>.<span class="title function_">pow</span>(pre[<span class="number">1</span>] - cur[<span class="number">1</span>], <span class="number">2</span>))</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">const</span> xUnit = (cur[<span class="number">0</span>] - pre[<span class="number">0</span>]) / length;</span><br><span class="line">      <span class="keyword">const</span> yUnit = (cur[<span class="number">1</span>] - pre[<span class="number">1</span>]) / length;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> xCurrent = pre[<span class="number">0</span>] + i * xUnit;</span><br><span class="line">        <span class="keyword">const</span> yCurrent = pre[<span class="number">1</span>] + i * yUnit;</span><br><span class="line">        <span class="keyword">const</span> xRandom = xCurrent + (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>) * <span class="number">6</span> * <span class="number">1.2</span>;</span><br><span class="line">        <span class="keyword">const</span> yRandom = yCurrent + (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>) * <span class="number">6</span> * <span class="number">1.2</span>;</span><br><span class="line">        offCtx.<span class="title function_">clearRect</span>(</span><br><span class="line">          xRandom,</span><br><span class="line">          yRandom,</span><br><span class="line">          <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2</span> + <span class="number">2</span>,</span><br><span class="line">          <span class="title class_">Math</span>.<span class="title function_">random</span>() + <span class="number">1</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    queue = [];</span><br><span class="line"></span><br><span class="line">    ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&quot;source-over&quot;</span>;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(offScreen, <span class="number">0</span>, <span class="number">0</span>, dimension.<span class="property">width</span>, dimension.<span class="property">height</span>);</span><br><span class="line">    <span class="keyword">if</span> (mark) <span class="title function_">draw</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/" rel="tag">canvas</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-design/pattern/⑨迭代器和组合模式"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/4513870475c1/"
    >⑨集合管理-迭代器和组合模式</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/4513870475c1/" class="article-date">
  <time datetime="2023-01-31T01:50:29.000Z" itemprop="datePublished">2023-01-31</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="统一的遍历方法"><a href="#统一的遍历方法" class="headerlink" title="统一的遍历方法"></a>统一的遍历方法</h4><p>像是为对象提供 Iterator 接口一样，有时需要遍历一个复杂对象的内部属性，所以需要一个统一的接口，这也是迭代器模式需求的由来。</p>
<p><strong>迭代器模式：提供一种方法顺序访问一个聚合对象中的各个元素，而又不暴露其内部的表示。</strong></p>
<p>现在有两个对象保存着一些数据，但是数据使用不同的数据结构保存，数组，对象，链表，或是一些特殊的封装结构。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">  data = [<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;c1&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">  data = &#123;</span><br><span class="line">    <span class="attr">a2</span>: <span class="string">&quot;a2&quot;</span>,</span><br><span class="line">    <span class="attr">b2</span>: <span class="string">&quot;b2&quot;</span>,</span><br><span class="line">    <span class="attr">c2</span>: <span class="string">&quot;c2&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果想要便利这两个对象中的所有数据，最容易想到的办法就是分别使用数据和对象的遍历方法，通过两次循环依次返回。</p>
<p>把这个遍历的实现定义为类 <code>MapObject</code>,但这并不是一个合理的办法:</p>
<ul>
<li>遍历的前提是必须要知道对象的实现细节，违背了针对接口编程，而不是针对实现，也可以说是违背了封装。</li>
<li>如果需要更换其中的一个类遍历，那么必须修改 <code>MapObject</code>,违背了对扩展开放，对修改关闭。</li>
</ul>
<p>现在已经清楚了变化之处在于遍历，想办法把遍历封装起来。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IteratorClass</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">new</span> (): T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IIterator</span> &#123;</span><br><span class="line">  <span class="title function_">iterator</span>(): <span class="title class_">IterableIterator</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循面向接口编程的原则，两个类都实现了相同的接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test1</span> <span class="keyword">implements</span> <span class="title class_">IIterator</span> &#123;</span><br><span class="line">  data = [<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;c1&quot;</span>];</span><br><span class="line">  <span class="title function_">iterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">data</span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test2</span> <span class="keyword">implements</span> <span class="title class_">IIterator</span> &#123;</span><br><span class="line">  data = &#123;</span><br><span class="line">    <span class="attr">a2</span>: <span class="string">&quot;a2&quot;</span>,</span><br><span class="line">    <span class="attr">b2</span>: <span class="string">&quot;b2&quot;</span>,</span><br><span class="line">    <span class="attr">c2</span>: <span class="string">&quot;c2&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">iterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> iterator = (): <span class="title class_">IterableIterator</span>&lt;<span class="built_in">string</span>&gt; =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> data = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">      <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data);</span><br><span class="line">      <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> index &lt; keys.<span class="property">length</span></span><br><span class="line">            ? &#123;</span><br><span class="line">                <span class="attr">value</span>: data[keys[index++] <span class="keyword">as</span> keyof <span class="keyword">typeof</span> data],</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            : &#123;</span><br><span class="line">                <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">              &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125; <span class="keyword">as</span> <span class="title class_">IterableIterator</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">iterator</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapObject</span> &#123;</span><br><span class="line">  <span class="attr">test1</span>: <span class="title class_">Test1</span>;</span><br><span class="line">  <span class="attr">test2</span>: <span class="title class_">Test2</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">test1: IteratorClass&lt;Test1&gt;, test2: IteratorClass&lt;Test2&gt;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">test1</span> = <span class="keyword">new</span> <span class="title function_">test1</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">test2</span> = <span class="keyword">new</span> <span class="title function_">test2</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">printItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> stack = [<span class="variable language_">this</span>.<span class="property">test1</span>, <span class="variable language_">this</span>.<span class="property">test2</span>];</span><br><span class="line"></span><br><span class="line">    stack.<span class="title function_">forEach</span>(<span class="function">(<span class="params">instance</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> iterator = instance.<span class="title function_">iterator</span>();</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">done</span>: <span class="built_in">any</span>, <span class="attr">value</span>: <span class="built_in">any</span>;</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        (&#123; done, value &#125; = iterator.<span class="title function_">next</span>());</span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">while</span> (!done);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="单一职责"><a href="#单一职责" class="headerlink" title="单一职责"></a>单一职责</h4><p><strong>一个类应该只有一个引起变化的原因。</strong>， 当一个类有多个变化的可能时，会增加维护的成本，或导致其他的功能出现错误。</p>
<p><strong>内聚</strong>这个术语也可以看作是衡量单一指责的一个表述。</p>
<h4 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h4><p>组合模式相对于之前提到的代码组合更加具体，可以理解为代码组合包括组合模式。</p>
<p>现在有这样的几个对象，每个对象用不同的数据结构保存自己的数据，而且数据还可能分级，下一级是另一个对象，形成一个树的结构。需要实现一个迭代器，能在树的不同节点中以及下一层节点中移动。</p>
<p>实现这个功能可以使用组合模式，<strong>组合模式允许你将对象组合成树形结构来表现 ‘整体&#x2F;部分’ 层次结构。组合能让客户以一致的方式处理个别对象以及对象组合。</strong></p>
<p><strong>组合的目的是忽略整体和个体的差别，应用在整体上的操作同样可以应用在个体上。</strong></p>
<p>遵循面向接口的变成方式，首先实现抽象类，所有的对象以及叶子节点的对象都需要实现抽象类，并且从冲向类中继承 print 方法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractDataCollection</span> &#123;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">createIterator</span>(): <span class="built_in">any</span>;</span><br><span class="line">  <span class="title function_">print</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">done</span>: <span class="built_in">any</span>, <span class="attr">value</span>: <span class="built_in">any</span>;</span><br><span class="line">    <span class="keyword">const</span> iterator = <span class="variable language_">this</span>.<span class="title function_">createIterator</span>();</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      (&#123; done, value &#125; = iterator.<span class="title function_">next</span>());</span><br><span class="line">      <span class="keyword">if</span> (!done) &#123;</span><br><span class="line">        value.<span class="title function_">print</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (!done);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不同的对象集合可以组合但是由于实现方式不同，需要各自实现抽象相类中的 createIterator 方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataCollection1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractDataCollection</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">dataItem: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">push</span>(dataItem);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">iterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">data</span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createIterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CompositeIterator</span>(<span class="variable language_">this</span>.<span class="title function_">iterator</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataCollection2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractDataCollection</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> &#125; = &#123;&#125;;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">dataItem: <span class="built_in">any</span>, key: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>[key] = dataItem;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">iterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data);</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> index &lt; keys.<span class="property">length</span></span><br><span class="line">          ? &#123;</span><br><span class="line">              <span class="attr">value</span>: data[keys[index++] <span class="keyword">as</span> keyof <span class="keyword">typeof</span> data],</span><br><span class="line">              <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          : &#123;</span><br><span class="line">              <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">              <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createIterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CompositeIterator</span>(<span class="variable language_">this</span>.<span class="title function_">iterator</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LinkData</span> = &#123;</span><br><span class="line">  <span class="attr">next</span>: <span class="title class_">LinkData</span> | <span class="literal">null</span>;</span><br><span class="line">  value?: <span class="built_in">any</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataCollection3</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractDataCollection</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">LinkData</span> = &#123; <span class="attr">next</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">  <span class="attr">last</span>: <span class="title class_">LinkData</span> = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">dataItem: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last</span>.<span class="property">next</span> = &#123;</span><br><span class="line">      <span class="attr">value</span>: dataItem,</span><br><span class="line">      <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last</span> = <span class="variable language_">this</span>.<span class="property">last</span>.<span class="property">next</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">iterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">data</span>: <span class="title class_">LinkData</span> | <span class="literal">null</span> = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        data = data!.<span class="property">next</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (data === <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">value</span>: data.<span class="property">value</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createIterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CompositeIterator</span>(<span class="variable language_">this</span>.<span class="title function_">iterator</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataItem</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractDataCollection</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">data: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createIterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NullIterator</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">print</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">data</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>叶子节点的 createIterator 方法返回一个空的迭代器，真实环境中经常会使用这个方式添加占位，让所有对象的行为保持一致。</p>
<p>对象集合的 createIterator 方法，实现了一个 Iterator 类，把没有迭代完成的迭代器重新放回到队列中</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CompositeIterator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">stack</span>: <span class="title class_">Iterator</span>&lt;T&gt;[] = [];</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">iterator: Iterator&lt;T&gt;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">push</span>(iterator);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>(...<span class="attr">args</span>: [] | [<span class="literal">undefined</span>]): <span class="title class_">IteratorResult</span>&lt;T, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">stack</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> iterator = <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">pop</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> component = iterator!.<span class="title function_">next</span>();</span><br><span class="line">      <span class="keyword">if</span> (!component.<span class="property">done</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">push</span>(iterator!);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> component;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NullIterator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="title function_">next</span>(...<span class="attr">args</span>: [] | [<span class="literal">undefined</span>]): <span class="title class_">IteratorResult</span>&lt;T, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后实现遍历的类</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> <span class="title class_">DataCollection1</span>();</span><br><span class="line">t.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="number">1</span>));</span><br><span class="line">t.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">DataCollection2</span>();</span><br><span class="line"></span><br><span class="line">p.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="string">&quot;a&quot;</span>), <span class="string">&quot;a&quot;</span>);</span><br><span class="line">p.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="string">&quot;b&quot;</span>), <span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> q = <span class="keyword">new</span> <span class="title class_">DataCollection3</span>();</span><br><span class="line">q.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="string">&quot;p&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> w = <span class="keyword">new</span> <span class="title class_">DataCollection2</span>();</span><br><span class="line">w.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="string">&quot;w1&quot;</span>), <span class="string">&quot;w1&quot;</span>);</span><br><span class="line">w.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="string">&quot;w2&quot;</span>), <span class="string">&quot;w2&quot;</span>);</span><br><span class="line"></span><br><span class="line">q.<span class="title function_">add</span>(w);</span><br><span class="line"></span><br><span class="line">q.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">DataItem</span>(<span class="string">&quot;q&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapObject</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractDataCollection</span> &#123;</span><br><span class="line">  <span class="attr">stack</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">instance: AbstractDataCollection</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">push</span>(instance);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">iterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">stack</span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createIterator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CompositeIterator</span>(<span class="variable language_">this</span>.<span class="title function_">iterator</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> <span class="title class_">MapObject</span>();</span><br><span class="line"></span><br><span class="line">o.<span class="title function_">add</span>(t);</span><br><span class="line">o.<span class="title function_">add</span>(p);</span><br><span class="line">o.<span class="title function_">add</span>(q);</span><br><span class="line">o.<span class="title function_">print</span>();</span><br></pre></td></tr></table></figure>

<p>真实世界中的组合模式没有这么刻板，例如 React 组件的组合，通过单向数据流或状态管理工具，只要调用外层组件的方法即可，无需关心子组件的实现。</p>
<p>有时不同的节点之间需要双向连接用于回退，或反查父节点。</p>
<p>如果某个节点作为计算功能，并且频繁调用，可以考虑使用缓存。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-javascript/鼠标触摸指针事件"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/1430ebf25b0e/"
    >鼠标，触摸，指针事件</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/1430ebf25b0e/" class="article-date">
  <time datetime="2023-01-26T02:55:26.000Z" itemprop="datePublished">2023-01-26</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="触摸事件"><a href="#触摸事件" class="headerlink" title="触摸事件"></a>触摸事件</h3><p>Safari 不支持 Touch 事件</p>
<p>| touches | 正在触摸屏幕所有手指的一个列表 |<br>| targetTouches | 正在触摸当前 DOM 元素上的手指的一个列表 |<br>| changedTouches | 相对上一次触摸事件改变的 Touch 对象， 从无到有，从有到无变化 |</p>
<h4 id="模拟一个触摸事件"><a href="#模拟一个触摸事件" class="headerlink" title="模拟一个触摸事件"></a>模拟一个触摸事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取按钮元素</span></span><br><span class="line"><span class="keyword">var</span> button = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myButton&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个触摸点</span></span><br><span class="line"><span class="keyword">var</span> touch = <span class="keyword">new</span> <span class="title class_">Touch</span>(&#123;</span><br><span class="line">  <span class="attr">identifier</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">  <span class="attr">target</span>: button,</span><br><span class="line">  <span class="attr">clientX</span>: <span class="number">50</span>, <span class="comment">// X坐标</span></span><br><span class="line">  <span class="attr">clientY</span>: <span class="number">50</span>, <span class="comment">// Y坐标</span></span><br><span class="line">  <span class="attr">radiusX</span>: <span class="number">2.5</span>,</span><br><span class="line">  <span class="attr">radiusY</span>: <span class="number">2.5</span>,</span><br><span class="line">  <span class="attr">rotationAngle</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">force</span>: <span class="number">0.5</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个触摸事件</span></span><br><span class="line"><span class="keyword">var</span> touchEvent = <span class="keyword">new</span> <span class="title class_">TouchEvent</span>(<span class="string">&quot;touchstart&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">cancelable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">touches</span>: [touch],</span><br><span class="line">  <span class="attr">targetTouches</span>: [],</span><br><span class="line">  <span class="attr">changedTouches</span>: [touch],</span><br><span class="line">  <span class="attr">shiftKey</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">button.<span class="title function_">dispatchEvent</span>(touchEvent);</span><br></pre></td></tr></table></figure>

<h3 id="指针事件历史"><a href="#指针事件历史" class="headerlink" title="指针事件历史"></a>指针事件历史</h3><p>chrome 55 版本之前，同时期浏览器浏览器都只有 MouseEvent, 然而，近年来的新兴设备支持更多不同方式的指针定点输入，如各类触控笔和触摸屏幕等。这就有必要扩展现存的定点设备事件模型，以有效追踪各类指针事件。</p>
<p>PointerEvent 接口继承了所有 MouseEvent 中的属性，以保障原有为鼠标事件所开发的内容能更加有效的迁移到指针事件。</p>
<h4 id="不同事件对应表"><a href="#不同事件对应表" class="headerlink" title="不同事件对应表"></a>不同事件对应表</h4><table>
<thead>
<tr>
<th>MouseEvent</th>
<th>TouchEvent</th>
<th>PointerEvent</th>
</tr>
</thead>
<tbody><tr>
<td>mousedown</td>
<td>touchstart</td>
<td>pointerdown</td>
</tr>
<tr>
<td>mousemove</td>
<td>touchmove</td>
<td>pointermove</td>
</tr>
<tr>
<td>mouseup</td>
<td>touchend</td>
<td>pointerup</td>
</tr>
<tr>
<td></td>
<td>touchcancel</td>
<td>pointercancel</td>
</tr>
<tr>
<td>mouseenter</td>
<td></td>
<td>pointerenter</td>
</tr>
<tr>
<td>mouseleave</td>
<td></td>
<td>pointerleave</td>
</tr>
<tr>
<td>mouseover</td>
<td></td>
<td>pointerover</td>
</tr>
<tr>
<td>mouseout</td>
<td></td>
<td>pointerout</td>
</tr>
<tr>
<td></td>
<td></td>
<td>gotpointercapture</td>
</tr>
<tr>
<td></td>
<td></td>
<td>lostpointercapture</td>
</tr>
</tbody></table>
<h4 id="setPointerCapture"><a href="#setPointerCapture" class="headerlink" title="setPointerCapture"></a>setPointerCapture</h4><p>用于将特定元素指定为未来指针事件的捕获目标。指针的后续事件将以捕获元素为目标，直到捕获被释放</p>
<p>通常用于实现，在元素外拖动的时候让元素保持响应</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;slider&quot;</span>&gt;</span>SLIDE ME<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">beginSliding</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      slider.<span class="property">onpointermove</span> = slide;</span></span><br><span class="line"><span class="language-javascript">      slider.<span class="title function_">setPointerCapture</span>(e.<span class="property">pointerId</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">stopSliding</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      slider.<span class="property">onpointermove</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">      slider.<span class="title function_">releasePointerCapture</span>(e.<span class="property">pointerId</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">slide</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      slider.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translate(<span class="subst">$&#123;e.clientX - <span class="number">70</span>&#125;</span>px)`</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> slider = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;slider&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    slider.<span class="property">onpointerdown</span> = beginSliding;</span></span><br><span class="line"><span class="language-javascript">    slider.<span class="property">onpointerup</span> = stopSliding;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="event-pointerType"><a href="#event-pointerType" class="headerlink" title="event.pointerType"></a>event.pointerType</h4><p>用于区分各类设备，以兼容不同的事件类型.</p>
<ul>
<li><p>mouse 鼠标触发的事件</p>
</li>
<li><p>pen 笔或手写笔设备</p>
</li>
<li><p>touch 手指等触摸事件</p>
</li>
</ul>
<h4 id="多指触控"><a href="#多指触控" class="headerlink" title="多指触控"></a>多指触控</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过id区分</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onpointerdown</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">pointerId</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6/" rel="tag">鼠标事件</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2024
        <i class="ri-heart-fill heart_icon"></i> SunZhiqi
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.png" alt="四月八日"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/Essay">随笔</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>此时无声胜有声！</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="/js/jquery.modal.min.js"></script>
<link rel="stylesheet" href="/css/jquery.modal.min.css" />
<script src="/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg"></div>

  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->

        <div class="pswp__counter"></div>

        <button
          class="pswp__button pswp__button--close"
          title="Close (Esc)"
        ></button>

        <button
          class="pswp__button pswp__button--share"
          style="display: none"
          title="Share"
        ></button>

        <button
          class="pswp__button pswp__button--fs"
          title="Toggle fullscreen"
        ></button>

        <button
          class="pswp__button pswp__button--zoom"
          title="Zoom in/out"
        ></button>

        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div>
      </div>

      <button
        class="pswp__button pswp__button--arrow--left"
        title="Previous (arrow left)"
      ></button>

      <button
        class="pswp__button pswp__button--arrow--right"
        title="Next (arrow right)"
      ></button>

      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/css/photoswipe.min.css" />
<link rel="stylesheet" href="/css/default-skin.min.css" />
<script src="/js/photoswipe.min.js"></script>
<script src="/js/photoswipe-ui-default.min.js"></script>

<script>
  function viewer_init() {
    let pswpElement = document.querySelectorAll(".pswp")[0];
    let $imgArr = document.querySelectorAll(
      ".article-entry img:not(.reward-img)"
    );

    $imgArr.forEach(($em, i) => {
      $em.onclick = () => {
        // slider展开状态
        // todo: 这样不好，后面改成状态
        if (document.querySelector(".left-col.show")) return;
        let items = [];
        $imgArr.forEach(($em2, i2) => {
          let img = $em2.getAttribute("data-idx", i2);
          let src =
            $em2.getAttribute("data-target") || $em2.getAttribute("src");
          let title = $em2.getAttribute("alt");
          // 获得原图尺寸
          const image = new Image();
          image.src = src;
          items.push({
            src: src,
            w: image.width || $em2.width,
            h: image.height || $em2.height,
            title: title,
          });
        });
        var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
          index: parseInt(i),
        });
        gallery.init();
      };
    });
  }
  viewer_init();
</script>
 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="/js/MathJax.js"></script>
<script src="/js/TeX-AMS-MML_HTMLorMML-full.js"></script>

<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="/js/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !(function (e, t, a) {
    var initCopyCode = function () {
      var copyHtml = "";
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += "</button>";
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS(".btn-copy", {
        target: function (trigger) {
          return trigger.nextElementSibling;
        },
      });
      clipboard.on("success", function (e) {
        let $btn = $(e.trigger);
        $btn.addClass("copied");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-checkbox-circle-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPIED";

        wait(function () {
          // 等待两秒钟后恢复
          $icon.removeClass("ri-checkbox-circle-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
      clipboard.on("error", function (e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass("copy-failed");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-time-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPY FAILED";

        wait(function () {
          // 等待两秒钟后恢复
          $icon.removeClass("ri-time-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
    };
    initCopyCode();
  })(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "default" });
  }
</script>


    
    

  </div>
</body>

</html>